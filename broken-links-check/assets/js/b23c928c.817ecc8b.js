"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[7503],{6223:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"backend/databases/Modulo25_Capas_de_acceso_a_datos","title":"Modulo 25. Capas de acceso a datos","description":"\ud83e\udded 25.1. Qu\xe9 es la capa de acceso a datos","source":"@site/docs/backend/databases/Modulo25_Capas_de_acceso_a_datos.md","sourceDirName":"backend/databases","slug":"/backend/databases/Modulo25_Capas_de_acceso_a_datos","permalink":"/docuQuest/docs/backend/databases/Modulo25_Capas_de_acceso_a_datos","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/databases/Modulo25_Capas_de_acceso_a_datos.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Modulo 24. Consultas parametrizadas y seguridad","permalink":"/docuQuest/docs/backend/databases/Modulo24_Consultas_parametrizadas_y_seguridad"},"next":{"title":"Modulo 26. Control de cambios del esquema","permalink":"/docuQuest/docs/backend/databases/Modulo26_Control_de_cambios_del_esquema"}}');var r=s(4848),i=s(8453);const o={},l="Modulo 25. Capas de acceso a datos",c={},d=[{value:"\ud83e\udded 25.1. Qu\xe9 es la capa de acceso a datos",id:"-251-qu\xe9-es-la-capa-de-acceso-a-datos",level:2},{value:"\ud83e\udde0 25.2. Tres enfoques principales",id:"-252-tres-enfoques-principales",level:2},{value:"\ud83e\udded 25.3. Consultas SQL directas \u2014 control total",id:"-253-consultas-sql-directas--control-total",level:2},{value:"\ud83e\uddf1 25.4. Query Builders \u2014 estructura sin perder SQL",id:"-254-query-builders--estructura-sin-perder-sql",level:2},{value:"\ud83e\udded 25.5. ORM \u2014 mapear tablas a objetos",id:"-255-orm--mapear-tablas-a-objetos",level:2},{value:"\ud83e\udde0 25.6. Patr\xf3n Repository \u2014 unificar acceso sin importar la herramienta",id:"-256-patr\xf3n-repository--unificar-acceso-sin-importar-la-herramienta",level:2},{value:"\ud83e\udded 25.7. Anti-patr\xf3n N+1 \u2014 el enemigo silencioso \u26a0\ufe0f",id:"-257-anti-patr\xf3n-n1--el-enemigo-silencioso-\ufe0f",level:2},{value:"\ud83e\udde0 25.8. Buenas pr\xe1cticas al elegir enfoque",id:"-258-buenas-pr\xe1cticas-al-elegir-enfoque",level:2},{value:"\ud83d\udea8 25.9. Errores comunes",id:"-259-errores-comunes",level:2}];function t(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"modulo-25-capas-de-acceso-a-datos",children:"Modulo 25. Capas de acceso a datos"})}),"\n",(0,r.jsx)(n.h2,{id:"-251-qu\xe9-es-la-capa-de-acceso-a-datos",children:"\ud83e\udded 25.1. Qu\xe9 es la capa de acceso a datos"}),"\n",(0,r.jsx)(n.p,{children:"En una aplicaci\xf3n bien dise\xf1ada, la l\xf3gica de acceso a datos no est\xe1 dispersa en todas las funciones ni mezclada con la UI o controladores."}),"\n",(0,r.jsxs)(n.p,{children:["\ud83d\udc49 En lugar de eso, se concentra en una ",(0,r.jsx)(n.strong,{children:"capa dedicada"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[ UI / Controladores ]\n         \u2193\n[ L\xf3gica de negocio ]\n         \u2193\n[ Capa de acceso a datos ]\n         \u2193\n[ Base de datos ]\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Esta separaci\xf3n permite:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cambiar la base de datos sin reescribir toda la app."}),"\n",(0,r.jsx)(n.li,{children:"Aplicar reglas de seguridad y validaci\xf3n en un solo sitio."}),"\n",(0,r.jsx)(n.li,{children:"Reutilizar consultas complejas."}),"\n",(0,r.jsx)(n.li,{children:"Facilitar testing y mantenimiento."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\ud83d\udccc Aunque a veces se menosprecia, esta capa es ",(0,r.jsx)(n.strong,{children:"estructural"})," en cualquier app escalable."]}),"\n",(0,r.jsx)(n.h2,{id:"-252-tres-enfoques-principales",children:"\ud83e\udde0 25.2. Tres enfoques principales"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\ud83d\udcdd ",(0,r.jsx)(n.strong,{children:"Consultas SQL directas"})," (raw SQL)"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83e\uddf1 ",(0,r.jsx)(n.strong,{children:"Query Builders"})," (constructores de consultas)"]}),"\n",(0,r.jsxs)(n.li,{children:["\ud83e\udded ",(0,r.jsx)(n.strong,{children:"ORM"})," (Object Relational Mapper)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Cada uno tiene ventajas, desventajas y contextos donde brilla m\xe1s."}),"\n",(0,r.jsx)(n.h2,{id:"-253-consultas-sql-directas--control-total",children:"\ud83e\udded 25.3. Consultas SQL directas \u2014 control total"}),"\n",(0,r.jsx)(n.p,{children:"\ud83d\udc49 Escribir consultas manualmente y ejecutarlas directamente desde la app."}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"const sql = 'SELECT * FROM productos WHERE id = $1';\nconst result = await db.query(sql, [id]);\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Ventajas"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"M\xe1ximo control sobre la consulta."}),"\n",(0,r.jsx)(n.li,{children:"Muy eficiente si sabes escribir SQL optimizado."}),"\n",(0,r.jsx)(n.li,{children:"No dependes de librer\xedas externas."}),"\n",(0,r.jsx)(n.li,{children:"Ideal para consultas complejas o cr\xedticas en rendimiento."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Desventajas"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Mucho c\xf3digo repetido si no se organiza bien."}),"\n",(0,r.jsx)(n.li,{children:"Dificulta cambios de esquema si las consultas est\xe1n \u201cesparcidas\u201d."}),"\n",(0,r.jsx)(n.li,{children:"Menos abstracci\xf3n: tienes que manejar manualmente la mayor\xeda de casos."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\ud83d\udccc ",(0,r.jsx)(n.strong,{children:"Cu\xe1ndo usarlo"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Proyectos peque\xf1os o medianos."}),"\n",(0,r.jsx)(n.li,{children:"Consultas altamente personalizadas."}),"\n",(0,r.jsx)(n.li,{children:"Sitios donde se prioriza rendimiento sobre abstracci\xf3n."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-254-query-builders--estructura-sin-perder-sql",children:"\ud83e\uddf1 25.4. Query Builders \u2014 estructura sin perder SQL"}),"\n",(0,r.jsx)(n.p,{children:"\ud83d\udc49 Herramientas que permiten construir consultas SQL de forma program\xe1tica y segura, sin concatenar strings manualmente."}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo con Knex.js:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"const productos = await knex('productos')\n  .select('*')\n  .where('categoria', 'Electr\xf3nica')\n  .orderBy('precio', 'asc');\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"\ud83d\udc49 Esto genera internamente:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM productos WHERE categoria = 'Electr\xf3nica' ORDER BY precio ASC;\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Ventajas"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"M\xe1s legible y modular que SQL crudo."}),"\n",(0,r.jsx)(n.li,{children:"Parametrizaci\xf3n autom\xe1tica (segura contra inyecciones)."}),"\n",(0,r.jsx)(n.li,{children:"Reutilizable y f\xe1cil de extender."}),"\n",(0,r.jsx)(n.li,{children:"Independiente del motor (SQLite, Postgres, MySQL\u2026)."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Desventajas"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Aprendes la sintaxis de otra herramienta adem\xe1s de SQL."}),"\n",(0,r.jsx)(n.li,{children:"Consultas muy complejas pueden volverse menos claras que en SQL crudo."}),"\n",(0,r.jsx)(n.li,{children:"Algunas optimizaciones finas se pierden."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\ud83d\udccc ",(0,r.jsx)(n.strong,{children:"Cu\xe1ndo usarlo"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Proyectos medianos o grandes."}),"\n",(0,r.jsx)(n.li,{children:"Cuando quieres estructurar bien sin llegar a un ORM completo."}),"\n",(0,r.jsx)(n.li,{children:"Cuando tu equipo no es experto en SQL."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-255-orm--mapear-tablas-a-objetos",children:"\ud83e\udded 25.5. ORM \u2014 mapear tablas a objetos"}),"\n",(0,r.jsxs)(n.p,{children:["\ud83d\udc49 Un ",(0,r.jsx)(n.strong,{children:"ORM (Object Relational Mapper)"})," permite trabajar con la base de datos ",(0,r.jsx)(n.strong,{children:"como si fuera un conjunto de objetos en memoria"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo con Sequelize:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"const producto = await Producto.findByPk(1);\nconsole.log(producto.nombre);\n\nawait Producto.create({\n  nombre: 'Teclado mec\xe1nico',\n  precio: 59.90\n});\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"\ud83d\udc49 Internamente genera las consultas SQL necesarias:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM productos WHERE id = 1;\nINSERT INTO productos (nombre, precio) VALUES ('Teclado mec\xe1nico', 59.90);\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Ventajas"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Alta productividad para CRUDs sencillos."}),"\n",(0,r.jsx)(n.li,{children:"C\xf3digo m\xe1s declarativo y menos repetitivo."}),"\n",(0,r.jsxs)(n.li,{children:["Soporte para relaciones entre entidades (1",":N",", N",":N",")."]}),"\n",(0,r.jsx)(n.li,{children:"Migraciones autom\xe1ticas en algunos casos."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Desventajas"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Menor control sobre el SQL final."}),"\n",(0,r.jsx)(n.li,{children:"Puede generar consultas ineficientes si no se afina."}),"\n",(0,r.jsx)(n.li,{children:"Curva de aprendizaje de la herramienta."}),"\n",(0,r.jsx)(n.li,{children:"Dificultad con queries muy complejas."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\ud83d\udccc ",(0,r.jsx)(n.strong,{children:"Cu\xe1ndo usarlo"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Aplicaciones CRUD t\xedpicas."}),"\n",(0,r.jsx)(n.li,{children:"Equipos que prefieren trabajar con objetos antes que con SQL."}),"\n",(0,r.jsx)(n.li,{children:"Casos donde la velocidad de desarrollo prima sobre el microcontrol."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-256-patr\xf3n-repository--unificar-acceso-sin-importar-la-herramienta",children:"\ud83e\udde0 25.6. Patr\xf3n Repository \u2014 unificar acceso sin importar la herramienta"}),"\n",(0,r.jsxs)(n.p,{children:["Una buena pr\xe1ctica es ",(0,r.jsx)(n.strong,{children:"no usar SQL ni ORM directamente en controladores"}),", sino envolverlo en una ",(0,r.jsx)(n.strong,{children:"capa intermedia"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"// repos/productoRepo.js\nexport async function getById(id) {\n  return db.query('SELECT * FROM productos WHERE id = $1', [id]);\n}\n\n// controllers/productoController.js\nimport * as productoRepo from '../repos/productoRepo.js';\n\napp.get('/productos/:id', async (req, res) => {\n  const producto = await productoRepo.getById(req.params.id);\n  res.json(producto.rows[0]);\n});\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"\ud83d\udccc Esto permite:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cambiar de SQL crudo a un query builder o un ORM sin reescribir controladores."}),"\n",(0,r.jsx)(n.li,{children:"Centralizar validaciones, logging, cache y auditor\xeda."}),"\n",(0,r.jsx)(n.li,{children:"Mejor mantenimiento a largo plazo."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-257-anti-patr\xf3n-n1--el-enemigo-silencioso-\ufe0f",children:"\ud83e\udded 25.7. Anti-patr\xf3n N+1 \u2014 el enemigo silencioso \u26a0\ufe0f"}),"\n",(0,r.jsxs)(n.p,{children:["El ",(0,r.jsx)(n.strong,{children:"N+1 problem"})," aparece cuando haces:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Una consulta para obtener ",(0,r.jsx)(n.strong,{children:"una lista"})," de registros,"]}),"\n",(0,r.jsxs)(n.li,{children:["Y luego haces ",(0,r.jsx)(n.strong,{children:"una consulta adicional por cada uno"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"// \u274c Anti-patr\xf3n\nconst pedidos = await Pedido.findAll();\nfor (const pedido of pedidos) {\n  pedido.cliente = await Cliente.findByPk(pedido.clienteId);\n}\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Si hay 100 pedidos, haces:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"1 consulta inicial,"}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["100 consultas para los clientes \u2192 ",(0,r.jsx)(n.strong,{children:"101 consultas totales"})," \ud83d\ude2c"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 Soluci\xf3n: ",(0,r.jsx)(n.strong,{children:"JOINs"})," o ",(0,r.jsx)(n.strong,{children:"eager loading"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo con SQL directo:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT p.*, c.nombre\nFROM pedido p\nJOIN cliente c ON p.cliente_id = c.id;\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo con ORM (Sequelize):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"const pedidos = await Pedido.findAll({ include: Cliente });\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\ud83d\udc49 Resultado: ",(0,r.jsx)(n.strong,{children:"una sola consulta"})," que trae todos los pedidos con sus clientes."]}),"\n",(0,r.jsx)(n.h2,{id:"-258-buenas-pr\xe1cticas-al-elegir-enfoque",children:"\ud83e\udde0 25.8. Buenas pr\xe1cticas al elegir enfoque"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Usa ",(0,r.jsx)(n.strong,{children:"SQL directo"})," para consultas cr\xedticas de rendimiento o muy espec\xedficas."]}),"\n",(0,r.jsxs)(n.li,{children:["Usa ",(0,r.jsx)(n.strong,{children:"query builders"})," si quieres estructura sin perder flexibilidad."]}),"\n",(0,r.jsxs)(n.li,{children:["Usa ",(0,r.jsx)(n.strong,{children:"ORM"})," si buscas productividad en CRUDs est\xe1ndar y relaciones comunes."]}),"\n",(0,r.jsx)(n.li,{children:"Combina enfoques si es necesario (por ejemplo, ORM + SQL optimizado en casos puntuales)."}),"\n",(0,r.jsx)(n.li,{children:"Centraliza acceso a datos en repositorios o servicios dedicados."}),"\n",(0,r.jsx)(n.li,{children:"Evita el anti-patr\xf3n N+1 desde el dise\xf1o."}),"\n",(0,r.jsx)(n.li,{children:"Loguea y monitorea consultas lentas."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-259-errores-comunes",children:"\ud83d\udea8 25.9. Errores comunes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Mezclar SQL crudo en controladores y servicios sin estructura."}),"\n",(0,r.jsx)(n.li,{children:"Depender completamente de un ORM sin entender qu\xe9 SQL genera."}),"\n",(0,r.jsx)(n.li,{children:"No controlar el n\xfamero de consultas \u2192 problemas de rendimiento ocultos."}),"\n",(0,r.jsx)(n.li,{children:"No separar responsabilidades entre l\xf3gica de negocio y acceso a datos."}),"\n",(0,r.jsx)(n.li,{children:"No preparar la capa para cambios futuros de motor o librer\xeda."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var a=s(6540);const r={},i=a.createContext(r);function o(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);