"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[2741],{8453:(e,s,a)=>{a.d(s,{R:()=>l,x:()=>o});var n=a(6540);const r={},i=n.createContext(r);function l(e){const s=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),n.createElement(i.Provider,{value:s},e.children)}},9393:(e,s,a)=>{a.r(s),a.d(s,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"backend/databases/Modulo29_Vistas_materializadas_y_reportes","title":"Modulo 29. Vistas materializadas y reportes","description":"\ud83e\udded 29.1. El problema: consultas costosas repetidas","source":"@site/docs/backend/databases/Modulo29_Vistas_materializadas_y_reportes.md","sourceDirName":"backend/databases","slug":"/backend/databases/Modulo29_Vistas_materializadas_y_reportes","permalink":"/docuQuest/docs/backend/databases/Modulo29_Vistas_materializadas_y_reportes","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/databases/Modulo29_Vistas_materializadas_y_reportes.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Modulo 28. Importaci\xf3n y exportaci\xf3n fiable","permalink":"/docuQuest/docs/backend/databases/Modulo28_Importacion_y_exportacion_fiable"},"next":{"title":"Modulo 30. Copias de seguridad y recuperaci\xf3n","permalink":"/docuQuest/docs/backend/databases/Modulo30_Copias_de_seguridad_y_recuperacion"}}');var r=a(4848),i=a(8453);const l={},o="Modulo 29. Vistas materializadas y reportes",d={},c=[{value:"\ud83e\udded 29.1. El problema: consultas costosas repetidas",id:"-291-el-problema-consultas-costosas-repetidas",level:2},{value:"\ud83e\udde0 29.2. Vistas normales vs vistas materializadas",id:"-292-vistas-normales-vs-vistas-materializadas",level:2},{value:"\ud83e\udded 29.3. Refrescar vistas materializadas",id:"-293-refrescar-vistas-materializadas",level:2},{value:"\ud83e\udde0 29.4. Reportes agregados sencillos",id:"-294-reportes-agregados-sencillos",level:2},{value:"\ud83e\udded 29.5. Indexar vistas materializadas",id:"-295-indexar-vistas-materializadas",level:2},{value:"\ud83e\udde0 29.6. Automatizar refrescos programados",id:"-296-automatizar-refrescos-programados",level:2},{value:"\ud83e\udded 29.7. Control de consistencia y bloqueos",id:"-297-control-de-consistencia-y-bloqueos",level:2},{value:"\ud83e\udde0 29.8. Vistas materializadas vs tablas de reportes manuales",id:"-298-vistas-materializadas-vs-tablas-de-reportes-manuales",level:2},{value:"\ud83e\udded 29.9. Buenas pr\xe1cticas para reportes con vistas materializadas",id:"-299-buenas-pr\xe1cticas-para-reportes-con-vistas-materializadas",level:2},{value:"\ud83d\udea8 29.10. Errores comunes",id:"-2910-errores-comunes",level:2}];function t(e){const s={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"modulo-29-vistas-materializadas-y-reportes",children:"Modulo 29. Vistas materializadas y reportes"})}),"\n",(0,r.jsx)(s.h2,{id:"-291-el-problema-consultas-costosas-repetidas",children:"\ud83e\udded 29.1. El problema: consultas costosas repetidas"}),"\n",(0,r.jsx)(s.p,{children:"Imagina una tabla de pedidos de una tienda online:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"CREATE TABLE pedido (\n  id SERIAL PRIMARY KEY,\n  cliente_id INT NOT NULL,\n  total NUMERIC(10,2) NOT NULL,\n  fecha TIMESTAMP NOT NULL DEFAULT NOW()\n);\n\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Y supongamos que tenemos ",(0,r.jsx)(s.strong,{children:"miles o millones de registros"}),"."]}),"\n",(0,r.jsx)(s.p,{children:"Cada vez que el dashboard de administraci\xf3n quiere saber:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Ventas por d\xeda,"}),"\n",(0,r.jsx)(s.li,{children:"Ventas por cliente,"}),"\n",(0,r.jsx)(s.li,{children:"Promedios y totales\u2026"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["\u2026ejecuta ",(0,r.jsx)(s.strong,{children:"la misma consulta agregada"})," una y otra vez."]}),"\n",(0,r.jsx)(s.p,{children:"Ejemplo:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT DATE(fecha) AS dia, SUM(total) AS total_ventas\nFROM pedido\nGROUP BY dia\nORDER BY dia DESC;\n\n"})}),"\n",(0,r.jsxs)(s.p,{children:["\ud83d\udc49 Al principio es r\xe1pido\u2026 pero a medida que crece la tabla, esta consulta se vuelve ",(0,r.jsx)(s.strong,{children:"lenta"}),"."]}),"\n",(0,r.jsx)(s.p,{children:"\ud83d\udc49 Y si tienes 50 usuarios viendo el dashboard, la est\xe1s ejecutando 50 veces \ud83d\ude2c"}),"\n",(0,r.jsx)(s.h2,{id:"-292-vistas-normales-vs-vistas-materializadas",children:"\ud83e\udde0 29.2. Vistas normales vs vistas materializadas"}),"\n",(0,r.jsxs)(s.p,{children:["Una ",(0,r.jsx)(s.strong,{children:"vista normal"})," es b\xe1sicamente una ",(0,r.jsx)(s.strong,{children:"consulta guardada con nombre"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"CREATE VIEW ventas_por_dia AS\nSELECT DATE(fecha) AS dia, SUM(total) AS total_ventas\nFROM pedido\nGROUP BY dia;\n\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u2705 Se comporta como una tabla al consultarla:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT * FROM ventas_por_dia;\n\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\u274c Pero ",(0,r.jsx)(s.strong,{children:"se calcula en cada consulta"}),", no guarda nada."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Una ",(0,r.jsx)(s.strong,{children:"vista materializada"}),":"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Ejecuta la consulta ",(0,r.jsx)(s.strong,{children:"una sola vez"})," al crearse o refrescarse."]}),"\n",(0,r.jsx)(s.li,{children:"Guarda el resultado como si fuera una tabla."}),"\n",(0,r.jsxs)(s.li,{children:["Luego las lecturas son ",(0,r.jsx)(s.strong,{children:"instant\xe1neas"}),", incluso con millones de filas originales."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Ejemplo:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"CREATE MATERIALIZED VIEW ventas_por_dia_mv AS\nSELECT DATE(fecha) AS dia, SUM(total) AS total_ventas\nFROM pedido\nGROUP BY dia;\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"\ud83d\udc49 Cuando alguien hace:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT * FROM ventas_por_dia_mv;\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"No se recalcula nada."}),"\n",(0,r.jsxs)(s.p,{children:["Solo se ",(0,r.jsx)(s.strong,{children:"lee directamente"})," la vista precomputada."]}),"\n",(0,r.jsx)(s.p,{children:"\ud83d\udccc Esto es ideal para dashboards, reportes internos, anal\xedtica b\xe1sica y optimizaci\xf3n de consultas recurrentes."}),"\n",(0,r.jsx)(s.h2,{id:"-293-refrescar-vistas-materializadas",children:"\ud83e\udded 29.3. Refrescar vistas materializadas"}),"\n",(0,r.jsx)(s.p,{children:"Una vista materializada no se actualiza sola."}),"\n",(0,r.jsx)(s.p,{children:"Debes refrescarla cuando quieras que muestre los datos m\xe1s recientes."}),"\n",(0,r.jsx)(s.p,{children:"Ejemplo:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"REFRESH MATERIALIZED VIEW ventas_por_dia_mv;\n\n"})}),"\n",(0,r.jsxs)(s.p,{children:["\ud83d\udc49 Esto vuelve a ejecutar la consulta original y ",(0,r.jsx)(s.strong,{children:"reemplaza el contenido"})," de la vista."]}),"\n",(0,r.jsx)(s.p,{children:"\ud83d\udccc Lo habitual es programar estos refrescos:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Cada 5 minutos (si se necesita semitiempo real)."}),"\n",(0,r.jsx)(s.li,{children:"Cada hora o d\xeda (para reportes nocturnos)."}),"\n",(0,r.jsx)(s.li,{children:"Manualmente tras grandes importaciones."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"-294-reportes-agregados-sencillos",children:"\ud83e\udde0 29.4. Reportes agregados sencillos"}),"\n",(0,r.jsx)(s.p,{children:"Adem\xe1s de ventas por d\xeda, hay muchas consultas que se benefician de vistas materializadas:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Top 10 productos m\xe1s vendidos:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"CREATE MATERIALIZED VIEW top_productos_mv AS\nSELECT producto_id, COUNT(*) AS cantidad, SUM(total) AS total\nFROM pedido\nGROUP BY producto_id\nORDER BY total DESC\nLIMIT 10;\n\n"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Total de clientes activos por mes:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"CREATE MATERIALIZED VIEW clientes_activos_mes_mv AS\nSELECT DATE_TRUNC('month', fecha) AS mes, COUNT(DISTINCT cliente_id) AS clientes\nFROM pedido\nGROUP BY mes;\n\n"})}),"\n",(0,r.jsxs)(s.p,{children:["\ud83d\udc49 Ahora puedes consultar estos reportes ",(0,r.jsx)(s.strong,{children:"instant\xe1neamente"}),", sin recalcular millones de filas cada vez."]}),"\n",(0,r.jsx)(s.h2,{id:"-295-indexar-vistas-materializadas",children:"\ud83e\udded 29.5. Indexar vistas materializadas"}),"\n",(0,r.jsxs)(s.p,{children:["Otra ventaja: a diferencia de las vistas normales, las ",(0,r.jsx)(s.strong,{children:"vistas materializadas pueden tener \xedndices"}),"."]}),"\n",(0,r.jsx)(s.p,{children:"Esto mejora a\xfan m\xe1s el rendimiento."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"CREATE INDEX idx_ventas_por_dia_dia ON ventas_por_dia_mv (dia);\n\n"})}),"\n",(0,r.jsxs)(s.p,{children:["\ud83d\udc49 As\xed las consultas filtradas, ordenadas o paginadas sobre la vista ",(0,r.jsx)(s.strong,{children:"son igual de r\xe1pidas que sobre una tabla bien optimizada"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"-296-automatizar-refrescos-programados",children:"\ud83e\udde0 29.6. Automatizar refrescos programados"}),"\n",(0,r.jsx)(s.p,{children:"La mayor\xeda de escenarios reales no refrescan manualmente las vistas."}),"\n",(0,r.jsx)(s.p,{children:"Se usa:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Cron jobs,"}),"\n",(0,r.jsx)(s.li,{children:"Jobs internos del motor,"}),"\n",(0,r.jsx)(s.li,{children:"Triggers programados,"}),"\n",(0,r.jsx)(s.li,{children:"O herramientas de orquestaci\xf3n."}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Ejemplo con cron (Linux):"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:'0 * * * * psql -d tienda -c "REFRESH MATERIALIZED VIEW ventas_por_dia_mv;"\n\n'})}),"\n",(0,r.jsx)(s.p,{children:"\ud83d\udc49 Esto refresca cada hora."}),"\n",(0,r.jsx)(s.p,{children:"Ejemplo m\xe1s controlado (PostgreSQL + funci\xf3n):"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION refrescar_reportes()\nRETURNS void AS $$\nBEGIN\n  REFRESH MATERIALIZED VIEW ventas_por_dia_mv;\n  REFRESH MATERIALIZED VIEW top_productos_mv;\nEND;\n$$ LANGUAGE plpgsql;\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"\ud83d\udc49 Luego puedes llamar a:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"SELECT refrescar_reportes();\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"O programarlo como tarea."}),"\n",(0,r.jsx)(s.h2,{id:"-297-control-de-consistencia-y-bloqueos",children:"\ud83e\udded 29.7. Control de consistencia y bloqueos"}),"\n",(0,r.jsx)(s.p,{children:"Por defecto, cuando refrescas una vista materializada:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Se borra y vuelve a generar."}),"\n",(0,r.jsx)(s.li,{children:"Durante ese tiempo puede bloquear lecturas."}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Para evitar interrupciones, algunos motores permiten refrescar de forma ",(0,r.jsx)(s.strong,{children:"concurrente"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"REFRESH MATERIALIZED VIEW CONCURRENTLY ventas_por_dia_mv;\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"\ud83d\udccc Requiere \xedndices \xfanicos adecuados, pero permite refrescar sin bloquear a los usuarios que est\xe1n consultando."}),"\n",(0,r.jsx)(s.h2,{id:"-298-vistas-materializadas-vs-tablas-de-reportes-manuales",children:"\ud83e\udde0 29.8. Vistas materializadas vs tablas de reportes manuales"}),"\n",(0,r.jsxs)(s.p,{children:["Antes de que existieran vistas materializadas, muchos equipos creaban ",(0,r.jsx)(s.strong,{children:"tablas de reportes"})," y las llenaban con scripts cron."]}),"\n",(0,r.jsx)(s.p,{children:"Ejemplo tradicional:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"CREATE TABLE ventas_por_dia_reporte (...);\nDELETE FROM ventas_por_dia_reporte;\nINSERT INTO ventas_por_dia_reporte (...)\nSELECT ...\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"\ud83d\udc49 Funciona, pero:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Necesitas m\xe1s c\xf3digo de mantenimiento."}),"\n",(0,r.jsx)(s.li,{children:"Debes cuidar integridad manualmente."}),"\n",(0,r.jsx)(s.li,{children:"Es m\xe1s f\xe1cil cometer errores."}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["\ud83d\udccc Las vistas materializadas ",(0,r.jsx)(s.strong,{children:"reducen esta complejidad"}),", porque:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Encapsulan la l\xf3gica."}),"\n",(0,r.jsx)(s.li,{children:"Se refrescan de forma at\xf3mica."}),"\n",(0,r.jsx)(s.li,{children:"No requieren scripts adicionales para leer."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"-299-buenas-pr\xe1cticas-para-reportes-con-vistas-materializadas",children:"\ud83e\udded 29.9. Buenas pr\xe1cticas para reportes con vistas materializadas"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Usa vistas materializadas solo para ",(0,r.jsx)(s.strong,{children:"consultas pesadas y recurrentes"}),"."]}),"\n",(0,r.jsx)(s.li,{children:"No las refresques en exceso si no es necesario."}),"\n",(0,r.jsx)(s.li,{children:"Indexa los campos m\xe1s consultados."}),"\n",(0,r.jsx)(s.li,{children:"Documenta cu\xe1ndo y c\xf3mo se refrescan."}),"\n",(0,r.jsxs)(s.li,{children:["Usa nombres claros (",(0,r.jsx)(s.code,{children:"_mv"}),") para diferenciarlas de tablas y vistas normales."]}),"\n",(0,r.jsx)(s.li,{children:"Automatiza su refresco en un cron o job controlado."}),"\n",(0,r.jsx)(s.li,{children:"Controla bloqueos si tienes muchos usuarios concurrentes."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"-2910-errores-comunes",children:"\ud83d\udea8 29.10. Errores comunes"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Creer que una vista normal mejora rendimiento (no lo hace)."}),"\n",(0,r.jsx)(s.li,{children:"Refrescar vistas manualmente a mano en producci\xf3n \ud83d\ude2c."}),"\n",(0,r.jsx)(s.li,{children:"No indexar vistas materializadas."}),"\n",(0,r.jsx)(s.li,{children:"Refrescar con demasiada frecuencia \u2192 bloqueos y sobrecarga."}),"\n",(0,r.jsx)(s.li,{children:"No versionar la l\xf3gica de las vistas \u2192 descoordinaci\xf3n con el c\xf3digo."}),"\n",(0,r.jsx)(s.li,{children:"Confundir vistas materializadas con backups (no lo son)."}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}}}]);