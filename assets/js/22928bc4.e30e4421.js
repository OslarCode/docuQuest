"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[8889],{1171:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"backend/databases/Integridad_referencial_en_serio","title":"Integridad referencial en serio","description":"13.1. \xbfQu\xe9 es la integridad referencial?","source":"@site/docs/backend/databases/Integridad_referencial_en_serio.md","sourceDirName":"backend/databases","slug":"/backend/databases/Integridad_referencial_en_serio","permalink":"/docuQuest/docs/backend/databases/Integridad_referencial_en_serio","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/databases/Integridad_referencial_en_serio.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Claves e integridad referencial avanzada","permalink":"/docuQuest/docs/backend/databases/Claves_e_integridad_referencial_avanzada"},"next":{"title":"Validaciones al nivel correcto: dominios, restricciones y reglas de negocio en la BD","permalink":"/docuQuest/docs/backend/databases/Validaciones_al_nivel_correcto_dominios_restricciones_y_reglas_de_negocio"}}');var a=i(4848),r=i(8453);const d={},c="Integridad referencial en serio",l={},o=[{value:"13.1. \xbfQu\xe9 es la integridad referencial?",id:"131-qu\xe9-es-la-integridad-referencial",level:2},{value:"13.2. Definici\xf3n de clave for\xe1nea",id:"132-definici\xf3n-de-clave-for\xe1nea",level:2},{value:"13.3. Qu\xe9 pasa cuando se rompe la referencia",id:"133-qu\xe9-pasa-cuando-se-rompe-la-referencia",level:2},{value:"13.4. Acciones en cascada \u2014 pol\xedticas de borrado y actualizaci\xf3n",id:"134-acciones-en-cascada--pol\xedticas-de-borrado-y-actualizaci\xf3n",level:2},{value:"13.5. Ejemplo real \u2014 Biblioteca",id:"135-ejemplo-real--biblioteca",level:2},{value:"13.6. Pol\xedticas de borrado/actualizaci\xf3n \u2014 cu\xe1ndo usar cada una",id:"136-pol\xedticas-de-borradoactualizaci\xf3n--cu\xe1ndo-usar-cada-una",level:2},{value:"13.7. Pol\xedticas de actualizaci\xf3n",id:"137-pol\xedticas-de-actualizaci\xf3n",level:2},{value:"13.8. Ejemplo \u2014 Pedido y cliente con ON UPDATE CASCADE",id:"138-ejemplo--pedido-y-cliente-con-on-update-cascade",level:2},{value:"13.9. Buenas pr\xe1cticas",id:"139-buenas-pr\xe1cticas",level:2},{value:"13.10. Errores comunes",id:"1310-errores-comunes",level:2}];function t(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"integridad-referencial-en-serio",children:"Integridad referencial en serio"})}),"\n",(0,a.jsx)(n.h2,{id:"131-qu\xe9-es-la-integridad-referencial",children:"13.1. \xbfQu\xe9 es la integridad referencial?"}),"\n",(0,a.jsxs)(n.p,{children:["En una base de datos relacional, no todas las tablas viven aisladas: muchas est\xe1n ",(0,a.jsx)(n.strong,{children:"relacionadas entre s\xed"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Por ejemplo:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Un ",(0,a.jsx)(n.strong,{children:"pedido"})," est\xe1 siempre asociado a un ",(0,a.jsx)(n.strong,{children:"cliente"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["Un ",(0,a.jsx)(n.strong,{children:"pr\xe9stamo"})," de biblioteca pertenece a un ",(0,a.jsx)(n.strong,{children:"socio"})," y a un ",(0,a.jsx)(n.strong,{children:"libro"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["Una ",(0,a.jsx)(n.strong,{children:"matr\xedcula"})," se asocia a un ",(0,a.jsx)(n.strong,{children:"alumno"})," y un ",(0,a.jsx)(n.strong,{children:"curso"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["La ",(0,a.jsx)(n.strong,{children:"integridad referencial"})," es la ",(0,a.jsx)(n.strong,{children:"regla que garantiza que las relaciones entre tablas se mantengan consistentes"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Es decir:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"No puede existir un pedido sin cliente."}),"\n",(0,a.jsx)(n.li,{children:"No puede haber un pr\xe9stamo de un libro que no exista."}),"\n",(0,a.jsx)(n.li,{children:"No puedes matricularte en un curso que no est\xe1 registrado."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"T\xe9cnicamente:"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Una clave for\xe1nea (FK) en una tabla apunta a la clave primaria (PK) de otra tabla, asegurando que el valor siempre existe en la tabla referenciada."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"132-definici\xf3n-de-clave-for\xe1nea",children:"13.2. Definici\xf3n de clave for\xe1nea"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Clave for\xe1nea = restricci\xf3n que conecta dos tablas."})}),"\n",(0,a.jsxs)(n.p,{children:["La tabla que ",(0,a.jsx)(n.strong,{children:"contiene la FK"})," es la \u201ctabla hija\u201d."]}),"\n",(0,a.jsx)(n.p,{children:"La tabla referenciada es la \u201ctabla padre\u201d."}),"\n",(0,a.jsx)(n.p,{children:"Ejemplo \u2014 relaci\xf3n Cliente \u2192 Pedido:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE cliente (\n  id_cliente INT PRIMARY KEY,\n  nombre VARCHAR(100) NOT NULL\n);\n\nCREATE TABLE pedido (\n  id_pedido INT PRIMARY KEY,\n  id_cliente INT NOT NULL,\n  fecha DATE NOT NULL,\n  FOREIGN KEY (id_cliente) REFERENCES cliente(id_cliente)\n);\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"id_cliente"})," en ",(0,a.jsx)(n.code,{children:"pedido"})," ",(0,a.jsxs)(n.strong,{children:["debe existir primero en la tabla ",(0,a.jsx)(n.code,{children:"cliente"})]}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Si intentas insertar un pedido con un ",(0,a.jsx)(n.code,{children:"id_cliente"})," que no existe\u2026 \u274c la base de datos lo bloquea."]}),"\n",(0,a.jsx)(n.h2,{id:"133-qu\xe9-pasa-cuando-se-rompe-la-referencia",children:"13.3. Qu\xe9 pasa cuando se rompe la referencia"}),"\n",(0,a.jsx)(n.p,{children:"Imagina que existe un pedido:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"pedido: (id_pedido = 10, id_cliente = 5)\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Si alguien intenta borrar el cliente con ",(0,a.jsx)(n.code,{children:"id_cliente = 5"})," de la tabla ",(0,a.jsx)(n.code,{children:"cliente"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["La base de datos detecta que ",(0,a.jsx)(n.strong,{children:"hay pedidos que dependen de ese cliente"}),"."]}),"\n",(0,a.jsx)(n.li,{children:"Por defecto, no permitir\xe1 borrar (error de integridad referencial)."}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Esta protecci\xf3n evita que queden ",(0,a.jsx)(n.strong,{children:"registros \u201chu\xe9rfanos\u201d"})," en la tabla hija."]}),"\n",(0,a.jsx)(n.h2,{id:"134-acciones-en-cascada--pol\xedticas-de-borrado-y-actualizaci\xf3n",children:"13.4. Acciones en cascada \u2014 pol\xedticas de borrado y actualizaci\xf3n"}),"\n",(0,a.jsxs)(n.p,{children:["Cuando definimos una FK, podemos ",(0,a.jsx)(n.strong,{children:"decidir qu\xe9 pasa"})," si se borra o actualiza el registro padre:"]}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Acci\xf3n"}),(0,a.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsxs)(n.td,{children:[(0,a.jsx)(n.code,{children:"RESTRICT"})," / ",(0,a.jsx)(n.code,{children:"NO ACTION"})]}),(0,a.jsx)(n.td,{children:"(Por defecto) No permite borrar/actualizar si hay referencias activas."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"CASCADE"})}),(0,a.jsx)(n.td,{children:"Borra o actualiza autom\xe1ticamente los registros hijos."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"SET NULL"})}),(0,a.jsxs)(n.td,{children:["Pone en ",(0,a.jsx)(n.code,{children:"NULL"})," la FK en la tabla hija."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"SET DEFAULT"})}),(0,a.jsx)(n.td,{children:"Pone un valor por defecto definido."})]})]})]}),"\n",(0,a.jsx)(n.p,{children:"Ejemplo con acciones expl\xedcitas:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE pedido (\n  id_pedido INT PRIMARY KEY,\n  id_cliente INT,\n  fecha DATE NOT NULL,\n  FOREIGN KEY (id_cliente)\n    REFERENCES cliente(id_cliente)\n    ON DELETE SET NULL\n    ON UPDATE CASCADE\n);\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"Si borras un cliente:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Los pedidos no se borran."}),"\n",(0,a.jsxs)(n.li,{children:["Su ",(0,a.jsx)(n.code,{children:"id_cliente"})," pasa a ser ",(0,a.jsx)(n.code,{children:"NULL"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Si actualizas ",(0,a.jsx)(n.code,{children:"id_cliente"})," en la tabla ",(0,a.jsx)(n.code,{children:"cliente"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Se actualiza autom\xe1ticamente en todos los pedidos asociados."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"135-ejemplo-real--biblioteca",children:"13.5. Ejemplo real \u2014 Biblioteca"}),"\n",(0,a.jsx)(n.p,{children:"Vamos a modelar un peque\xf1o sistema de biblioteca:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"socio"}),": socios registrados."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"libro"}),": libros disponibles."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"prestamo"}),": relaci\xf3n entre socio y libro."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE socio (\n  id_socio INT PRIMARY KEY,\n  nombre VARCHAR(100) NOT NULL\n);\n\nCREATE TABLE libro (\n  id_libro INT PRIMARY KEY,\n  titulo VARCHAR(200) NOT NULL\n);\n\nCREATE TABLE prestamo (\n  id_prestamo INT PRIMARY KEY,\n  id_socio INT NOT NULL,\n  id_libro INT NOT NULL,\n  fecha_inicio DATE NOT NULL,\n  FOREIGN KEY (id_socio)\n    REFERENCES socio(id_socio)\n    ON DELETE CASCADE,\n  FOREIGN KEY (id_libro)\n    REFERENCES libro(id_libro)\n    ON DELETE RESTRICT\n);\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"Interpretaci\xf3n:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Si borras un socio \u2192 ",(0,a.jsx)(n.strong,{children:"se borran sus pr\xe9stamos"})," (CASCADE)."]}),"\n",(0,a.jsx)(n.li,{children:"Si intentas borrar un libro que est\xe1 prestado \u2192 \u274c no se permite (RESTRICT)."}),"\n",(0,a.jsx)(n.li,{children:"Esto mantiene la integridad del modelo."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"136-pol\xedticas-de-borradoactualizaci\xf3n--cu\xe1ndo-usar-cada-una",children:"13.6. Pol\xedticas de borrado/actualizaci\xf3n \u2014 cu\xe1ndo usar cada una"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Pol\xedtica"}),(0,a.jsx)(n.th,{children:"Caso t\xedpico"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsxs)(n.td,{children:[(0,a.jsx)(n.code,{children:"RESTRICT"})," / ",(0,a.jsx)(n.code,{children:"NO ACTION"})]}),(0,a.jsx)(n.td,{children:"Entidades \u201cfuertes\u201d que no deben borrarse si tienen dependencias. Ej: libro, curso"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"CASCADE"})}),(0,a.jsx)(n.td,{children:"Entidades \u201cd\xe9biles\u201d que dependen totalmente del padre. Ej: l\xedneas de pedido, pr\xe9stamos"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"SET NULL"})}),(0,a.jsx)(n.td,{children:"Para preservar datos hist\xf3ricos aunque desaparezca la relaci\xf3n. Ej: cliente eliminado pero pedido hist\xf3rico"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"SET DEFAULT"})}),(0,a.jsx)(n.td,{children:"Escenarios controlados con un valor predefinido (menos frecuente)"})]})]})]}),"\n",(0,a.jsxs)(n.p,{children:["La elecci\xf3n ",(0,a.jsx)(n.strong,{children:"no es arbitraria"}),":"]}),"\n",(0,a.jsxs)(n.p,{children:["debe basarse en la ",(0,a.jsx)(n.strong,{children:"sem\xe1ntica del negocio real"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"137-pol\xedticas-de-actualizaci\xf3n",children:"13.7. Pol\xedticas de actualizaci\xf3n"}),"\n",(0,a.jsxs)(n.p,{children:["Aunque el borrado es lo m\xe1s com\xfan, tambi\xe9n se puede definir qu\xe9 pasa si ",(0,a.jsx)(n.strong,{children:"se actualiza la PK"})," de la tabla padre:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ON UPDATE CASCADE"})," \u2192 actualiza en hijos autom\xe1ticamente."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ON UPDATE RESTRICT"})," \u2192 impide cambiar la PK si hay dependencias."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Nota: si usas ",(0,a.jsx)(n.strong,{children:"claves sustitutas"})," (autonum\xe9ricos o UUID), normalmente ",(0,a.jsx)(n.strong,{children:"no se actualizan nunca"})," \u2192 esta pol\xedtica se usa menos."]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"138-ejemplo--pedido-y-cliente-con-on-update-cascade",children:"13.8. Ejemplo \u2014 Pedido y cliente con ON UPDATE CASCADE"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE cliente (\n  id_cliente INT PRIMARY KEY,\n  nombre VARCHAR(100)\n);\n\nCREATE TABLE pedido (\n  id_pedido INT PRIMARY KEY,\n  id_cliente INT,\n  FOREIGN KEY (id_cliente)\n    REFERENCES cliente(id_cliente)\n    ON UPDATE CASCADE\n);\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Si cambias el ",(0,a.jsx)(n.code,{children:"id_cliente"})," de 5 a 10 en ",(0,a.jsx)(n.code,{children:"cliente"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"UPDATE cliente SET id_cliente = 10 WHERE id_cliente = 5;\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Autom\xe1ticamente se actualiza en ",(0,a.jsx)(n.code,{children:"pedido"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Esto ",(0,a.jsx)(n.strong,{children:"evita inconsistencias manuales"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"139-buenas-pr\xe1cticas",children:"13.9. Buenas pr\xe1cticas"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Define siempre claves for\xe1neas expl\xedcitas: no conf\xedes en \u201ccoherencia l\xf3gica\u201d."}),"\n",(0,a.jsxs)(n.li,{children:["Elige la acci\xf3n de borrado seg\xfan la ",(0,a.jsx)(n.strong,{children:"sem\xe1ntica del dominio"}),"."]}),"\n",(0,a.jsx)(n.li,{children:"Usa CASCADE con cuidado: un borrado mal planteado puede eliminar m\xe1s de lo esperado."}),"\n",(0,a.jsx)(n.li,{children:"Documenta las pol\xedticas de borrado/actualizaci\xf3n."}),"\n",(0,a.jsx)(n.li,{children:"Aseg\xfarate de que tus aplicaciones manejen bien las restricciones (errores FK)."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"1310-errores-comunes",children:"13.10. Errores comunes"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"No definir FKs \u2192 datos hu\xe9rfanos y consultas inconsistentes."}),"\n",(0,a.jsx)(n.li,{children:"Usar CASCADE sin entender su impacto."}),"\n",(0,a.jsx)(n.li,{children:"No manejar errores de FK en la aplicaci\xf3n."}),"\n",(0,a.jsx)(n.li,{children:"Cambiar manualmente PKs sin ON UPDATE."}),"\n",(0,a.jsx)(n.li,{children:"No sincronizar las decisiones de dise\xf1o con el equipo de desarrollo."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(t,{...e})}):t(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>c});var s=i(6540);const a={},r=s.createContext(a);function d(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);