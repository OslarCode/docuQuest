"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[8098],{8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>d});var s=n(6540);const a={},i=s.createContext(a);function o(e){const r=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(i.Provider,{value:r},e.children)}},9543:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>d,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"backend/JSON/paginacion","title":"Paginaci\xf3n, filtros, orden de b\xfasqueda en API usuarios","description":"Qu\xe9 a\xf1ade este m\xf3dulo","source":"@site/docs/backend/JSON/paginacion.md","sourceDirName":"backend/JSON","slug":"/backend/JSON/paginacion","permalink":"/docuQuest/docs/backend/JSON/paginacion","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/JSON/paginacion.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Cliente HTML minimo para la API","permalink":"/docuQuest/docs/backend/JSON/clienteHTTP"},"next":{"title":"Seguridad b\xe1sica y buenas pr\xe1cticas","permalink":"/docuQuest/docs/backend/JSON/seguridad"}}');var a=n(4848),i=n(8453);const o={},d="Paginaci\xf3n, filtros, orden de b\xfasqueda en API usuarios",l={},c=[{value:"Qu\xe9 a\xf1ade este m\xf3dulo",id:"qu\xe9-a\xf1ade-este-m\xf3dulo",level:2},{value:"Cambios en <code>server.js</code> (M\xf3dulo 11)",id:"cambios-en-serverjs-m\xf3dulo-11",level:2},{value:"1) Helper arriba del archivo",id:"1-helper-arriba-del-archivo",level:3},{value:"2) Reemplaza el handler <code>GET /api/usuarios</code> por esta versi\xf3n",id:"2-reemplaza-el-handler-get-apiusuarios-por-esta-versi\xf3n",level:3},{value:"Ejemplos de uso (curl)",id:"ejemplos-de-uso-curl",level:2},{value:"Lectura de metadatos desde el cliente (opcional)",id:"lectura-de-metadatos-desde-el-cliente-opcional",level:2},{value:"Decisiones de dise\xf1o y compatibilidad",id:"decisiones-de-dise\xf1o-y-compatibilidad",level:2}];function t(e){const r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"paginaci\xf3n-filtros-orden-de-b\xfasqueda-en-api-usuarios",children:"Paginaci\xf3n, filtros, orden de b\xfasqueda en API usuarios"})}),"\n",(0,a.jsx)(r.h2,{id:"qu\xe9-a\xf1ade-este-m\xf3dulo",children:"Qu\xe9 a\xf1ade este m\xf3dulo"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["B\xfasqueda por texto en ",(0,a.jsx)(r.code,{children:"nombre"})," y ",(0,a.jsx)(r.code,{children:"email"}),": ",(0,a.jsx)(r.code,{children:"?q=mario"})]}),"\n",(0,a.jsxs)(r.li,{children:["Filtros num\xe9ricos por edad: ",(0,a.jsx)(r.code,{children:"?minEdad=18&maxEdad=40"})]}),"\n",(0,a.jsxs)(r.li,{children:["Ordenaci\xf3n por campo: ",(0,a.jsx)(r.code,{children:"?sort=nombre|email|edad|fecha&order=asc|desc"})]}),"\n",(0,a.jsxs)(r.li,{children:["Paginaci\xf3n: ",(0,a.jsx)(r.code,{children:"?page=1&limit=10"})]}),"\n",(0,a.jsxs)(r.li,{children:["Metadatos en cabeceras: ",(0,a.jsx)(r.code,{children:"X-Total-Count"}),", ",(0,a.jsx)(r.code,{children:"X-Page"}),", ",(0,a.jsx)(r.code,{children:"X-Limit"}),", ",(0,a.jsx)(r.code,{children:"X-Pages"})]}),"\n",(0,a.jsxs)(r.li,{children:["Exponer cabeceras al navegador: ",(0,a.jsx)(r.code,{children:"Access-Control-Expose-Headers"})]}),"\n"]}),"\n",(0,a.jsxs)(r.p,{children:["Todo en la misma ruta ",(0,a.jsx)(r.code,{children:"GET /api/usuarios"}),"."]}),"\n",(0,a.jsxs)(r.h2,{id:"cambios-en-serverjs-m\xf3dulo-11",children:["Cambios en ",(0,a.jsx)(r.code,{children:"server.js"})," (M\xf3dulo 11)"]}),"\n",(0,a.jsxs)(r.p,{children:["Sustituye ",(0,a.jsx)(r.strong,{children:"solo"})," el bloque del handler de ",(0,a.jsx)(r.code,{children:"GET /api/usuarios"})," y a\xf1ade un peque\xf1o helper para n\xfameros. No toques el resto."]}),"\n",(0,a.jsx)(r.h3,{id:"1-helper-arriba-del-archivo",children:"1) Helper arriba del archivo"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-jsx",children:"function asInt(value, fallback) {\r\n  const n = Number(value);\r\n  return Number.isInteger(n) && n >= 0 ? n : fallback;\r\n}\n"})}),"\n",(0,a.jsxs)(r.h3,{id:"2-reemplaza-el-handler-get-apiusuarios-por-esta-versi\xf3n",children:["2) Reemplaza el handler ",(0,a.jsx)(r.code,{children:"GET /api/usuarios"})," por esta versi\xf3n"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-jsx",children:'// 1) GET /api/usuarios  (con b\xfasqueda, filtros, orden y paginaci\xf3n)\r\nif (method === "GET" && url.pathname === "/api/usuarios") {\r\n  const usuarios = await readJsonArray();\r\n\r\n  // Query params\r\n  const q = (url.searchParams.get("q") || "").toLowerCase().trim();\r\n  const minEdad = url.searchParams.get("minEdad");\r\n  const maxEdad = url.searchParams.get("maxEdad");\r\n  const sort = (url.searchParams.get("sort") || "").trim(); // nombre|email|edad|fecha\r\n  const order = (url.searchParams.get("order") || "asc").toLowerCase(); // asc|desc\r\n  const page = asInt(url.searchParams.get("page"), 0); // 0 = sin paginar\r\n  const limit = asInt(url.searchParams.get("limit"), 0); // 0 = sin paginar\r\n\r\n  // Si no hay par\xe1metros, devuelve el array completo como siempre (compatibilidad)\r\n  const noParams = !q && !minEdad && !maxEdad && !sort && !page && !limit;\r\n\r\n  if (noParams) {\r\n    return sendJson(res, 200, usuarios);\r\n  }\r\n\r\n  // 1) B\xdaSQUEDA (q en nombre o email)\r\n  let list = usuarios;\r\n  if (q) {\r\n    list = list.filter((u) => {\r\n      const n = String(u.nombre ?? "").toLowerCase();\r\n      const e = String(u.email ?? "").toLowerCase();\r\n      return n.includes(q) || e.includes(q);\r\n    });\r\n  }\r\n\r\n  // 2) FILTROS num\xe9ricos por edad\r\n  if (minEdad !== null) {\r\n    const min = Number(minEdad);\r\n    if (!Number.isNaN(min)) list = list.filter((u) => Number(u.edad) >= min);\r\n  }\r\n  if (maxEdad !== null) {\r\n    const max = Number(maxEdad);\r\n    if (!Number.isNaN(max)) list = list.filter((u) => Number(u.edad) <= max);\r\n  }\r\n\r\n  // 3) ORDENACI\xd3N segura (whitelist de campos)\r\n  const allowedSort = new Set(["nombre", "email", "edad", "fecha"]);\r\n  if (allowedSort.has(sort)) {\r\n    const dir = order === "desc" ? -1 : 1;\r\n    list = list.slice().sort((a, b) => {\r\n      const va = a[sort];\r\n      const vb = b[sort];\r\n      // Comparaci\xf3n robusta\r\n      if (va == null && vb == null) return 0;\r\n      if (va == null) return 1;\r\n      if (vb == null) return -1;\r\n      if (typeof va === "number" && typeof vb === "number")\r\n        return (va - vb) * dir;\r\n      return String(va).localeCompare(String(vb)) * dir;\r\n    });\r\n  }\r\n\r\n  // 4) PAGINACI\xd3N\r\n  const total = list.length;\r\n  let sliced = list;\r\n\r\n  if (page && limit) {\r\n    const start = (page - 1) * limit;\r\n    const end = start + limit;\r\n    sliced = list.slice(start, end);\r\n    // Cabeceras de metadatos\r\n    const pages = Math.max(1, Math.ceil(total / limit));\r\n    res.setHeader("X-Total-Count", String(total));\r\n    res.setHeader("X-Page", String(page));\r\n    res.setHeader("X-Limit", String(limit));\r\n    res.setHeader("X-Pages", String(pages));\r\n    // Asegurar que el navegador puede leer estas cabeceras\r\n    res.setHeader(\r\n      "Access-Control-Expose-Headers",\r\n      "X-Total-Count,X-Page,X-Limit,X-Pages"\r\n    );\r\n  }\r\n\r\n  return sendJson(res, 200, sliced);\r\n}\n'})}),"\n",(0,a.jsxs)(r.blockquote,{children:["\n",(0,a.jsx)(r.p,{children:"Nota: sendJson ya agrega CORS b\xe1sico. Aqu\xed solo exponemos cabeceras extra si hay paginaci\xf3n."}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"ejemplos-de-uso-curl",children:"Ejemplos de uso (curl)"}),"\n",(0,a.jsx)(r.p,{children:"Listar todo (como antes, sin cambios):"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:'curl "http://localhost:3000/api/usuarios"\r\n\n'})}),"\n",(0,a.jsx)(r.p,{children:"Buscar por texto:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:'curl "http://localhost:3000/api/usuarios?q=peach"\r\n\n'})}),"\n",(0,a.jsx)(r.p,{children:"Filtrar por edad:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:'curl "http://localhost:3000/api/usuarios?minEdad=30&maxEdad=40"\r\n\n'})}),"\n",(0,a.jsx)(r.p,{children:"Ordenar por nombre descendente:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:'curl "http://localhost:3000/api/usuarios?sort=nombre&order=desc"\r\n\n'})}),"\n",(0,a.jsx)(r.p,{children:"Paginaci\xf3n simple (p\xe1gina 2, 2 por p\xe1gina):"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:'curl -i "http://localhost:3000/api/usuarios?page=2&limit=2"\r\n\n'})}),"\n",(0,a.jsx)(r.p,{children:"F\xedjate en las cabeceras:"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.code,{children:"X-Total-Count"})}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.code,{children:"X-Page"})}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.code,{children:"X-Limit"})}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.code,{children:"X-Pages"})}),"\n"]}),"\n",(0,a.jsx)(r.p,{children:"Paginaci\xf3n + b\xfasqueda + orden:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{children:'curl -i "http://localhost:3000/api/usuarios?q=a&sort=edad&order=asc&page=1&limit=3"\r\n\n'})}),"\n",(0,a.jsx)(r.h2,{id:"lectura-de-metadatos-desde-el-cliente-opcional",children:"Lectura de metadatos desde el cliente (opcional)"}),"\n",(0,a.jsx)(r.p,{children:"Si quieres, en el cliente del M\xf3dulo 12 puedes leer cabeceras as\xed:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-jsx",children:'const res = await fetch("/api/usuarios?page=1&limit=5");\r\nconst data = await res.json();\r\nconst total = Number(res.headers.get("X-Total-Count"));\r\nconst page = Number(res.headers.get("X-Page"));\r\nconst pages = Number(res.headers.get("X-Pages"));\n'})}),"\n",(0,a.jsx)(r.p,{children:"Con esto puedes dibujar botones de paginaci\xf3n y mostrar un \u201ctotal de registros\u201d sin cambiar el formato del cuerpo (sigue siendo un array)."}),"\n",(0,a.jsx)(r.h2,{id:"decisiones-de-dise\xf1o-y-compatibilidad",children:"Decisiones de dise\xf1o y compatibilidad"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Compatibilidad total"})," con el cliente previo: sin par\xe1metros, la ruta responde con el array completo."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Cabeceras de metadatos"})," en lugar de cambiar el cuerpo a ",(0,a.jsx)(r.code,{children:"{ data, meta }"}),"."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Ordenaci\xf3n segura"})," con lista blanca de campos (",(0,a.jsx)(r.code,{children:"nombre"}),", ",(0,a.jsx)(r.code,{children:"email"}),", ",(0,a.jsx)(r.code,{children:"edad"}),", ",(0,a.jsx)(r.code,{children:"fecha"}),") para evitar sorpresas."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"B\xfasqueda sensible a min\xfasculas/may\xfasculas normalizada"})," a min\xfasculas de forma simple."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.strong,{children:"Filtros robustos"})," con conversiones num\xe9ricas seguras."]}),"\n"]})]})}function u(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(t,{...e})}):t(e)}}}]);