"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[4243],{5843:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"backend/databases/Validaciones_al_nivel_correcto_dominios_restricciones_y_reglas_de_negocio","title":"Validaciones al nivel correcto: dominios, restricciones y reglas de negocio en la BD","description":"14.1. Por qu\xe9 validar en la base de datos","source":"@site/docs/backend/databases/Validaciones_al_nivel_correcto_dominios_restricciones_y_reglas_de_negocio.md","sourceDirName":"backend/databases","slug":"/backend/databases/Validaciones_al_nivel_correcto_dominios_restricciones_y_reglas_de_negocio","permalink":"/docuQuest/docs/backend/databases/Validaciones_al_nivel_correcto_dominios_restricciones_y_reglas_de_negocio","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/databases/Validaciones_al_nivel_correcto_dominios_restricciones_y_reglas_de_negocio.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Integridad referencial en serio","permalink":"/docuQuest/docs/backend/databases/Integridad_referencial_en_serio"},"next":{"title":"Tipos de dominios pr\xe1cticos","permalink":"/docuQuest/docs/backend/databases/Tipos_de_dominios_practicos"}}');var a=s(4848),r=s(8453);const o={},c="Validaciones al nivel correcto: dominios, restricciones y reglas de negocio en la BD",d={},l=[{value:"14.1. Por qu\xe9 validar en la base de datos",id:"141-por-qu\xe9-validar-en-la-base-de-datos",level:2},{value:"14.2. Tipos de restricciones que podemos aplicar",id:"142-tipos-de-restricciones-que-podemos-aplicar",level:2},{value:"14.3. Restricciones b\xe1sicas: <code>NOT NULL</code> y <code>UNIQUE</code>",id:"143-restricciones-b\xe1sicas-not-null-y-unique",level:2},{value:"Ejemplo \u2014 tabla de clientes",id:"ejemplo--tabla-de-clientes",level:3},{value:"14.4. Restricciones con <code>CHECK</code> \u2014 validaciones condicionales",id:"144-restricciones-con-check--validaciones-condicionales",level:2},{value:"Ejemplo \u2014 precios de productos",id:"ejemplo--precios-de-productos",level:3},{value:"Ejemplo \u2014 valores predefinidos",id:"ejemplo--valores-predefinidos",level:3},{value:"14.5. Valores por defecto con <code>DEFAULT</code>",id:"145-valores-por-defecto-con-default",level:2},{value:"14.6. Dominios: tipos personalizados con reglas incorporadas",id:"146-dominios-tipos-personalizados-con-reglas-incorporadas",level:2},{value:"14.7. Triggers y validaciones complejas",id:"147-triggers-y-validaciones-complejas",level:2},{value:"14.8. Validaciones combinadas",id:"148-validaciones-combinadas",level:2},{value:"14.9. D\xf3nde poner cada validaci\xf3n",id:"149-d\xf3nde-poner-cada-validaci\xf3n",level:2},{value:"14.10. Buenas pr\xe1cticas",id:"1410-buenas-pr\xe1cticas",level:2},{value:"14.11. Errores comunes",id:"1411-errores-comunes",level:2}];function t(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"validaciones-al-nivel-correcto-dominios-restricciones-y-reglas-de-negocio-en-la-bd",children:"Validaciones al nivel correcto: dominios, restricciones y reglas de negocio en la BD"})}),"\n",(0,a.jsx)(n.h2,{id:"141-por-qu\xe9-validar-en-la-base-de-datos",children:"14.1. Por qu\xe9 validar en la base de datos"}),"\n",(0,a.jsx)(n.p,{children:"En muchas aplicaciones, toda la validaci\xf3n se hace \u201cen el backend\u201d o incluso en el frontend."}),"\n",(0,a.jsxs)(n.p,{children:["Eso ",(0,a.jsx)(n.strong,{children:"no es suficiente"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Si alguien:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"inserta datos desde otro sistema,"}),"\n",(0,a.jsx)(n.li,{children:"usa un script,"}),"\n",(0,a.jsxs)(n.li,{children:["o explota un error en la app\u2026\npuede ",(0,a.jsx)(n.strong,{children:"romper las reglas"})," de negocio si estas no est\xe1n definidas en la base."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Las ",(0,a.jsx)(n.strong,{children:"restricciones y validaciones al nivel de la base de datos"})," son la ",(0,a.jsx)(n.strong,{children:"\xfaltima l\xednea de defensa"}),"."]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"\u201cSi es una regla estructural e inmutable, deber\xeda estar en la base, no en la l\xf3gica de la app.\u201d"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"142-tipos-de-restricciones-que-podemos-aplicar",children:"14.2. Tipos de restricciones que podemos aplicar"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Tipo"}),(0,a.jsx)(n.th,{children:"Qu\xe9 garantiza"}),(0,a.jsx)(n.th,{children:"Ejemplo pr\xe1ctico"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"NOT NULL"})}),(0,a.jsx)(n.td,{children:"Que un campo no quede vac\xedo"}),(0,a.jsx)(n.td,{children:"nombre de cliente"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"UNIQUE"})}),(0,a.jsx)(n.td,{children:"Que un valor no se repita"}),(0,a.jsx)(n.td,{children:"correo electr\xf3nico"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"CHECK"})}),(0,a.jsx)(n.td,{children:"Que un valor cumpla una condici\xf3n l\xf3gica"}),(0,a.jsx)(n.td,{children:"precio >= 0"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"DEFAULT"})}),(0,a.jsx)(n.td,{children:"Que haya un valor por defecto cuando no se especifica"}),(0,a.jsx)(n.td,{children:"fecha actual"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"FOREIGN KEY"})}),(0,a.jsx)(n.td,{children:"Que exista en otra tabla (ya visto en M13)"}),(0,a.jsx)(n.td,{children:"id_cliente"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Dominios"})}),(0,a.jsx)(n.td,{children:"Tipos personalizados con reglas"}),(0,a.jsx)(n.td,{children:"email v\xe1lido, DNI, etc."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Triggers / reglas"})}),(0,a.jsx)(n.td,{children:"Validaciones m\xe1s complejas"}),(0,a.jsx)(n.td,{children:"l\xedmite de pr\xe9stamos por socio, stock m\xednimo"})]})]})]}),"\n",(0,a.jsxs)(n.h2,{id:"143-restricciones-b\xe1sicas-not-null-y-unique",children:["14.3. Restricciones b\xe1sicas: ",(0,a.jsx)(n.code,{children:"NOT NULL"})," y ",(0,a.jsx)(n.code,{children:"UNIQUE"})]}),"\n",(0,a.jsx)(n.p,{children:"Estas son las m\xe1s simples y tambi\xe9n las m\xe1s olvidadas."}),"\n",(0,a.jsx)(n.h3,{id:"ejemplo--tabla-de-clientes",children:"Ejemplo \u2014 tabla de clientes"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE cliente (\n  id_cliente SERIAL PRIMARY KEY,\n  nombre VARCHAR(100) NOT NULL,\n  correo VARCHAR(150) UNIQUE NOT NULL\n);\n\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"NOT NULL"})," evita que se creen clientes sin nombre ni correo."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"UNIQUE"})," garantiza que no se repita el correo electr\xf3nico."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Si intentas:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"INSERT INTO cliente (nombre, correo) VALUES ('Ana', NULL);\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Error inmediato: violaci\xf3n de ",(0,a.jsx)(n.code,{children:"NOT NULL"}),"."]}),"\n",(0,a.jsxs)(n.h2,{id:"144-restricciones-con-check--validaciones-condicionales",children:["14.4. Restricciones con ",(0,a.jsx)(n.code,{children:"CHECK"})," \u2014 validaciones condicionales"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"CHECK"})," permite imponer ",(0,a.jsx)(n.strong,{children:"reglas l\xf3gicas directas"})," sobre un campo o combinaci\xf3n de campos."]}),"\n",(0,a.jsx)(n.h3,{id:"ejemplo--precios-de-productos",children:"Ejemplo \u2014 precios de productos"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE producto (\n  id_producto SERIAL PRIMARY KEY,\n  nombre VARCHAR(100) NOT NULL,\n  precio NUMERIC(10,2) NOT NULL CHECK (precio >= 0)\n);\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"Si alguien intenta insertar un precio negativo:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"INSERT INTO producto (nombre, precio) VALUES ('Taza', -5.50);\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"La base lo bloquea autom\xe1ticamente."}),"\n",(0,a.jsx)(n.h3,{id:"ejemplo--valores-predefinidos",children:"Ejemplo \u2014 valores predefinidos"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE pedido (\n  id_pedido SERIAL PRIMARY KEY,\n  estado VARCHAR(20) CHECK (estado IN ('pendiente', 'enviado', 'cancelado'))\n);\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"No se puede insertar otro estado distinto a los previstos."}),"\n",(0,a.jsxs)(n.h2,{id:"145-valores-por-defecto-con-default",children:["14.5. Valores por defecto con ",(0,a.jsx)(n.code,{children:"DEFAULT"})]}),"\n",(0,a.jsxs)(n.p,{children:["Los ",(0,a.jsx)(n.code,{children:"DEFAULT"})," simplifican el c\xf3digo de inserci\xf3n y evitan campos nulos innecesarios."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE pedido (\n  id_pedido SERIAL PRIMARY KEY,\n  fecha TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  estado VARCHAR(20) NOT NULL DEFAULT 'pendiente'\n);\n\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Si no se especifica ",(0,a.jsx)(n.code,{children:"fecha"})," \u2192 se inserta la actual."]}),"\n",(0,a.jsxs)(n.li,{children:["Si no se especifica ",(0,a.jsx)(n.code,{children:"estado"})," \u2192 queda \u201cpendiente\u201d."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Esto ",(0,a.jsx)(n.strong,{children:"reduce errores en el c\xf3digo de la aplicaci\xf3n"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"146-dominios-tipos-personalizados-con-reglas-incorporadas",children:"14.6. Dominios: tipos personalizados con reglas incorporadas"}),"\n",(0,a.jsxs)(n.p,{children:["Algunos motores (como PostgreSQL) permiten crear ",(0,a.jsx)(n.strong,{children:"dominios"}),", es decir, tipos de datos que ya incluyen restricciones."]}),"\n",(0,a.jsx)(n.p,{children:"Ideal para valores que se repiten en muchas tablas (email, DNI, etc.)."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE DOMAIN email_valido AS VARCHAR(255)\n  CHECK (VALUE ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$');\n\nCREATE TABLE usuario (\n  id_usuario SERIAL PRIMARY KEY,\n  correo email_valido UNIQUE\n);\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"Cada vez que insertes un correo, se valida autom\xe1ticamente."}),"\n",(0,a.jsxs)(n.p,{children:["Y puedes usar ",(0,a.jsx)(n.code,{children:"email_valido"})," en cualquier otra tabla sin repetir la expresi\xf3n."]}),"\n",(0,a.jsx)(n.h2,{id:"147-triggers-y-validaciones-complejas",children:"14.7. Triggers y validaciones complejas"}),"\n",(0,a.jsxs)(n.p,{children:["Cuando las restricciones b\xe1sicas no bastan, puedes usar ",(0,a.jsx)(n.strong,{children:"triggers"})," para validar reglas m\xe1s elaboradas."]}),"\n",(0,a.jsx)(n.p,{children:"Ejemplo \u2014 biblioteca: un socio no puede tener m\xe1s de 5 pr\xe9stamos activos."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION validar_limite_prestamos()\nRETURNS TRIGGER AS $$\nDECLARE\n  prestamos_activos INT;\nBEGIN\n  SELECT COUNT(*) INTO prestamos_activos\n  FROM prestamo\n  WHERE id_socio = NEW.id_socio\n    AND estado = 'activo';\n\n  IF prestamos_activos >= 5 THEN\n    RAISE EXCEPTION 'El socio % ya tiene 5 pr\xe9stamos activos', NEW.id_socio;\n  END IF;\n\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER trigger_limite_prestamos\nBEFORE INSERT ON prestamo\nFOR EACH ROW\nEXECUTE FUNCTION validar_limite_prestamos();\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Esto asegura que aunque la app falle, la BD ",(0,a.jsx)(n.strong,{children:"nunca permita m\xe1s de 5 pr\xe9stamos activos por socio"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"148-validaciones-combinadas",children:"14.8. Validaciones combinadas"}),"\n",(0,a.jsx)(n.p,{children:"Puedes mezclar restricciones para reforzar la calidad:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE alumno (\n  id_alumno SERIAL PRIMARY KEY,\n  nombre VARCHAR(100) NOT NULL,\n  dni VARCHAR(15) UNIQUE NOT NULL,\n  edad INT CHECK (edad BETWEEN 18 AND 120)\n);\n\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"NOT NULL"})," para nombre y DNI"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"UNIQUE"})," para DNI"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"CHECK"})," para edad"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Este tipo de modelo reduce much\xedsimo la necesidad de validaciones redundantes en la app."}),"\n",(0,a.jsx)(n.h2,{id:"149-d\xf3nde-poner-cada-validaci\xf3n",children:"14.9. D\xf3nde poner cada validaci\xf3n"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Tipo de regla"}),(0,a.jsx)(n.th,{children:"Lugar adecuado"}),(0,a.jsx)(n.th,{children:"Ejemplo"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Estructural, inmutable"}),(0,a.jsx)(n.td,{children:"Base de datos"}),(0,a.jsx)(n.td,{children:"DNI \xfanico, edad m\xednima, FK obligatoria"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"De negocio estable"}),(0,a.jsx)(n.td,{children:"Base de datos o capa mixta"}),(0,a.jsx)(n.td,{children:"L\xedmite de pr\xe9stamos, stock m\xednimo"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Temporal, din\xe1mica o contextual"}),(0,a.jsx)(n.td,{children:"Aplicaci\xf3n (backend/frontend)"}),(0,a.jsx)(n.td,{children:"Promociones, reglas que cambian cada semana"})]})]})]}),"\n",(0,a.jsx)(n.p,{children:"Regla pr\xe1ctica:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Si ",(0,a.jsx)(n.strong,{children:"romper la regla corrompe datos"})," \u2192 ponla en la base."]}),"\n",(0,a.jsxs)(n.li,{children:["Si ",(0,a.jsx)(n.strong,{children:"romper la regla solo afecta la l\xf3gica temporal"})," \u2192 puede ir en la aplicaci\xf3n."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"1410-buenas-pr\xe1cticas",children:"14.10. Buenas pr\xe1cticas"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Usa restricciones b\xe1sicas (",(0,a.jsx)(n.code,{children:"NOT NULL"}),", ",(0,a.jsx)(n.code,{children:"CHECK"}),", ",(0,a.jsx)(n.code,{children:"UNIQUE"}),") siempre que puedas."]}),"\n",(0,a.jsx)(n.li,{children:"Usa dominios para patrones repetidos."}),"\n",(0,a.jsxs)(n.li,{children:["Mant\xe9n triggers ",(0,a.jsx)(n.strong,{children:"solo para reglas que no pueden expresarse como restricciones"}),"."]}),"\n",(0,a.jsx)(n.li,{children:"Documenta todas las reglas en un diccionario de datos."}),"\n",(0,a.jsxs)(n.li,{children:["Valida primero en la aplicaci\xf3n por usabilidad, pero ",(0,a.jsx)(n.strong,{children:"refuerza en la base por seguridad"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"1411-errores-comunes",children:"14.11. Errores comunes"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"No definir restricciones, confiando en la app."}),"\n",(0,a.jsx)(n.li,{children:"Repetir la misma validaci\xf3n en muchas tablas sin dominios."}),"\n",(0,a.jsxs)(n.li,{children:["Usar triggers para reglas simples que podr\xedan ser ",(0,a.jsx)(n.code,{children:"CHECK"}),"."]}),"\n",(0,a.jsx)(n.li,{children:"No manejar adecuadamente las excepciones de validaci\xf3n en el backend."}),"\n",(0,a.jsx)(n.li,{children:"No actualizar reglas cuando cambia el negocio."}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var i=s(6540);const a={},r=i.createContext(a);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);