"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[6911],{8453:(r,e,n)=>{n.d(e,{R:()=>o,x:()=>c});var s=n(6540);const t={},a=s.createContext(t);function o(r){const e=s.useContext(a);return s.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function c(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(t):r.components||t:o(r.components),s.createElement(a.Provider,{value:e},r.children)}},8779:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>i,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"backend/JSON/consumirJSON","title":"Consumir JSON con fetch()","description":"Qu\xe9 vas a hacer","source":"@site/docs/backend/JSON/consumirJSON.md","sourceDirName":"backend/JSON","slug":"/backend/JSON/consumirJSON","permalink":"/docuQuest/docs/backend/JSON/consumirJSON","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/JSON/consumirJSON.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Manipular JSON desde formularios HTML con Node.js","permalink":"/docuQuest/docs/backend/JSON/manipularJSON"},"next":{"title":"Actualizar y eliminar datos en archivos JSON con Node.js","permalink":"/docuQuest/docs/backend/JSON/actualizarEliminar"}}');var t=n(4848),a=n(8453);const o={},c="Consumir JSON con fetch()",i={},d=[{value:"Qu\xe9 vas a hacer",id:"qu\xe9-vas-a-hacer",level:2},{value:"Estructura de archivos",id:"estructura-de-archivos",level:2},{value:"Paso 1: <code>usuarios.json</code>",id:"paso-1-usuariosjson",level:2},{value:"Paso 2: <code>server.js</code> (Node HTTP b\xe1sico)",id:"paso-2-serverjs-node-http-b\xe1sico",level:2},{value:"Paso 3: <code>public/index.html</code> (HTML + JS con <code>fetch()</code>)",id:"paso-3-publicindexhtml-html--js-con-fetch",level:2},{value:"C\xf3mo ejecutar",id:"c\xf3mo-ejecutar",level:2},{value:"Qu\xe9 has aprendido",id:"qu\xe9-has-aprendido",level:2}];function l(r){const e={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...r.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"consumir-json-con-fetch",children:"Consumir JSON con fetch()"})}),"\n",(0,t.jsx)(e.h2,{id:"qu\xe9-vas-a-hacer",children:"Qu\xe9 vas a hacer"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Crear un endpoint local que devuelve JSON desde un archivo."}),"\n",(0,t.jsxs)(e.li,{children:["Consumir ese endpoint con ",(0,t.jsx)(e.code,{children:"fetch()"})," desde el navegador."]}),"\n",(0,t.jsx)(e.li,{children:"Renderizar resultados sin recargar la p\xe1gina."}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"estructura-de-archivos",children:"Estructura de archivos"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"json-fetch/\r\n\u251c\u2500\u2500 public/\r\n\u2502   \u2514\u2500\u2500 index.html      \u2190 Interfaz y JS con fetch\r\n\u251c\u2500\u2500 usuarios.json       \u2190 Datos simulados en JSON\r\n\u2514\u2500\u2500 server.js           \u2190 Servidor HTTP nativo (sin Express)\r\n\n"})}),"\n",(0,t.jsxs)(e.h2,{id:"paso-1-usuariosjson",children:["Paso 1: ",(0,t.jsx)(e.code,{children:"usuarios.json"})]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-json",children:'[\r\n  { "id": 1, "nombre": "Mario", "email": "mario@nintendo.com", "edad": 35 },\r\n  { "id": 2, "nombre": "Luigi", "email": "luigi@nintendo.com", "edad": 34 },\r\n  { "id": 3, "nombre": "Peach", "email": "peach@nintendo.com", "edad": 28 }\r\n]\n'})}),"\n",(0,t.jsxs)(e.h2,{id:"paso-2-serverjs-node-http-b\xe1sico",children:["Paso 2: ",(0,t.jsx)(e.code,{children:"server.js"})," (Node HTTP b\xe1sico)"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-jsx",children:'// server.js\r\nimport http from "node:http";\r\nimport { readFile, access } from "node:fs/promises";\r\nimport { constants, createReadStream } from "node:fs";\r\nimport path from "node:path";\r\nimport { fileURLToPath } from "node:url";\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\nconst PORT = 3000;\r\nconst PUBLIC_DIR = path.join(__dirname, "public");\r\nconst DATA_FILE = path.join(__dirname, "usuarios.json");\r\n\r\nasync function exists(p) {\r\n  try {\r\n    await access(p, constants.F_OK);\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nasync function leerUsuarios() {\r\n  if (!(await exists(DATA_FILE))) return [];\r\n  const txt = await readFile(DATA_FILE, "utf8");\r\n  if (!txt.trim()) return [];\r\n  try {\r\n    return JSON.parse(txt);\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nfunction serveIndex(res) {\r\n  const filePath = path.join(PUBLIC_DIR, "index.html");\r\n  res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });\r\n  createReadStream(filePath).pipe(res);\r\n}\r\n\r\nconst server = http.createServer(async (req, res) => {\r\n  try {\r\n    const url = new URL(req.url, `http://${req.headers.host}`);\r\n\r\n    if (req.method === "GET" && url.pathname === "/") {\r\n      return serveIndex(res);\r\n    }\r\n\r\n    if (req.method === "GET" && url.pathname === "/api/usuarios") {\r\n      const usuarios = await leerUsuarios();\r\n      res.writeHead(200, { "Content-Type": "application/json; charset=utf-8" });\r\n      return res.end(JSON.stringify(usuarios));\r\n    }\r\n\r\n    res.writeHead(404, { "Content-Type": "text/plain; charset=utf-8" });\r\n    res.end("No encontrado");\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.writeHead(500, { "Content-Type": "text/plain; charset=utf-8" });\r\n    res.end("Error interno del servidor");\r\n  }\r\n});\r\n\r\nserver.listen(PORT, () => {\r\n  console.log(`Servidor en http://localhost:${PORT}`);\r\n});\n'})}),"\n",(0,t.jsxs)(e.h2,{id:"paso-3-publicindexhtml-html--js-con-fetch",children:["Paso 3: ",(0,t.jsx)(e.code,{children:"public/index.html"})," (HTML + JS con ",(0,t.jsx)(e.code,{children:"fetch()"}),")"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-html",children:'<!DOCTYPE html>\r\n<html lang="es">\r\n  <head>\r\n    <meta charset="UTF-8" />\r\n    <title>Usuarios con Fetch y JSON (Node)</title>\r\n    <meta name="viewport" content="width=device-width, initial-scale=1" />\r\n    <link\r\n      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"\r\n      rel="stylesheet"\r\n    />\r\n  </head>\r\n  <body>\r\n    <div class="container py-5">\r\n      <h1 class="mb-4 text-primary">Usuarios cargados con fetch()</h1>\r\n      <div class="mb-3">\r\n        <button class="btn btn-success" id="btn-cargar">Cargar usuarios</button>\r\n      </div>\r\n      <div id="usuarios" class="row g-4"></div>\r\n    </div>\r\n\r\n    <script>\r\n      const contenedor = document.getElementById("usuarios");\r\n      document\r\n        .getElementById("btn-cargar")\r\n        .addEventListener("click", cargarUsuarios);\r\n      window.addEventListener("DOMContentLoaded", cargarUsuarios);\r\n\r\n      async function cargarUsuarios() {\r\n        try {\r\n          const res = await fetch("/api/usuarios");\r\n          if (!res.ok) throw new Error("Respuesta no OK");\r\n          const usuarios = await res.json();\r\n          renderUsuarios(usuarios);\r\n        } catch (err) {\r\n          console.error("Error al cargar usuarios:", err);\r\n          contenedor.innerHTML = `<div class="alert alert-danger">Error al cargar usuarios.</div>`;\r\n        }\r\n      }\r\n\r\n      function renderUsuarios(usuarios) {\r\n        contenedor.innerHTML = usuarios\r\n          .map(\r\n            (u) => `\r\n        <div class="col-md-4">\r\n          <div class="card shadow">\r\n            <div class="card-body">\r\n              <h5 class="card-title">${escapeHtml(u.nombre)}</h5>\r\n              <p class="card-text">\r\n                Correo: ${escapeHtml(u.email)}<br>\r\n                Edad: ${Number(u.edad)}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      `\r\n          )\r\n          .join("");\r\n      }\r\n\r\n      function escapeHtml(str) {\r\n        return String(str)\r\n          .replaceAll("&", "&amp;")\r\n          .replaceAll("<", "&lt;")\r\n          .replaceAll(">", "&gt;")\r\n          .replaceAll(\'"\', "&quot;")\r\n          .replaceAll("\'", "&#039;");\r\n      }\r\n    <\/script>\r\n  </body>\r\n</html>\n'})}),"\n",(0,t.jsx)(e.h2,{id:"c\xf3mo-ejecutar",children:"C\xf3mo ejecutar"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Crea la estructura tal cual y coloca los archivos."}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Ejecuta:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"node server.js\r\n\n"})}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Abre:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"http://localhost:3000\r\n\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"qu\xe9-has-aprendido",children:"Qu\xe9 has aprendido"}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Acci\xf3n"}),(0,t.jsx)(e.th,{children:"C\xf3mo se hace"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Exponer datos JSON locales"}),(0,t.jsxs)(e.td,{children:["Endpoint GET ",(0,t.jsx)(e.code,{children:"/api/usuarios"})," leyendo ",(0,t.jsx)(e.code,{children:"usuarios.json"})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Consumir JSON desde el navegador"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.code,{children:'fetch("/api/usuarios").then(...).catch(...)'})})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Render din\xe1mico sin recargar"}),(0,t.jsx)(e.td,{children:"Construcci\xf3n de tarjetas con JS y Bootstrap"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Manejo simple de errores"}),(0,t.jsxs)(e.td,{children:["Comprobaci\xf3n de ",(0,t.jsx)(e.code,{children:"res.ok"})," y ",(0,t.jsx)(e.code,{children:"try/catch"})]})]})]})]})]})}function u(r={}){const{wrapper:e}={...(0,a.R)(),...r.components};return e?(0,t.jsx)(e,{...r,children:(0,t.jsx)(l,{...r})}):l(r)}}}]);