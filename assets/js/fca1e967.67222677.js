"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[6647],{8234:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"backend/databases/Desnormalizacion_controlada","title":"Desnormalizaci\xf3n controlada","description":"8.1. Qu\xe9 es desnormalizar (de verdad)","source":"@site/docs/backend/databases/Desnormalizacion_controlada.md","sourceDirName":"backend/databases","slug":"/backend/databases/Desnormalizacion_controlada","permalink":"/docuQuest/docs/backend/databases/Desnormalizacion_controlada","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/databases/Desnormalizacion_controlada.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Normalizaci\xf3n","permalink":"/docuQuest/docs/backend/databases/Normalizacion"},"next":{"title":"\xc1lgebra relacional y pensamiento declarativo","permalink":"/docuQuest/docs/backend/databases/Algebra_relacional_y_pensamiento_declarativo"}}');var i=a(4848),r=a(8453);const o={},d="Desnormalizaci\xf3n controlada",c={},l=[{value:"8.1. Qu\xe9 es desnormalizar (de verdad)",id:"81-qu\xe9-es-desnormalizar-de-verdad",level:2},{value:"8.2. Ejemplo base \u2014 Sistema de pedidos normalizado",id:"82-ejemplo-base--sistema-de-pedidos-normalizado",level:2},{value:"8.3. Desnormalizaci\xf3n puntual \u2014 duplicar datos \u201cseguros\u201d",id:"83-desnormalizaci\xf3n-puntual--duplicar-datos-seguros",level:2},{value:"8.4. Desnormalizar para reportes agregados",id:"84-desnormalizar-para-reportes-agregados",level:2},{value:"8.5. Desnormalizaci\xf3n por pre-c\xe1lculo",id:"85-desnormalizaci\xf3n-por-pre-c\xe1lculo",level:2},{value:"8.6. Desnormalizar para consultas con alto tr\xe1fico",id:"86-desnormalizar-para-consultas-con-alto-tr\xe1fico",level:2},{value:"8.7. Comparaci\xf3n clara",id:"87-comparaci\xf3n-clara",level:2},{value:"8.8. Buenas pr\xe1cticas en desnormalizaci\xf3n",id:"88-buenas-pr\xe1cticas-en-desnormalizaci\xf3n",level:2},{value:"Errores comunes",id:"errores-comunes",level:2},{value:"8.9. Ejercicio pr\xe1ctico guiado \u2014 Casos reales de desnormalizaci\xf3n",id:"89-ejercicio-pr\xe1ctico-guiado--casos-reales-de-desnormalizaci\xf3n",level:2},{value:"Caso 1 \u2014 Snapshot de cliente en pedidos",id:"caso-1--snapshot-de-cliente-en-pedidos",level:3},{value:"Caso 2 \u2014 Tabla agregada para dashboard",id:"caso-2--tabla-agregada-para-dashboard",level:3},{value:"Caso 3 \u2014 Vista materializada para API",id:"caso-3--vista-materializada-para-api",level:3}];function t(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"desnormalizaci\xf3n-controlada",children:"Desnormalizaci\xf3n controlada"})}),"\n",(0,i.jsx)(n.h2,{id:"81-qu\xe9-es-desnormalizar-de-verdad",children:"8.1. Qu\xe9 es desnormalizar (de verdad)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Desnormalizar"})," no es volver a cometer errores de dise\xf1o."]}),"\n",(0,i.jsxs)(n.p,{children:["Es ",(0,i.jsx)(n.strong,{children:"romper intencionadamente una o m\xe1s formas normales"})," para:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Mejorar el rendimiento de lecturas frecuentes,"}),"\n",(0,i.jsx)(n.li,{children:"Reducir el n\xfamero de joins costosos,"}),"\n",(0,i.jsx)(n.li,{children:"O simplificar ciertos casos de uso espec\xedficos."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"La clave es que sea:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Controlado"})," \u2192 sabes qu\xe9 est\xe1s sacrificando."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Documentado"})," \u2192 el equipo entiende por qu\xe9 y d\xf3nde."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mantenido"})," \u2192 sabes c\xf3mo sincronizar los datos duplicados."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"82-ejemplo-base--sistema-de-pedidos-normalizado",children:"8.2. Ejemplo base \u2014 Sistema de pedidos normalizado"}),"\n",(0,i.jsx)(n.p,{children:"Recordemos un esquema perfectamente normalizado (M\xf3dulo 7):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cliente(id_cliente, nombre, direccion)\nproducto(id_producto, nombre, precio)\npedido(id_pedido, fecha, id_cliente, total)\npedido_producto(id_pedido, id_producto, cantidad)\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Para mostrar el detalle de un pedido completo, necesitamos al menos ",(0,i.jsx)(n.strong,{children:"3 JOINs"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"pedido \u2192 cliente"}),"\n",(0,i.jsx)(n.li,{children:"pedido_producto \u2192 producto"}),"\n",(0,i.jsx)(n.li,{children:"producto \u2192 precio"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Si tenemos millones de filas y la consulta es frecuente (ej. dashboard, reportes), esto puede ser ",(0,i.jsx)(n.strong,{children:"costoso"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"83-desnormalizaci\xf3n-puntual--duplicar-datos-seguros",children:"8.3. Desnormalizaci\xf3n puntual \u2014 duplicar datos \u201cseguros\u201d"}),"\n",(0,i.jsxs)(n.p,{children:["Una opci\xf3n com\xfan es ",(0,i.jsx)(n.strong,{children:"guardar algunos atributos redundantes"})," directamente en la tabla ",(0,i.jsx)(n.code,{children:"pedido"})," o ",(0,i.jsx)(n.code,{children:"pedido_producto"})," para evitar joins constantes."]}),"\n",(0,i.jsx)(n.p,{children:"Ejemplo:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"pedido(\n  id_pedido,\n  fecha,\n  id_cliente,\n  nombre_cliente_cache,   <-- duplicado de cliente.nombre\n  total\n)\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ventajas:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Reportes m\xe1s r\xe1pidos."}),"\n",(0,i.jsx)(n.li,{children:"Menos joins para casos de lectura frecuente."}),"\n",(0,i.jsx)(n.li,{children:"Se simplifica el acceso desde capas superiores."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Desventajas:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Si cambia el nombre del cliente, hay que actualizar m\xe1s de un sitio.\n(pero puede ser aceptable si esos datos son \u201chist\xf3ricos\u201d)."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Buen patr\xf3n:"})}),"\n",(0,i.jsxs)(n.p,{children:["Desnormaliza ",(0,i.jsx)(n.strong,{children:"datos que no cambian con frecuencia"})," o que se usan como \u201csnapshot\u201d (por ejemplo, nombre del cliente al momento del pedido)."]}),"\n",(0,i.jsx)(n.h2,{id:"84-desnormalizar-para-reportes-agregados",children:"8.4. Desnormalizar para reportes agregados"}),"\n",(0,i.jsxs)(n.p,{children:["Otro caso com\xfan: si necesitas constantemente el ",(0,i.jsx)(n.strong,{children:"importe total por cliente"}),", puedes:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Calcularlo din\xe1micamente (JOIN + SUM)"}),"\n",(0,i.jsxs)(n.li,{children:["O mantenerlo desnormalizado en ",(0,i.jsx)(n.code,{children:"cliente"})," como un campo ",(0,i.jsx)(n.code,{children:"importe_acumulado"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cliente(\n  id_cliente,\n  nombre,\n  direccion,\n  importe_acumulado   <-- calculado y sincronizado\n)\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"Esto reduce queries de agregaci\xf3n pesadas."}),"\n",(0,i.jsxs)(n.p,{children:["Pero requiere un ",(0,i.jsx)(n.strong,{children:"mecanismo de actualizaci\xf3n controlado"})," (trigger, batch, proceso ETL, etc.)."]}),"\n",(0,i.jsx)(n.p,{children:"En sistemas reales, esto se usa much\xedsimo para dashboards y m\xe9tricas en tiempo real."}),"\n",(0,i.jsx)(n.h2,{id:"85-desnormalizaci\xf3n-por-pre-c\xe1lculo",children:"8.5. Desnormalizaci\xf3n por pre-c\xe1lculo"}),"\n",(0,i.jsx)(n.p,{children:"Sup\xf3n que tu aplicaci\xf3n muestra:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Total de pedidos por mes,"}),"\n",(0,i.jsx)(n.li,{children:"Total de productos vendidos por categor\xeda."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"En lugar de calcularlo cada vez con miles de registros,"}),"\n",(0,i.jsxs)(n.p,{children:["puedes tener una tabla desnormalizada de ",(0,i.jsx)(n.strong,{children:"agregados precomputados"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ventas_resumen(\n  anio_mes,\n  categoria,\n  total_pedidos,\n  total_unidades,\n  total_facturado\n)\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"Esta tabla no es origen de verdad:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Se ",(0,i.jsx)(n.strong,{children:"regenera o sincroniza peri\xf3dicamente"}),","]}),"\n",(0,i.jsxs)(n.li,{children:["Sirve ",(0,i.jsx)(n.strong,{children:"exclusivamente para consultas r\xe1pidas"})," (reporting, dashboards)."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Este patr\xf3n es extremadamente com\xfan en BI y anal\xedtica."}),"\n",(0,i.jsx)(n.h2,{id:"86-desnormalizar-para-consultas-con-alto-tr\xe1fico",children:"8.6. Desnormalizar para consultas con alto tr\xe1fico"}),"\n",(0,i.jsx)(n.p,{children:"Caso real (e-commerce):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"pedido"})," tiene 10M de registros."]}),"\n",(0,i.jsx)(n.li,{children:"La API muestra los 10 \xfaltimos pedidos de cada cliente miles de veces al d\xeda."}),"\n",(0,i.jsxs)(n.li,{children:["Los JOIN a ",(0,i.jsx)(n.code,{children:"cliente"})," y ",(0,i.jsx)(n.code,{children:"producto"})," son caros."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Soluci\xf3n pr\xe1ctica:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Crear una tabla ",(0,i.jsx)(n.code,{children:"pedido_resumen"})," con la informaci\xf3n m\xe1s consultada ya premezclada."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"pedido_resumen(\n  id_pedido,\n  fecha,\n  nombre_cliente,\n  direccion_cliente,\n  lista_productos_texto,\n  total\n)\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"No reemplaza al modelo normalizado original."}),"\n",(0,i.jsx)(n.p,{children:"Se mantiene sincronizada mediante:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"triggers en cada inserci\xf3n de pedido,"}),"\n",(0,i.jsx)(n.li,{children:"jobs programados (batch),"}),"\n",(0,i.jsx)(n.li,{children:"o colas de eventos (si hay microservicios)."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Esto se conoce como ",(0,i.jsx)(n.strong,{children:"\u201ctabla materializada\u201d"})," o ",(0,i.jsx)(n.strong,{children:"\u201cvista materializada\u201d"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"87-comparaci\xf3n-clara",children:"8.7. Comparaci\xf3n clara"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Totalmente normalizado"}),(0,i.jsx)(n.th,{children:"Desnormalizado controlado"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Alta integridad"}),(0,i.jsx)(n.td,{children:"Rendimiento optimizado en casos espec\xedficos"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Sin duplicaciones"}),(0,i.jsx)(n.td,{children:"Duplica campos seleccionados"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"JOINs necesarios"}),(0,i.jsx)(n.td,{children:"JOINs reducidos"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Ideal para OLTP"}),(0,i.jsx)(n.td,{children:"Ideal para OLAP / reporting"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Complejo en consultas de agregaci\xf3n"}),(0,i.jsx)(n.td,{children:"Consultas m\xe1s simples y r\xe1pidas"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Mantenimiento m\xe1s f\xe1cil"}),(0,i.jsx)(n.td,{children:"Mantenimiento m\xe1s delicado (sincronizaci\xf3n necesaria)"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["En sistemas reales, ",(0,i.jsx)(n.strong,{children:"ambos modelos suelen coexistir"}),":"]}),"\n",(0,i.jsxs)(n.p,{children:["uno como ",(0,i.jsx)(n.strong,{children:"fuente de verdad"})," y otro como ",(0,i.jsx)(n.strong,{children:"modelo optimizado para lectura"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"88-buenas-pr\xe1cticas-en-desnormalizaci\xf3n",children:"8.8. Buenas pr\xe1cticas en desnormalizaci\xf3n"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\ud83d\udccc Desnormaliza ",(0,i.jsx)(n.strong,{children:"solo cuando tengas un caso de uso medido"}),", no \u201cpor si acaso\u201d."]}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udccc Documenta claramente qu\xe9 datos est\xe1n duplicados y desde d\xf3nde se actualizan."}),"\n",(0,i.jsxs)(n.li,{children:["\ud83d\udccc Mant\xe9n ",(0,i.jsx)(n.strong,{children:"la versi\xf3n normalizada como referencia can\xf3nica"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udccc Automatiza la sincronizaci\xf3n (triggers, tareas programadas, pipelines ETL, vistas materializadas)."}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udccc Eval\xfaa si realmente vale la pena antes de duplicar informaci\xf3n."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"errores-comunes",children:"Errores comunes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Desnormalizar sin medir \u2192 consultas r\xe1pidas hoy, dolor de cabeza ma\xf1ana."}),"\n",(0,i.jsx)(n.li,{children:"Romper relaciones cr\xedticas \u2192 inconsistencias silenciosas."}),"\n",(0,i.jsx)(n.li,{children:"No actualizar los duplicados \u2192 datos desfasados."}),"\n",(0,i.jsx)(n.li,{children:"Usar desnormalizaci\xf3n como sustituto de un buen dise\xf1o inicial."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"89-ejercicio-pr\xe1ctico-guiado--casos-reales-de-desnormalizaci\xf3n",children:"8.9. Ejercicio pr\xe1ctico guiado \u2014 Casos reales de desnormalizaci\xf3n"}),"\n",(0,i.jsx)(n.h3,{id:"caso-1--snapshot-de-cliente-en-pedidos",children:"Caso 1 \u2014 Snapshot de cliente en pedidos"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["A\xf1adir ",(0,i.jsx)(n.code,{children:"nombre_cliente_cache"})," y ",(0,i.jsx)(n.code,{children:"direccion_cliente_cache"})," en ",(0,i.jsx)(n.code,{children:"pedido"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Mantenerlos sincronizados al crear un pedido."}),"\n",(0,i.jsxs)(n.li,{children:["Si cambia la direcci\xf3n en ",(0,i.jsx)(n.code,{children:"cliente"}),", no actualizar pedidos antiguos (hist\xf3rico)."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"caso-2--tabla-agregada-para-dashboard",children:"Caso 2 \u2014 Tabla agregada para dashboard"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Crear ",(0,i.jsx)(n.code,{children:"ventas_resumen"})," con totales por mes y categor\xeda."]}),"\n",(0,i.jsx)(n.li,{children:"Rellenarla autom\xe1ticamente cada noche con un script o job."}),"\n",(0,i.jsxs)(n.li,{children:["Consultar dashboard directamente sobre ",(0,i.jsx)(n.code,{children:"ventas_resumen"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"caso-3--vista-materializada-para-api",children:"Caso 3 \u2014 Vista materializada para API"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Crear ",(0,i.jsx)(n.code,{children:"pedido_resumen"})," con JOINs precomputados."]}),"\n",(0,i.jsx)(n.li,{children:"Consultar la API solo sobre esta tabla para reducir latencia."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"As\xed funcionan internamente muchos ERPs, CRMs y plataformas de e-commerce a gran escala."})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>d});var s=a(6540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);