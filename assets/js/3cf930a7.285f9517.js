"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[231],{5951:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"backend/JSON/actualizarEliminar","title":"Actualizar y eliminar datos en archivos JSON con Node.js","description":"Objetivo","source":"@site/docs/backend/JSON/actualizarEliminar.md","sourceDirName":"backend/JSON","slug":"/backend/JSON/actualizarEliminar","permalink":"/docuQuest/docs/backend/JSON/actualizarEliminar","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/JSON/actualizarEliminar.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Consumir JSON con fetch()","permalink":"/docuQuest/docs/backend/JSON/consumirJSON"},"next":{"title":"Validaci\xf3n y control de errores con JSON","permalink":"/docuQuest/docs/backend/JSON/validacionControlErrores"}}');var i=n(4848),o=n(8453);const a={},l="Actualizar y eliminar datos en archivos JSON con Node.js",d={},c=[{value:"Objetivo",id:"objetivo",level:2},{value:"Estructura propuesta",id:"estructura-propuesta",level:2},{value:"Paso 1) Datos de ejemplo <code>data/usuarios.json</code>",id:"paso-1-datos-de-ejemplo-datausuariosjson",level:2},{value:"Paso 2) Utilidades comunes <code>lib/file-utils.js</code>",id:"paso-2-utilidades-comunes-libfile-utilsjs",level:2},{value:"Paso 3) Listar usuarios <code>list.js</code>",id:"paso-3-listar-usuarios-listjs",level:2},{value:"Paso 4) Actualizar por id <code>update.js</code>",id:"paso-4-actualizar-por-id-updatejs",level:2},{value:"Paso 5) Eliminar por id <code>delete.js</code>",id:"paso-5-eliminar-por-id-deletejs",level:2},{value:"Comprobaci\xf3n r\xe1pida del flujo",id:"comprobaci\xf3n-r\xe1pida-del-flujo",level:2},{value:"Buenas pr\xe1cticas m\xednimas",id:"buenas-pr\xe1cticas-m\xednimas",level:2},{value:"Extensiones posibles (siguientes m\xf3dulos sencillos)",id:"extensiones-posibles-siguientes-m\xf3dulos-sencillos",level:2}];function t(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"actualizar-y-eliminar-datos-en-archivos-json-con-nodejs",children:"Actualizar y eliminar datos en archivos JSON con Node.js"})}),"\n",(0,i.jsx)(r.h2,{id:"objetivo",children:"Objetivo"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Leer un fichero ",(0,i.jsx)(r.code,{children:".json"})," a memoria."]}),"\n",(0,i.jsxs)(r.li,{children:["Localizar registros por ",(0,i.jsx)(r.code,{children:"id"}),"."]}),"\n",(0,i.jsx)(r.li,{children:"Actualizar campos puntuales o varios a la vez."}),"\n",(0,i.jsxs)(r.li,{children:["Eliminar registros por ",(0,i.jsx)(r.code,{children:"id"}),"."]}),"\n",(0,i.jsx)(r.li,{children:"Guardar de nuevo el archivo con formato legible."}),"\n",(0,i.jsx)(r.li,{children:"Manejar errores b\xe1sicos (archivo inexistente, JSON corrupto, ids no encontrados)."}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"estructura-propuesta",children:"Estructura propuesta"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"json-crud/\r\n\u251c\u2500\u2500 data/\r\n\u2502   \u2514\u2500\u2500 usuarios.json        \u2190 datos persistentes\r\n\u251c\u2500\u2500 lib/\r\n\u2502   \u2514\u2500\u2500 file-utils.js        \u2190 utilidades de lectura/escritura\r\n\u251c\u2500\u2500 list.js                  \u2190 listar usuarios\r\n\u251c\u2500\u2500 update.js                \u2190 actualizar por id\r\n\u2514\u2500\u2500 delete.js                \u2190 eliminar por id\r\n\n"})}),"\n",(0,i.jsxs)(r.h2,{id:"paso-1-datos-de-ejemplo-datausuariosjson",children:["Paso 1) Datos de ejemplo ",(0,i.jsx)(r.code,{children:"data/usuarios.json"})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-json",children:'[\r\n  { "id": 1, "nombre": "Mario", "email": "mario@nintendo.com", "edad": 35 },\r\n  { "id": 2, "nombre": "Luigi", "email": "luigi@nintendo.com", "edad": 34 },\r\n  { "id": 3, "nombre": "Peach", "email": "peach@nintendo.com", "edad": 28 }\r\n]\n'})}),"\n",(0,i.jsxs)(r.h2,{id:"paso-2-utilidades-comunes-libfile-utilsjs",children:["Paso 2) Utilidades comunes ",(0,i.jsx)(r.code,{children:"lib/file-utils.js"})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-jsx",children:'// lib/file-utils.js\r\nimport { readFile, writeFile, access } from "node:fs/promises";\r\nimport { constants } from "node:fs";\r\nimport path from "node:path";\r\nimport { fileURLToPath } from "node:url";\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\n// Ruta absoluta al JSON\r\nexport const DATA_PATH = path.join(__dirname, "..", "data", "usuarios.json");\r\n\r\nexport async function exists(p) {\r\n  try {\r\n    await access(p, constants.F_OK);\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function readJsonArray(filePath = DATA_PATH) {\r\n  if (!(await exists(filePath))) return [];\r\n  const txt = await readFile(filePath, "utf8");\r\n  if (!txt.trim()) return [];\r\n  try {\r\n    const parsed = JSON.parse(txt);\r\n    return Array.isArray(parsed) ? parsed : [];\r\n  } catch {\r\n    // JSON corrupto: por seguridad devolvemos lista vac\xeda\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function writeJsonArray(arr, filePath = DATA_PATH) {\r\n  const json = JSON.stringify(arr, null, 2);\r\n  await writeFile(filePath, json, "utf8");\r\n}\n'})}),"\n",(0,i.jsxs)(r.h2,{id:"paso-3-listar-usuarios-listjs",children:["Paso 3) Listar usuarios ",(0,i.jsx)(r.code,{children:"list.js"})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-jsx",children:'// list.js\r\nimport { readJsonArray } from "./lib/file-utils.js";\r\n\r\nconst usuarios = await readJsonArray();\r\nif (usuarios.length === 0) {\r\n  console.log("No hay usuarios.");\r\n  process.exit(0);\r\n}\r\n\r\nfor (const u of usuarios) {\r\n  console.log(`${u.id} | ${u.nombre} | ${u.email} | ${u.edad}`);\r\n}\n'})}),"\n",(0,i.jsx)(r.p,{children:"Ejecuta:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"node list.js\r\n\n"})}),"\n",(0,i.jsxs)(r.h2,{id:"paso-4-actualizar-por-id-updatejs",children:["Paso 4) Actualizar por id ",(0,i.jsx)(r.code,{children:"update.js"})]}),"\n",(0,i.jsx)(r.p,{children:"Actualiza uno o varios campos. Recibe:"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"id"})," (num\xe9rico)"]}),"\n",(0,i.jsxs)(r.li,{children:["pares ",(0,i.jsx)(r.code,{children:"clave=valor"})," (por ejemplo ",(0,i.jsx)(r.code,{children:"email=nuevo@mail.com"})," ",(0,i.jsx)(r.code,{children:"edad=30"}),")"]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-jsx",children:'// update.js\r\nimport { readJsonArray, writeJsonArray } from "./lib/file-utils.js";\r\n\r\nfunction parseArgsToPatch(argv) {\r\n  // argv: ["id", "campo=valor", "otro=valor", ...]\r\n  const patch = {};\r\n  for (const kv of argv) {\r\n    const idx = kv.indexOf("=");\r\n    if (idx === -1) continue;\r\n    const key = kv.slice(0, idx).trim();\r\n    const val = kv.slice(idx + 1).trim();\r\n\r\n    // Conversi\xf3n b\xe1sica de tipos: number, boolean, null\r\n    if (/^-?\\d+(\\.\\d+)?$/.test(val)) {\r\n      patch[key] = Number(val);\r\n    } else if (val === "true" || val === "false") {\r\n      patch[key] = val === "true";\r\n    } else if (val === "null") {\r\n      patch[key] = null;\r\n    } else {\r\n      patch[key] = val;\r\n    }\r\n  }\r\n  return patch;\r\n}\r\n\r\nconst [idArg, ...rest] = process.argv.slice(2);\r\nif (!idArg) {\r\n  console.error("Uso: node update.js <id> campo=valor [campo2=valor2 ...]");\r\n  process.exit(1);\r\n}\r\n\r\nconst id = Number(idArg);\r\nif (Number.isNaN(id)) {\r\n  console.error("El id debe ser num\xe9rico.");\r\n  process.exit(1);\r\n}\r\n\r\nconst patch = parseArgsToPatch(rest);\r\nif (Object.keys(patch).length === 0) {\r\n  console.error("Debes indicar al menos un campo=valor a actualizar.");\r\n  process.exit(1);\r\n}\r\n\r\nconst usuarios = await readJsonArray();\r\nconst idx = usuarios.findIndex((u) => u.id === id);\r\n\r\nif (idx === -1) {\r\n  console.error(`No existe un usuario con id ${id}.`);\r\n  process.exit(1);\r\n}\r\n\r\n// Mezclamos campos existentes con el patch\r\nusuarios[idx] = { ...usuarios[idx], ...patch };\r\n\r\nawait writeJsonArray(usuarios);\r\nconsole.log(`Usuario ${id} actualizado.`);\n'})}),"\n",(0,i.jsx)(r.p,{children:"Ejemplos:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"node update.js 2 email=luigi@newmail.com\r\nnode update.js 3 nombre=Princesa_Peach edad=29\r\nnode update.js 1 activo=true\r\nnode update.js 1 nota=null\r\n\n"})}),"\n",(0,i.jsx)(r.p,{children:"Notas:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Conversi\xf3n autom\xe1tica b\xe1sica de tipos en l\xednea de comandos."}),"\n",(0,i.jsxs)(r.li,{children:["Si necesitas actualizar campos anidados, en este m\xf3dulo b\xe1sico no tratamos paths del tipo ",(0,i.jsx)(r.code,{children:"perfil.contacto.telefono"}),". Si lo necesitas, se puede a\xf1adir un helper con acceso por ruta."]}),"\n"]}),"\n",(0,i.jsxs)(r.h2,{id:"paso-5-eliminar-por-id-deletejs",children:["Paso 5) Eliminar por id ",(0,i.jsx)(r.code,{children:"delete.js"})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-jsx",children:'// delete.js\r\nimport { readJsonArray, writeJsonArray } from "./lib/file-utils.js";\r\n\r\nconst idArg = process.argv[2];\r\nif (!idArg) {\r\n  console.error("Uso: node delete.js <id>");\r\n  process.exit(1);\r\n}\r\n\r\nconst id = Number(idArg);\r\nif (Number.isNaN(id)) {\r\n  console.error("El id debe ser num\xe9rico.");\r\n  process.exit(1);\r\n}\r\n\r\nconst usuarios = await readJsonArray();\r\nconst exists = usuarios.some((u) => u.id === id);\r\n\r\nif (!exists) {\r\n  console.error(`No existe un usuario con id ${id}.`);\r\n  process.exit(1);\r\n}\r\n\r\nconst nuevos = usuarios.filter((u) => u.id !== id);\r\nawait writeJsonArray(nuevos);\r\nconsole.log(`Usuario ${id} eliminado.`);\n'})}),"\n",(0,i.jsx)(r.p,{children:"Ejemplo:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"node delete.js 2\r\n\n"})}),"\n",(0,i.jsx)(r.h2,{id:"comprobaci\xf3n-r\xe1pida-del-flujo",children:"Comprobaci\xf3n r\xe1pida del flujo"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Listar:"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"node list.js\r\n\n"})}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Actualizar email del id 3:"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"node update.js 3 email=peach@royal.org\r\n\n"})}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Eliminar id 1:"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"node delete.js 1\r\n\n"})}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Volver a listar:"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"node list.js\r\n\n"})}),"\n",(0,i.jsx)(r.h2,{id:"buenas-pr\xe1cticas-m\xednimas",children:"Buenas pr\xe1cticas m\xednimas"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Haz siempre copia de seguridad del ",(0,i.jsx)(r.code,{children:".json"})," si contiene datos reales."]}),"\n",(0,i.jsxs)(r.li,{children:["Valida tipos y rangos b\xe1sicos (p. ej., ",(0,i.jsx)(r.code,{children:"edad >= 0"}),")."]}),"\n",(0,i.jsxs)(r.li,{children:["Define un criterio claro de unicidad para ",(0,i.jsx)(r.code,{children:"id"}),". Si vas a crear registros nuevos en otros m\xf3dulos, genera ",(0,i.jsx)(r.code,{children:"id"})," con ",(0,i.jsx)(r.code,{children:"Math.max(...ids) + 1"})," o un uuid."]}),"\n",(0,i.jsxs)(r.li,{children:["Usa ",(0,i.jsx)(r.code,{children:"JSON.stringify(arr, null, 2)"})," para mantener el archivo legible."]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"extensiones-posibles-siguientes-m\xf3dulos-sencillos",children:"Extensiones posibles (siguientes m\xf3dulos sencillos)"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Actualizaci\xf3n parcial con rutas anidadas (",(0,i.jsx)(r.code,{children:"perfil.contacto.telefono"}),")."]}),"\n",(0,i.jsx)(r.li,{children:"Borrado masivo por filtro."}),"\n",(0,i.jsx)(r.li,{children:"Peque\xf1o CRUD HTTP nativo con rutas GET/POST/PUT/DELETE sobre este mismo archivo."}),"\n",(0,i.jsx)(r.li,{children:"Paginaci\xf3n y ordenaci\xf3n en memoria."}),"\n"]})]})}function u(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>l});var s=n(6540);const i={},o=s.createContext(i);function a(e){const r=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:r},e.children)}}}]);