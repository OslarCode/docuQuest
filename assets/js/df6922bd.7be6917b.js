"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[908],{4131:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>c,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"backend/databases/Claves_e_integridad_referencial_avanzada","title":"Claves e integridad referencial avanzada","description":"12.1. Recordatorio: \xbfqu\xe9 es una clave?","source":"@site/docs/backend/databases/Claves_e_integridad_referencial_avanzada.md","sourceDirName":"backend/databases","slug":"/backend/databases/Claves_e_integridad_referencial_avanzada","permalink":"/docuQuest/docs/backend/databases/Claves_e_integridad_referencial_avanzada","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/databases/Claves_e_integridad_referencial_avanzada.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Vistas l\xf3gicas y composici\xf3n de consultas complejas","permalink":"/docuQuest/docs/backend/databases/Vistas_logicas_y_composicion_de_consulta"},"next":{"title":"Integridad referencial en serio","permalink":"/docuQuest/docs/backend/databases/Integridad_referencial_en_serio"}}');var s=i(4848),d=i(8453);const c={},r="Claves e integridad referencial avanzada",l={},o=[{value:"12.1. Recordatorio: \xbfqu\xe9 es una clave?",id:"121-recordatorio-qu\xe9-es-una-clave",level:2},{value:"12.2. Clave primaria \u2014 la columna que \u201cancla\u201d la identidad",id:"122-clave-primaria--la-columna-que-ancla-la-identidad",level:2},{value:"12.3. Claves candidatas y alternativas",id:"123-claves-candidatas-y-alternativas",level:2},{value:"12.4. Claves compuestas \u2014 cuando 2 o m\xe1s columnas definen identidad",id:"124-claves-compuestas--cuando-2-o-m\xe1s-columnas-definen-identidad",level:2},{value:"12.5. Clave for\xe1nea \u2014 la pieza que conecta tablas",id:"125-clave-for\xe1nea--la-pieza-que-conecta-tablas",level:2},{value:"12.6. ON UPDATE / ON DELETE \u2014 reglas de integridad referencial",id:"126-on-update--on-delete--reglas-de-integridad-referencial",level:2},{value:"12.7. Ejemplo completo \u2014 Sistema de biblioteca",id:"127-ejemplo-completo--sistema-de-biblioteca",level:2},{value:"Tabla <code>socio</code>",id:"tabla-socio",level:3},{value:"Tabla <code>libro</code>",id:"tabla-libro",level:3},{value:"Tabla <code>prestamo</code>",id:"tabla-prestamo",level:3},{value:"12.8. ON UPDATE \u2014 cu\xe1ndo usarlo",id:"128-on-update--cu\xe1ndo-usarlo",level:2},{value:"\ud83e\udde0 12.9. Combinaciones habituales de reglas de FK",id:"-129-combinaciones-habituales-de-reglas-de-fk",level:2},{value:"12.10. Ejercicio pr\xe1ctico guiado \u2014 e-commerce",id:"1210-ejercicio-pr\xe1ctico-guiado--e-commerce",level:2},{value:"Dise\xf1o con integridad referencial s\xf3lida:",id:"dise\xf1o-con-integridad-referencial-s\xf3lida",level:3},{value:"12.11. Buenas pr\xe1cticas con claves y FKs",id:"1211-buenas-pr\xe1cticas-con-claves-y-fks",level:2},{value:"Errores comunes",id:"errores-comunes",level:2}];function t(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"claves-e-integridad-referencial-avanzada",children:"Claves e integridad referencial avanzada"})}),"\n",(0,s.jsx)(n.h2,{id:"121-recordatorio-qu\xe9-es-una-clave",children:"12.1. Recordatorio: \xbfqu\xe9 es una clave?"}),"\n",(0,s.jsxs)(n.p,{children:["En el modelo relacional, una ",(0,s.jsx)(n.strong,{children:"clave"})," es un ",(0,s.jsx)(n.strong,{children:"conjunto m\xednimo de atributos que identifica de forma \xfanica una tupla (fila)"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Existen varios tipos de claves:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Tipo de clave"}),(0,s.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Clave primaria (PK)"})}),(0,s.jsx)(n.td,{children:"Identifica de forma \xfanica cada fila. No puede ser NULL."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Clave candidata"})}),(0,s.jsx)(n.td,{children:"Cualquier conjunto de atributos que podr\xeda ser PK."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Clave alternativa (AK)"})}),(0,s.jsx)(n.td,{children:"Clave candidata que no se usa como PK, pero tambi\xe9n identifica un\xedvocamente."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Clave for\xe1nea (FK)"})}),(0,s.jsx)(n.td,{children:"Atributo que referencia la PK (o AK) de otra tabla."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Clave compuesta"})}),(0,s.jsx)(n.td,{children:"Clave formada por dos o m\xe1s columnas."})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Esto no es teor\xeda \u201cde manual\u201d:"}),"\n",(0,s.jsx)(n.p,{children:"una buena elecci\xf3n de claves evita duplicidades, corrupciones y datos hu\xe9rfanos en producci\xf3n."}),"\n",(0,s.jsx)(n.h2,{id:"122-clave-primaria--la-columna-que-ancla-la-identidad",children:"12.2. Clave primaria \u2014 la columna que \u201cancla\u201d la identidad"}),"\n",(0,s.jsxs)(n.p,{children:["Una ",(0,s.jsx)(n.strong,{children:"Primary Key (PK)"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Debe ser \xfanica,"}),"\n",(0,s.jsx)(n.li,{children:"No debe permitir valores NULL,"}),"\n",(0,s.jsx)(n.li,{children:"Identifica inequ\xedvocamente cada fila,"}),"\n",(0,s.jsx)(n.li,{children:"Suele tener un \xedndice impl\xedcito (depende del motor),"}),"\n",(0,s.jsx)(n.li,{children:"Es la base para relaciones for\xe1neas."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Ejemplo (tabla ",(0,s.jsx)(n.code,{children:"cliente"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE cliente (\n  id_cliente INT PRIMARY KEY,\n  nombre VARCHAR(100) NOT NULL,\n  correo VARCHAR(100) UNIQUE NOT NULL\n);\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"id_cliente"})," es la ",(0,s.jsx)(n.strong,{children:"PK"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"correo"})," tambi\xe9n podr\xeda haber sido una clave candidata, pero decidimos usar un ID num\xe9rico estable."]}),"\n",(0,s.jsx)(n.h2,{id:"123-claves-candidatas-y-alternativas",children:"12.3. Claves candidatas y alternativas"}),"\n",(0,s.jsxs)(n.p,{children:["Una ",(0,s.jsx)(n.strong,{children:"clave candidata"})," es cualquier atributo (o conjunto) que podr\xeda servir como PK."]}),"\n",(0,s.jsxs)(n.p,{children:["Una ",(0,s.jsx)(n.strong,{children:"clave alternativa"})," es una candidata que ",(0,s.jsx)(n.strong,{children:"no se usa como PK"})," pero que tambi\xe9n es \xfanica."]}),"\n",(0,s.jsx)(n.p,{children:"Ejemplo:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE producto (\n  id_producto SERIAL PRIMARY KEY,\n  codigo_interno VARCHAR(50) UNIQUE NOT NULL,\n  nombre VARCHAR(100) NOT NULL,\n  precio NUMERIC(10,2) NOT NULL\n);\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"id_producto"})," = PK."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"codigo_interno"})," = clave alternativa (AK)."]}),"\n",(0,s.jsx)(n.p,{children:"Ambas identifican un\xedvocamente un producto, pero la PK es m\xe1s pr\xe1ctica para relaciones."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Regla de oro:"})}),"\n",(0,s.jsxs)(n.p,{children:["Usa ",(0,s.jsx)(n.strong,{children:"claves sustitutas (IDs)"})," para relaciones y ",(0,s.jsx)(n.strong,{children:"claves naturales (como emails, c\xf3digos)"})," para validaciones de negocio."]}),"\n",(0,s.jsx)(n.h2,{id:"124-claves-compuestas--cuando-2-o-m\xe1s-columnas-definen-identidad",children:"12.4. Claves compuestas \u2014 cuando 2 o m\xe1s columnas definen identidad"}),"\n",(0,s.jsxs)(n.p,{children:["En muchas relaciones N",":N"," no necesitas un ",(0,s.jsx)(n.code,{children:"id"})," artificial, basta con usar las claves combinadas."]}),"\n",(0,s.jsx)(n.p,{children:"Ejemplo (relaci\xf3n matr\xedcula alumno-curso):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE matricula (\n  id_alumno INT NOT NULL,\n  id_curso INT NOT NULL,\n  fecha_matricula DATE NOT NULL,\n  PRIMARY KEY (id_alumno, id_curso)\n);\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Cada alumno solo puede matricularse ",(0,s.jsx)(n.strong,{children:"una vez"})," en cada curso."]}),"\n",(0,s.jsxs)(n.p,{children:["La combinaci\xf3n ",(0,s.jsx)(n.code,{children:"(id_alumno, id_curso)"})," es \xfanica."]}),"\n",(0,s.jsxs)(n.p,{children:["No hay necesidad de un ",(0,s.jsx)(n.code,{children:"id_matricula"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Este patr\xf3n es extremadamente com\xfan en tablas intermedias."}),"\n",(0,s.jsx)(n.h2,{id:"125-clave-for\xe1nea--la-pieza-que-conecta-tablas",children:"12.5. Clave for\xe1nea \u2014 la pieza que conecta tablas"}),"\n",(0,s.jsxs)(n.p,{children:["Una ",(0,s.jsx)(n.strong,{children:"Foreign Key (FK)"})," es un atributo (o conjunto) que ",(0,s.jsx)(n.strong,{children:"referencia una PK o AK en otra tabla"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Garantiza que ",(0,s.jsx)(n.strong,{children:"no existan registros hu\xe9rfanos"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Ejemplo:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE pedido (\n  id_pedido SERIAL PRIMARY KEY,\n  id_cliente INT NOT NULL,\n  fecha DATE NOT NULL,\n  total NUMERIC(10,2) NOT NULL,\n  FOREIGN KEY (id_cliente) REFERENCES cliente(id_cliente)\n);\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"Cada pedido est\xe1 vinculado a un cliente existente."}),"\n",(0,s.jsxs)(n.p,{children:["Si intentas insertar un pedido con un ",(0,s.jsx)(n.code,{children:"id_cliente"})," que no existe, fallar\xe1."]}),"\n",(0,s.jsxs)(n.p,{children:["Esto protege la integridad referencial ",(0,s.jsx)(n.strong,{children:"autom\xe1ticamente"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"126-on-update--on-delete--reglas-de-integridad-referencial",children:"12.6. ON UPDATE / ON DELETE \u2014 reglas de integridad referencial"}),"\n",(0,s.jsxs)(n.p,{children:["Al crear una FK, puedes especificar qu\xe9 pasa si la fila ",(0,s.jsx)(n.strong,{children:"referenciada cambia"})," o ",(0,s.jsx)(n.strong,{children:"se borra"}),":"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Acci\xf3n"}),(0,s.jsx)(n.th,{children:"Descripci\xf3n"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"RESTRICT"})," (por defecto)"]}),(0,s.jsx)(n.td,{children:"No permite borrar ni actualizar si hay referencias."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"CASCADE"})}),(0,s.jsx)(n.td,{children:"Borra o actualiza autom\xe1ticamente las filas hijas."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SET NULL"})}),(0,s.jsx)(n.td,{children:"Coloca NULL en las filas hijas. (La columna FK debe permitir NULL.)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SET DEFAULT"})}),(0,s.jsx)(n.td,{children:"Coloca el valor por defecto en la FK."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"NO ACTION"})}),(0,s.jsx)(n.td,{children:"Similar a RESTRICT (depende del motor)."})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Ejemplo:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE pedido (\n  id_pedido SERIAL PRIMARY KEY,\n  id_cliente INT,\n  fecha DATE NOT NULL,\n  total NUMERIC(10,2) NOT NULL,\n  FOREIGN KEY (id_cliente)\n    REFERENCES cliente(id_cliente)\n    ON UPDATE CASCADE\n    ON DELETE SET NULL\n);\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Si cambias ",(0,s.jsx)(n.code,{children:"id_cliente"})," en ",(0,s.jsx)(n.code,{children:"cliente"}),", se actualiza autom\xe1ticamente en ",(0,s.jsx)(n.code,{children:"pedido"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Si borras un cliente, los pedidos quedan con ",(0,s.jsx)(n.code,{children:"id_cliente = NULL"})," (hist\xf3rico preservado)."]}),"\n",(0,s.jsx)(n.h2,{id:"127-ejemplo-completo--sistema-de-biblioteca",children:"12.7. Ejemplo completo \u2014 Sistema de biblioteca"}),"\n",(0,s.jsxs)(n.h3,{id:"tabla-socio",children:["Tabla ",(0,s.jsx)(n.code,{children:"socio"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE socio (\n  id_socio SERIAL PRIMARY KEY,\n  nombre VARCHAR(100) NOT NULL,\n  correo VARCHAR(100) UNIQUE NOT NULL\n);\n\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"tabla-libro",children:["Tabla ",(0,s.jsx)(n.code,{children:"libro"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE libro (\n  id_libro SERIAL PRIMARY KEY,\n  titulo VARCHAR(200) NOT NULL,\n  isbn VARCHAR(20) UNIQUE NOT NULL\n);\n\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"tabla-prestamo",children:["Tabla ",(0,s.jsx)(n.code,{children:"prestamo"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE prestamo (\n  id_prestamo SERIAL PRIMARY KEY,\n  id_socio INT NOT NULL,\n  id_libro INT NOT NULL,\n  fecha_inicio DATE NOT NULL,\n  estado VARCHAR(20) NOT NULL,\n  FOREIGN KEY (id_socio)\n    REFERENCES socio(id_socio)\n    ON DELETE CASCADE,     -- si borro al socio, se borran sus pr\xe9stamos\n  FOREIGN KEY (id_libro)\n    REFERENCES libro(id_libro)\n    ON DELETE RESTRICT     -- no se puede borrar un libro prestado\n);\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"Este dise\xf1o:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Evita que existan pr\xe9stamos sin socio o sin libro,"}),"\n",(0,s.jsx)(n.li,{children:"Borra autom\xe1ticamente pr\xe9stamos si desaparece un socio,"}),"\n",(0,s.jsx)(n.li,{children:"Impide borrar libros con pr\xe9stamos activos."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"128-on-update--cu\xe1ndo-usarlo",children:"12.8. ON UPDATE \u2014 cu\xe1ndo usarlo"}),"\n",(0,s.jsxs)(n.p,{children:["Aunque ",(0,s.jsx)(n.code,{children:"ON UPDATE"})," se usa menos, puede ser \xfatil cuando:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Usas claves naturales como PK (por ejemplo, ",(0,s.jsx)(n.code,{children:"codigo_producto"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["Necesitas ",(0,s.jsx)(n.strong,{children:"propagar cambios de identificadores"})," a relaciones dependientes."]}),"\n",(0,s.jsx)(n.li,{children:"Quieres garantizar sincron\xeda absoluta sin necesidad de scripts manuales."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Ejemplo:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"FOREIGN KEY (codigo_producto)\n  REFERENCES producto(codigo_producto)\n  ON UPDATE CASCADE\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"Si el c\xf3digo cambia, todas las tablas relacionadas se actualizan autom\xe1ticamente."}),"\n",(0,s.jsx)(n.p,{children:"Pero:"}),"\n",(0,s.jsxs)(n.p,{children:["Si usas ",(0,s.jsx)(n.strong,{children:"claves sustitutas num\xe9ricas"})," (como IDs autoincrementales), esto casi nunca se usa."]}),"\n",(0,s.jsx)(n.h2,{id:"-129-combinaciones-habituales-de-reglas-de-fk",children:"\ud83e\udde0 12.9. Combinaciones habituales de reglas de FK"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Escenario"}),(0,s.jsx)(n.th,{children:"ON DELETE"}),(0,s.jsx)(n.th,{children:"ON UPDATE"}),(0,s.jsx)(n.th,{children:"Explicaci\xf3n breve"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Datos maestros (clientes, libros)"}),(0,s.jsx)(n.td,{children:"RESTRICT"}),(0,s.jsx)(n.td,{children:"CASCADE"}),(0,s.jsx)(n.td,{children:"No permitir borrar si hay referencias"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Relaciones d\xe9biles (hist\xf3rico pedidos)"}),(0,s.jsx)(n.td,{children:"SET NULL"}),(0,s.jsx)(n.td,{children:"CASCADE"}),(0,s.jsx)(n.td,{children:"Mantener hist\xf3rico sin cliente activo"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Tablas hijas totalmente dependientes"}),(0,s.jsx)(n.td,{children:"CASCADE"}),(0,s.jsx)(n.td,{children:"CASCADE"}),(0,s.jsx)(n.td,{children:"Borrar en cascada si desaparece el padre"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Claves naturales actualizables"}),(0,s.jsx)(n.td,{children:"RESTRICT"}),(0,s.jsx)(n.td,{children:"CASCADE"}),(0,s.jsx)(n.td,{children:"Actualizar hijos autom\xe1ticamente si cambia el valor de PK"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Elegir bien estas reglas es una ",(0,s.jsx)(n.strong,{children:"decisi\xf3n de dise\xf1o"}),", no de conveniencia inmediata."]}),"\n",(0,s.jsx)(n.h2,{id:"1210-ejercicio-pr\xe1ctico-guiado--e-commerce",children:"12.10. Ejercicio pr\xe1ctico guiado \u2014 e-commerce"}),"\n",(0,s.jsx)(n.p,{children:"Tablas:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"cliente"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"pedido"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"producto"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"pedido_producto"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"dise\xf1o-con-integridad-referencial-s\xf3lida",children:"Dise\xf1o con integridad referencial s\xf3lida:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE cliente (\n  id_cliente SERIAL PRIMARY KEY,\n  nombre VARCHAR(100),\n  correo VARCHAR(100) UNIQUE\n);\n\nCREATE TABLE producto (\n  id_producto SERIAL PRIMARY KEY,\n  nombre VARCHAR(100),\n  precio NUMERIC(10,2)\n);\n\nCREATE TABLE pedido (\n  id_pedido SERIAL PRIMARY KEY,\n  id_cliente INT NOT NULL,\n  fecha DATE NOT NULL,\n  total NUMERIC(10,2),\n  FOREIGN KEY (id_cliente)\n    REFERENCES cliente(id_cliente)\n    ON DELETE SET NULL\n    ON UPDATE CASCADE\n);\n\nCREATE TABLE pedido_producto (\n  id_pedido INT NOT NULL,\n  id_producto INT NOT NULL,\n  cantidad INT NOT NULL,\n  PRIMARY KEY (id_pedido, id_producto),\n  FOREIGN KEY (id_pedido)\n    REFERENCES pedido(id_pedido)\n    ON DELETE CASCADE,\n  FOREIGN KEY (id_producto)\n    REFERENCES producto(id_producto)\n    ON DELETE RESTRICT\n);\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"Comportamiento esperado:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Si elimino un pedido \u2192 desaparecen sus productos asociados."}),"\n",(0,s.jsx)(n.li,{children:"Si elimino un cliente \u2192 los pedidos quedan con cliente NULL (hist\xf3rico)."}),"\n",(0,s.jsx)(n.li,{children:"No puedo borrar un producto que tenga pedidos asociados."}),"\n",(0,s.jsxs)(n.li,{children:["No puede existir ",(0,s.jsx)(n.code,{children:"pedido_producto"})," sin pedido ni producto v\xe1lido."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"1211-buenas-pr\xe1cticas-con-claves-y-fks",children:"12.11. Buenas pr\xe1cticas con claves y FKs"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Siempre define PK en toda tabla."}),"\n",(0,s.jsxs)(n.li,{children:["Prefiere ",(0,s.jsx)(n.strong,{children:"claves sustitutas"})," para relaciones (IDs autoincrementales o UUID)."]}),"\n",(0,s.jsx)(n.li,{children:"Usa claves naturales como AK para reglas de negocio."}),"\n",(0,s.jsxs)(n.li,{children:["Define ON DELETE / ON UPDATE de forma ",(0,s.jsx)(n.strong,{children:"consciente"})," \u2014 no uses el default a ciegas."]}),"\n",(0,s.jsx)(n.li,{children:"Documenta claramente las reglas de integridad en tu modelo de datos."}),"\n",(0,s.jsxs)(n.li,{children:["Mant\xe9n consistencia de nombres (",(0,s.jsx)(n.code,{children:"id_cliente"})," en todas las tablas, no ",(0,s.jsx)(n.code,{children:"cliente_id"})," en unas y ",(0,s.jsx)(n.code,{children:"cli"})," en otras)."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"errores-comunes",children:"Errores comunes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"No definir claves \u2192 datos duplicados y consultas ineficientes."}),"\n",(0,s.jsx)(n.li,{children:"FK sin reglas \u2192 borrados inconsistentes."}),"\n",(0,s.jsxs)(n.li,{children:["Uso indiscriminado de ",(0,s.jsx)(n.code,{children:"CASCADE"})," \u2192 borrados en cadena no deseados."]}),"\n",(0,s.jsx)(n.li,{children:"Usar claves naturales inestables (como emails) como PK."}),"\n",(0,s.jsx)(n.li,{children:"Cambiar PKs manualmente sin entender las consecuencias."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>r});var a=i(6540);const s={},d=a.createContext(s);function c(e){const n=a.useContext(d);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),a.createElement(d.Provider,{value:n},e.children)}}}]);