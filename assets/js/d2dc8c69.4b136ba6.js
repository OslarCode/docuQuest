"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[1114],{1181:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>c,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"backend/databases/Copias_de_seguridad_y_recuperacion","title":"Copias de seguridad y recuperaci\xf3n","description":"30.1. La verdad inc\xf3moda: los backups que no se prueban no sirven","source":"@site/docs/backend/databases/Copias_de_seguridad_y_recuperacion.md","sourceDirName":"backend/databases","slug":"/backend/databases/Copias_de_seguridad_y_recuperacion","permalink":"/docuQuest/docs/backend/databases/Copias_de_seguridad_y_recuperacion","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/databases/Copias_de_seguridad_y_recuperacion.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Vistas materializadas y reportes","permalink":"/docuQuest/docs/backend/databases/Vistas_materializadas_y_reportes"},"next":{"title":"Mantenimiento de \xedndices y crecimiento","permalink":"/docuQuest/docs/backend/databases/Mantenimiento_de_indices_y_crecimiento"}}');var r=s(4848),i=s(8453);const c={},l="Copias de seguridad y recuperaci\xf3n",o={},d=[{value:"30.1. La verdad inc\xf3moda: los backups que no se prueban no sirven",id:"301-la-verdad-inc\xf3moda-los-backups-que-no-se-prueban-no-sirven",level:2},{value:"30.2. Tipos de backups",id:"302-tipos-de-backups",level:2},{value:"30.3. Ejemplo: backup l\xf3gico simple",id:"303-ejemplo-backup-l\xf3gico-simple",level:2},{value:"30.4. Ejemplo: backup f\xedsico (nivel archivo)",id:"304-ejemplo-backup-f\xedsico-nivel-archivo",level:2},{value:"30.5. Copias incrementales y WAL (registro de transacciones)",id:"305-copias-incrementales-y-wal-registro-de-transacciones",level:2},{value:"30.6. Pruebas de restauraci\xf3n (lo m\xe1s importante)",id:"306-pruebas-de-restauraci\xf3n-lo-m\xe1s-importante",level:2},{value:"30.7. Puntos de recuperaci\xf3n (RPO y RTO)",id:"307-puntos-de-recuperaci\xf3n-rpo-y-rto",level:2},{value:"30.8. Versionar y proteger backups",id:"308-versionar-y-proteger-backups",level:2},{value:"30.9. Automatizaci\xf3n de backups",id:"309-automatizaci\xf3n-de-backups",level:2},{value:"30.10. Checklist de un buen plan de backups",id:"3010-checklist-de-un-buen-plan-de-backups",level:2},{value:"30.11. Errores comunes",id:"3011-errores-comunes",level:2}];function t(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"copias-de-seguridad-y-recuperaci\xf3n",children:"Copias de seguridad y recuperaci\xf3n"})}),"\n",(0,r.jsx)(n.h2,{id:"301-la-verdad-inc\xf3moda-los-backups-que-no-se-prueban-no-sirven",children:"30.1. La verdad inc\xf3moda: los backups que no se prueban no sirven"}),"\n",(0,r.jsx)(n.p,{children:"En demasiados proyectos:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Se hacen copias de seguridad autom\xe1ticas,"}),"\n",(0,r.jsx)(n.li,{children:"Nadie las comprueba,"}),"\n",(0,r.jsx)(n.li,{children:"Y cuando hay que restaurar\u2026 no funcionan"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Un backup no probado es ",(0,r.jsx)(n.strong,{children:"una falsa sensaci\xf3n de seguridad"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["El objetivo de este m\xf3dulo no es solo ",(0,r.jsx)(n.strong,{children:"guardar"})," datos, sino ",(0,r.jsx)(n.strong,{children:"garantizar que se pueden recuperar cuando m\xe1s se necesitan"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"302-tipos-de-backups",children:"30.2. Tipos de backups"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Backups completos"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Copia total de la base de datos en un punto en el tiempo."}),"\n",(0,r.jsx)(n.li,{children:"Son la base de cualquier estrategia s\xf3lida."}),"\n",(0,r.jsx)(n.li,{children:"Ocupan m\xe1s espacio y tardan m\xe1s, pero son simples de restaurar."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Backups incrementales"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Guardan solo lo que ",(0,r.jsx)(n.strong,{children:"cambi\xf3"})," desde el \xfaltimo backup."]}),"\n",(0,r.jsx)(n.li,{children:"Ahorra espacio y tiempo."}),"\n",(0,r.jsx)(n.li,{children:"Requiere aplicar varios incrementos para restaurar."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Backups diferenciales"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Guardan todo lo que cambi\xf3 desde el ",(0,r.jsx)(n.strong,{children:"\xfaltimo completo"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Compromiso entre tama\xf1o y facilidad de restauraci\xf3n."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Backups l\xf3gicos vs f\xedsicos"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"L\xf3gicos"}),": exportan datos en formato legible (SQL, CSV, JSON)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"F\xedsicos"}),": copian directamente los archivos binarios de la base."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"En la pr\xe1ctica:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Muchas empresas hacen un ",(0,r.jsx)(n.strong,{children:"completo diario"})," + ",(0,r.jsx)(n.strong,{children:"incrementales cada hora"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Tambi\xe9n se combinan ",(0,r.jsx)(n.strong,{children:"backups l\xf3gicos"})," (para portabilidad) y ",(0,r.jsx)(n.strong,{children:"f\xedsicos"})," (para velocidad de recuperaci\xf3n)."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"303-ejemplo-backup-l\xf3gico-simple",children:"30.3. Ejemplo: backup l\xf3gico simple"}),"\n",(0,r.jsxs)(n.p,{children:["Supongamos una base llamada ",(0,r.jsx)(n.code,{children:"tienda"}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Exportar:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pg_dump tienda > tienda_backup_2025_10_19.sql\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Esto crea un archivo SQL con toda la estructura y los datos."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Restaurar:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"psql -d tienda_restaurada -f tienda_backup_2025_10_19.sql\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Muy \xfatil para:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Migrar bases entre entornos,"}),"\n",(0,r.jsx)(n.li,{children:"Probar restauraciones,"}),"\n",(0,r.jsx)(n.li,{children:"Tener una copia portable."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Esto aplica igual con otras herramientas (",(0,r.jsx)(n.code,{children:"mysqldump"}),", ",(0,r.jsx)(n.code,{children:"sqlite .dump"}),", etc.)."]}),"\n",(0,r.jsx)(n.h2,{id:"304-ejemplo-backup-f\xedsico-nivel-archivo",children:"30.4. Ejemplo: backup f\xedsico (nivel archivo)"}),"\n",(0,r.jsxs)(n.p,{children:["Para grandes vol\xfamenes de datos, un ",(0,r.jsx)(n.strong,{children:"backup f\xedsico"})," es m\xe1s r\xe1pido."]}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo con PostgreSQL:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pg_basebackup -D /backups/tienda_full -F tar -z -P\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Copia toda la instancia en formato comprimido."}),"\n",(0,r.jsx)(n.p,{children:"Restauraci\xf3n:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Detienes el servidor,"}),"\n",(0,r.jsx)(n.li,{children:"Descomprimes el backup,"}),"\n",(0,r.jsx)(n.li,{children:"Inicias con la carpeta restaurada."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Esto permite restaurar bases de cientos de GB de forma m\xe1s eficiente que con ",(0,r.jsx)(n.code,{children:"pg_dump"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"305-copias-incrementales-y-wal-registro-de-transacciones",children:"30.5. Copias incrementales y WAL (registro de transacciones)"}),"\n",(0,r.jsx)(n.p,{children:"En bases modernas, no necesitas hacer una copia completa cada hora."}),"\n",(0,r.jsx)(n.p,{children:"Puedes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Hacer un ",(0,r.jsx)(n.strong,{children:"backup completo diario"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Capturar los ",(0,r.jsx)(n.strong,{children:"WAL (Write Ahead Logs)"})," para cubrir los cambios intermedios."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Esto permite ",(0,r.jsx)(n.strong,{children:"volver a un punto exacto en el tiempo"})," \u23f3."]}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo t\xedpico en PostgreSQL:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pg_basebackup ...\n# Archivar WALs cada minuto a /wal_archive\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Si ocurre un desastre a las 15:37:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Restauras el backup completo de las 00:00."}),"\n",(0,r.jsx)(n.li,{children:"Reproduces los WAL hasta las 15:37.\nRecuperaci\xf3n casi exacta."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Esto se llama ",(0,r.jsx)(n.strong,{children:"PITR (Point In Time Recovery)"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"306-pruebas-de-restauraci\xf3n-lo-m\xe1s-importante",children:"30.6. Pruebas de restauraci\xf3n (lo m\xe1s importante)"}),"\n",(0,r.jsxs)(n.p,{children:["Un buen plan de backup debe incluir ",(0,r.jsx)(n.strong,{children:"ensayos de restauraci\xf3n peri\xf3dicos"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Pasos t\xedpicos:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Crear una nueva base vac\xeda o entorno aislado."}),"\n",(0,r.jsx)(n.li,{children:"Restaurar desde el backup m\xe1s reciente."}),"\n",(0,r.jsxs)(n.li,{children:["Verificar que:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"La estructura es correcta,"}),"\n",(0,r.jsx)(n.li,{children:"Los datos est\xe1n completos,"}),"\n",(0,r.jsx)(n.li,{children:"Las vistas, constraints y usuarios funcionan."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'psql -c "CREATE DATABASE tienda_restore;"\npsql -d tienda_restore -f tienda_backup_2025_10_19.sql\n\n'})}),"\n",(0,r.jsx)(n.p,{children:"Si no pruebas este paso, no sabes si realmente est\xe1s protegido."}),"\n",(0,r.jsx)(n.p,{children:"Muchas empresas automatizan esta restauraci\xf3n cada noche en un entorno \u201cespejo\u201d."}),"\n",(0,r.jsx)(n.h2,{id:"307-puntos-de-recuperaci\xf3n-rpo-y-rto",children:"30.7. Puntos de recuperaci\xf3n (RPO y RTO)"}),"\n",(0,r.jsx)(n.p,{children:"En planes profesionales de backup se manejan dos conceptos clave:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"RPO (Recovery Point Objective)"})," \u2192\nCu\xe1nto tiempo de datos puedes permitirte perder.\nEj: RPO = 1h \u2192 como m\xe1ximo se perder\xeda una hora de transacciones."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"RTO (Recovery Time Objective)"})," \u2192\nCu\xe1nto tiempo puede tardar la restauraci\xf3n.\nEj: RTO = 30min \u2192 la base debe volver a estar operativa en 30 minutos."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"No es lo mismo:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Un blog personal \u2192 RPO 1 d\xeda puede ser aceptable."}),"\n",(0,r.jsx)(n.li,{children:"Un ecommerce \u2192 RPO 5 minutos puede ser obligatorio."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Esto determina ",(0,r.jsx)(n.strong,{children:"la frecuencia y tipo de backup"})," que debes usar."]}),"\n",(0,r.jsx)(n.h2,{id:"308-versionar-y-proteger-backups",children:"30.8. Versionar y proteger backups"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Guarda ",(0,r.jsx)(n.strong,{children:"m\xfaltiples versiones"})," (por si un backup sale corrupto)."]}),"\n",(0,r.jsxs)(n.li,{children:["Almacena ",(0,r.jsx)(n.strong,{children:"en ubicaciones seguras"})," (no en el mismo servidor productivo)."]}),"\n",(0,r.jsx)(n.li,{children:"Usa cifrado si hay datos sensibles."}),"\n",(0,r.jsx)(n.li,{children:"Automatiza con rotaci\xf3n (por ejemplo, conservar 7 d\xedas + 4 semanas + 12 meses)."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo con rotaci\xf3n simple:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/backups/diarios/\n  tienda_2025_10_19.sql\n  tienda_2025_10_18.sql\n  ...\n/backups/semanales/\n/backups/mensuales/\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"As\xed puedes volver atr\xe1s a diferentes momentos si algo se corrompe lentamente."}),"\n",(0,r.jsx)(n.h2,{id:"309-automatizaci\xf3n-de-backups",children:"30.9. Automatizaci\xf3n de backups"}),"\n",(0,r.jsx)(n.p,{children:"En entornos reales, nadie hace esto manualmente."}),"\n",(0,r.jsx)(n.p,{children:"Se usan:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cron jobs,"}),"\n",(0,r.jsx)(n.li,{children:"Scripts shell,"}),"\n",(0,r.jsx)(n.li,{children:"Herramientas integradas del motor,"}),"\n",(0,r.jsx)(n.li,{children:"Sistemas externos (Borg, Restic, Velero, etc.)."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo cron (backup diario):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"0 2 * * * pg_dump tienda > /backups/tienda_$(date +\\%F).sql\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo con compresi\xf3n:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pg_dump tienda | gzip > /backups/tienda_$(date +%F).sql.gz\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Simple pero efectiva."}),"\n",(0,r.jsx)(n.h2,{id:"3010-checklist-de-un-buen-plan-de-backups",children:"30.10. Checklist de un buen plan de backups"}),"\n",(0,r.jsxs)(n.p,{children:["Tener ",(0,r.jsx)(n.strong,{children:"al menos un backup diario completo"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Usar incrementales o WAL si necesitas recuperaci\xf3n granular."}),"\n",(0,r.jsxs)(n.p,{children:["Almacenar backups ",(0,r.jsx)(n.strong,{children:"fuera del servidor principal"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Cifrar si hay datos sensibles."}),"\n",(0,r.jsx)(n.p,{children:"Probar restauraciones regularmente."}),"\n",(0,r.jsx)(n.p,{children:"Definir claramente RPO y RTO."}),"\n",(0,r.jsx)(n.p,{children:"Documentar todo el procedimiento."}),"\n",(0,r.jsx)(n.p,{children:"Automatizar alertas si un backup falla."}),"\n",(0,r.jsx)(n.h2,{id:"3011-errores-comunes",children:"30.11. Errores comunes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Hacer backups\u2026 pero en el mismo disco que la base."}),"\n",(0,r.jsx)(n.li,{children:"No probar nunca una restauraci\xf3n."}),"\n",(0,r.jsx)(n.li,{children:"No cifrar datos sensibles en backups."}),"\n",(0,r.jsx)(n.li,{children:"No limpiar backups antiguos \u2192 sin espacio cuando m\xe1s se necesita."}),"\n",(0,r.jsx)(n.li,{children:"No documentar el procedimiento \u2192 solo una persona \u201csabe c\xf3mo hacerlo\u201d."}),"\n",(0,r.jsx)(n.li,{children:"RPO y RTO no definidos \u2192 caos en incidentes reales."}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>l});var a=s(6540);const r={},i=a.createContext(r);function c(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);