"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[8092],{7772:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"backend/databases/Datos_sensibles_y_auditoria","title":"Datos sensibles y auditor\xeda","description":"23.1. \xbfQu\xe9 son \u201cdatos sensibles\u201d?","source":"@site/docs/backend/databases/Datos_sensibles_y_auditoria.md","sourceDirName":"backend/databases","slug":"/backend/databases/Datos_sensibles_y_auditoria","permalink":"/docuQuest/docs/backend/databases/Datos_sensibles_y_auditoria","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/databases/Datos_sensibles_y_auditoria.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Modelo de privilegios m\xednimos","permalink":"/docuQuest/docs/backend/databases/Modelo_de_privilegios_minimos"},"next":{"title":"Consultas parametrizadas y seguridad","permalink":"/docuQuest/docs/backend/databases/Consultas_parametrizadas_y_seguridad"}}');var i=n(4848),o=n(8453);const r={},l="Datos sensibles y auditor\xeda",c={},d=[{value:"23.1. \xbfQu\xe9 son \u201cdatos sensibles\u201d?",id:"231-qu\xe9-son-datos-sensibles",level:2},{value:"23.2. Principios b\xe1sicos de protecci\xf3n de datos sensibles",id:"232-principios-b\xe1sicos-de-protecci\xf3n-de-datos-sensibles",level:2},{value:"23.3. Ejemplo pr\xe1ctico \u2014 emails y contrase\xf1as",id:"233-ejemplo-pr\xe1ctico--emails-y-contrase\xf1as",level:2},{value:"23.4. Enmascaramiento y anonimizaci\xf3n",id:"234-enmascaramiento-y-anonimizaci\xf3n",level:2},{value:"23.5. Retenci\xf3n y eliminaci\xf3n controlada",id:"235-retenci\xf3n-y-eliminaci\xf3n-controlada",level:2},{value:"23.6. Auditor\xeda: registrar accesos y modificaciones",id:"236-auditor\xeda-registrar-accesos-y-modificaciones",level:2},{value:"23.7. Auditor\xeda de lectura (SELECT)",id:"237-auditor\xeda-de-lectura-select",level:2},{value:"23.8. Roles especiales para datos sensibles",id:"238-roles-especiales-para-datos-sensibles",level:2},{value:"23.9. Buenas pr\xe1cticas en protecci\xf3n y auditor\xeda",id:"239-buenas-pr\xe1cticas-en-protecci\xf3n-y-auditor\xeda",level:2},{value:"23.10. Errores comunes",id:"2310-errores-comunes",level:2}];function t(e){const s={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"datos-sensibles-y-auditor\xeda",children:"Datos sensibles y auditor\xeda"})}),"\n",(0,i.jsx)(s.h2,{id:"231-qu\xe9-son-datos-sensibles",children:"23.1. \xbfQu\xe9 son \u201cdatos sensibles\u201d?"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Datos sensibles"})," son aquellos que pueden:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Identificar directamente a una persona, o"}),"\n",(0,i.jsx)(s.li,{children:"Exponer informaci\xf3n privada, confidencial o estrat\xe9gica."}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Ejemplos comunes en aplicaciones reales:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Nombre completo, DNI, direcci\xf3n"}),"\n",(0,i.jsx)(s.li,{children:"Email, tel\xe9fono"}),"\n",(0,i.jsx)(s.li,{children:"Datos financieros (n\xfamero de tarjeta, cuenta bancaria)"}),"\n",(0,i.jsx)(s.li,{children:"Datos de salud"}),"\n",(0,i.jsx)(s.li,{children:"Contrase\xf1as, tokens de autenticaci\xf3n, informaci\xf3n confidencial interna"}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.em,{children:"En bases de datos, no todos los datos son iguales. Algunos requieren medidas de seguridad especiales"}),"."]}),"\n",(0,i.jsx)(s.h2,{id:"232-principios-b\xe1sicos-de-protecci\xf3n-de-datos-sensibles",children:"23.2. Principios b\xe1sicos de protecci\xf3n de datos sensibles"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Minimizar"}),": almacenar solo lo estrictamente necesario."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Limitar acceso"}),": no todos deben ver todo."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Enmascarar u ofuscar"})," cuando se muestran datos parciales."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Auditar"}),": registrar qui\xe9n accede, cu\xe1ndo y a qu\xe9."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Eliminar o anonimizar"})," cuando los datos dejan de ser necesarios."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Nunca"})," almacenar contrase\xf1as en texto plano."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"233-ejemplo-pr\xe1ctico--emails-y-contrase\xf1as",children:"23.3. Ejemplo pr\xe1ctico \u2014 emails y contrase\xf1as"}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Tabla insegura:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"CREATE TABLE usuario (\n  id SERIAL PRIMARY KEY,\n  nombre VARCHAR(100),\n  email VARCHAR(150),\n  password VARCHAR(100) --  inseguro\n);\n\n"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Tabla m\xe1s segura:"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"CREATE TABLE usuario (\n  id SERIAL PRIMARY KEY,\n  nombre VARCHAR(100),\n  email VARCHAR(150) UNIQUE,\n  password_hash TEXT NOT NULL,\n  fecha_creacion TIMESTAMP DEFAULT NOW()\n);\n\n"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["La contrase\xf1a no se guarda directamente \u2192 solo el ",(0,i.jsx)(s.strong,{children:"hash"}),"."]}),"\n",(0,i.jsx)(s.li,{children:"El correo es \xfanico \u2192 evita duplicados y acceso descontrolado."}),"\n",(0,i.jsx)(s.li,{children:"Se puede limitar el acceso al campo sensible."}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Ejemplo de privilegio restringido:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"REVOKE SELECT ON usuario FROM lector;\nGRANT SELECT (id, nombre) ON usuario TO lector;\n\n"})}),"\n",(0,i.jsx)(s.p,{children:"Solo roles con permisos especiales podr\xe1n ver emails."}),"\n",(0,i.jsx)(s.h2,{id:"234-enmascaramiento-y-anonimizaci\xf3n",children:"23.4. Enmascaramiento y anonimizaci\xf3n"}),"\n",(0,i.jsxs)(s.p,{children:["A veces necesitamos mostrar datos ",(0,i.jsx)(s.strong,{children:"parciales"}),", por ejemplo, para soporte o informes."]}),"\n",(0,i.jsx)(s.p,{children:"Ejemplo:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["En vez de ",(0,i.jsx)(s.code,{children:"ana@example.com"}),", mostrar ",(0,i.jsx)(s.code,{children:"a***@example.com"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["En vez de DNI completo, mostrar ",(0,i.jsx)(s.code,{children:"*****123A"}),"."]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Esto se puede hacer desde la aplicaci\xf3n o directamente desde la base:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"CREATE VIEW vista_usuario_enmascarado AS\nSELECT\n  id,\n  CONCAT(LEFT(email, 1), '***', SUBSTRING(email FROM POSITION('@' IN email))) AS email,\n  nombre\nFROM usuario;\n\nGRANT SELECT ON vista_usuario_enmascarado TO soporte;\n\n"})}),"\n",(0,i.jsxs)(s.p,{children:["El equipo de soporte ",(0,i.jsx)(s.strong,{children:"no ve el email real completo"}),", solo la versi\xf3n enmascarada."]}),"\n",(0,i.jsx)(s.h2,{id:"235-retenci\xf3n-y-eliminaci\xf3n-controlada",children:"23.5. Retenci\xf3n y eliminaci\xf3n controlada"}),"\n",(0,i.jsxs)(s.p,{children:["Un error com\xfan es ",(0,i.jsx)(s.strong,{children:"guardar datos sensibles para siempre"}),"."]}),"\n",(0,i.jsx)(s.p,{children:"Las buenas pr\xe1cticas y normativas como el RGPD obligan a definir pol\xedticas de retenci\xf3n:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Contrase\xf1as viejas \u2192 eliminarlas o invalidarlas."}),"\n",(0,i.jsx)(s.li,{children:"Cuentas inactivas \u2192 anonimizar o borrar."}),"\n",(0,i.jsx)(s.li,{children:"Logs antiguos \u2192 depurarlos pasado un tiempo razonable."}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Ejemplo de anonimizaci\xf3n sencilla:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"UPDATE usuario\nSET email = CONCAT('anon_', id, '@example.com'),\n    nombre = 'An\xf3nimo'\nWHERE fecha_creacion < NOW() - INTERVAL '5 years';\n\n"})}),"\n",(0,i.jsx)(s.p,{children:"As\xed se conserva la estructura de la base sin mantener informaci\xf3n personal."}),"\n",(0,i.jsx)(s.h2,{id:"236-auditor\xeda-registrar-accesos-y-modificaciones",children:"23.6. Auditor\xeda: registrar accesos y modificaciones"}),"\n",(0,i.jsxs)(s.p,{children:["La ",(0,i.jsx)(s.strong,{children:"auditor\xeda"})," permite responder a preguntas como:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"\xbfQui\xe9n accedi\xf3 a estos datos?"}),"\n",(0,i.jsx)(s.li,{children:"\xbfCu\xe1ndo se modific\xf3 este registro?"}),"\n",(0,i.jsx)(s.li,{children:"\xbfQu\xe9 valores se cambiaron?"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Esto no es opcional en entornos reales."}),"\n",(0,i.jsx)(s.p,{children:"Muchos motores ofrecen mecanismos nativos de auditor\xeda o triggers personalizados."}),"\n",(0,i.jsx)(s.p,{children:"Ejemplo simple con tabla de logs:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"CREATE TABLE auditoria (\n  id SERIAL PRIMARY KEY,\n  usuario TEXT,\n  tabla TEXT,\n  accion TEXT,\n  fecha TIMESTAMP DEFAULT NOW()\n);\n\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Trigger para registrar modificaciones en ",(0,i.jsx)(s.code,{children:"pedido"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION log_pedido()\nRETURNS TRIGGER AS $$\nBEGIN\n  INSERT INTO auditoria (usuario, tabla, accion)\n  VALUES (SESSION_USER, 'pedido', TG_OP);\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER trg_audit_pedido\nAFTER INSERT OR UPDATE OR DELETE ON pedido\nFOR EACH ROW EXECUTE FUNCTION log_pedido();\n\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Cada vez que alguien inserte, actualice o borre en ",(0,i.jsx)(s.code,{children:"pedido"}),", se registrar\xe1 autom\xe1ticamente."]}),"\n",(0,i.jsx)(s.h2,{id:"237-auditor\xeda-de-lectura-select",children:"23.7. Auditor\xeda de lectura (SELECT)"}),"\n",(0,i.jsxs)(s.p,{children:["Por defecto, la mayor\xeda de motores no auditan lecturas (",(0,i.jsx)(s.code,{children:"SELECT"}),"),"]}),"\n",(0,i.jsx)(s.p,{children:"pero hay formas de hacerlo en escenarios cr\xedticos:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Mediante ",(0,i.jsx)(s.strong,{children:"vistas controladas"})," que registran accesos."]}),"\n",(0,i.jsxs)(s.li,{children:["Mediante ",(0,i.jsx)(s.strong,{children:"logs del servidor"})," (nivel avanzado)."]}),"\n",(0,i.jsxs)(s.li,{children:["Mediante ",(0,i.jsx)(s.strong,{children:"middleware"})," en la capa de aplicaci\xf3n."]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Ejemplo conceptual con vista:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION log_acceso_usuario()\nRETURNS SETOF usuario AS $$\nBEGIN\n  INSERT INTO auditoria (usuario, tabla, accion) VALUES (SESSION_USER, 'usuario', 'SELECT');\n  RETURN QUERY SELECT * FROM usuario;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Acceso controlado\nSELECT * FROM log_acceso_usuario();\n\n"})}),"\n",(0,i.jsx)(s.p,{children:"As\xed sabemos qui\xe9n consult\xf3 la tabla sensible."}),"\n",(0,i.jsx)(s.h2,{id:"238-roles-especiales-para-datos-sensibles",children:"23.8. Roles especiales para datos sensibles"}),"\n",(0,i.jsx)(s.p,{children:"No todos los usuarios que tienen acceso a la base deben poder ver informaci\xf3n sensible."}),"\n",(0,i.jsx)(s.p,{children:"Patr\xf3n recomendado:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Rol ",(0,i.jsx)(s.code,{children:"LECTOR_GENERAL"})," \u2192 acceso a datos no sensibles."]}),"\n",(0,i.jsxs)(s.li,{children:["Rol ",(0,i.jsx)(s.code,{children:"LECTOR_SENSIBLE"})," \u2192 acceso limitado a columnas sensibles."]}),"\n",(0,i.jsxs)(s.li,{children:["Rol ",(0,i.jsx)(s.code,{children:"AUDITOR"})," \u2192 acceso solo de lectura a logs de auditor\xeda."]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Ejemplo:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sql",children:"GRANT SELECT ON auditoria TO auditor;\nREVOKE INSERT, UPDATE, DELETE ON auditoria FROM auditor;\n\n"})}),"\n",(0,i.jsxs)(s.p,{children:["As\xed garantizamos que el auditor puede leer los registros, pero ",(0,i.jsx)(s.strong,{children:"no modificarlos"}),"."]}),"\n",(0,i.jsx)(s.h2,{id:"239-buenas-pr\xe1cticas-en-protecci\xf3n-y-auditor\xeda",children:"23.9. Buenas pr\xe1cticas en protecci\xf3n y auditor\xeda"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Identifica datos sensibles en tu modelo y m\xe1rcalos desde el principio."}),"\n",(0,i.jsx)(s.li,{children:"Usa roles y privilegios diferenciados para controlar acceso."}),"\n",(0,i.jsx)(s.li,{children:"Enmascara o anonimiza datos cuando no se necesite el valor real."}),"\n",(0,i.jsx)(s.li,{children:"Implementa auditor\xeda en tablas cr\xedticas (pedidos, usuarios, pagos\u2026)."}),"\n",(0,i.jsx)(s.li,{children:"Establece pol\xedticas de retenci\xf3n claras."}),"\n",(0,i.jsx)(s.li,{children:"Documenta qu\xe9 se audita y por qu\xe9."}),"\n",(0,i.jsx)(s.li,{children:"Automatiza revisiones peri\xf3dicas de accesos."}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"2310-errores-comunes",children:"23.10. Errores comunes"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Guardar contrase\xf1as en texto plano (\xa1a\xfan ocurre!)."}),"\n",(0,i.jsx)(s.li,{children:"Dar acceso de lectura total a todos los roles."}),"\n",(0,i.jsx)(s.li,{children:"No implementar auditor\xeda porque \u201cno es necesaria todav\xeda\u201d."}),"\n",(0,i.jsx)(s.li,{children:"No definir pol\xedticas de retenci\xf3n \u2192 datos expuestos a\xf1os despu\xe9s."}),"\n",(0,i.jsx)(s.li,{children:"No revisar ni usar los logs generados."}),"\n",(0,i.jsx)(s.li,{children:"Mezclar datos sensibles con no sensibles sin control."}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>l});var a=n(6540);const i={},o=a.createContext(i);function r(e){const s=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(o.Provider,{value:s},e.children)}}}]);