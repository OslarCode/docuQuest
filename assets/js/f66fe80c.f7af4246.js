"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[4387],{457:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"backend/sqlite/seguridad","title":"Seguridad pr\xe1ctica","description":"1. Entendiendo el modelo de seguridad de SQLite","source":"@site/docs/backend/sqlite/seguridad.md","sourceDirName":"backend/sqlite","slug":"/backend/sqlite/seguridad","permalink":"/docuQuest/docs/backend/sqlite/seguridad","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/sqlite/seguridad.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Transacciones y concurrencia","permalink":"/docuQuest/docs/backend/sqlite/transaccionesYConcurrencia"},"next":{"title":"JSON y estructuras din\xe1micas","permalink":"/docuQuest/docs/backend/sqlite/JSON"}}');var r=n(4848),c=n(8453);const a={},d="Seguridad pr\xe1ctica",l={},o=[{value:"1. Entendiendo el modelo de seguridad de SQLite",id:"1-entendiendo-el-modelo-de-seguridad-de-sqlite",level:2},{value:"2. Permisos de archivo: la primera barrera",id:"2-permisos-de-archivo-la-primera-barrera",level:2},{value:"Windows:",id:"windows",level:3},{value:"Linux / macOS:",id:"linux--macos",level:3},{value:"3. Cifrado: proteger incluso si el archivo es robado",id:"3-cifrado-proteger-incluso-si-el-archivo-es-robado",level:2},{value:"\xbfQu\xe9 hace SQLCipher?",id:"qu\xe9-hace-sqlcipher",level:3},{value:"4. Instalar SQLCipher (opcional avanzado)",id:"4-instalar-sqlcipher-opcional-avanzado",level:2},{value:"5. Recomendaciones sobre claves de cifrado",id:"5-recomendaciones-sobre-claves-de-cifrado",level:2},{value:"6. Backups seguros",id:"6-backups-seguros",level:2},{value:"7. Prevenci\xf3n de inyecciones SQL",id:"7-prevenci\xf3n-de-inyecciones-sql",level:2},{value:"8. Minimizar exposici\xf3n de datos",id:"8-minimizar-exposici\xf3n-de-datos",level:2},{value:"9. Ejercicio pr\xe1ctico \u2014 endureciendo la base",id:"9-ejercicio-pr\xe1ctico--endureciendo-la-base",level:2},{value:"10. Buenas pr\xe1cticas finales de seguridad",id:"10-buenas-pr\xe1cticas-finales-de-seguridad",level:2},{value:"Errores comunes",id:"errores-comunes",level:2}];function t(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"seguridad-pr\xe1ctica",children:"Seguridad pr\xe1ctica"})}),"\n",(0,r.jsx)(s.h2,{id:"1-entendiendo-el-modelo-de-seguridad-de-sqlite",children:"1. Entendiendo el modelo de seguridad de SQLite"}),"\n",(0,r.jsxs)(s.p,{children:["SQLite ",(0,r.jsx)(s.strong,{children:"no tiene usuarios, contrase\xf1as ni roles internos"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["Cualquiera que tenga acceso f\xedsico al archivo ",(0,r.jsx)(s.code,{children:".db"})," (o ",(0,r.jsx)(s.code,{children:".db-wal"}),") puede abrirlo."]}),"\n",(0,r.jsx)(s.p,{children:"Esto implica que:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"La seguridad no se gestiona dentro de SQLite,"}),"\n",(0,r.jsxs)(s.li,{children:["sino ",(0,r.jsx)(s.strong,{children:"en el sistema operativo, en el c\xf3digo de tu aplicaci\xf3n y en c\xf3mo gestionas los archivos"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Por eso, este m\xf3dulo se enfoca en ",(0,r.jsx)(s.strong,{children:"4 pilares pr\xe1cticos"}),":"]}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Permisos de archivo"}),"\n",(0,r.jsx)(s.li,{children:"Cifrado de la base de datos (SQLCipher u otras alternativas)"}),"\n",(0,r.jsx)(s.li,{children:"Gesti\xf3n de secretos y backups"}),"\n",(0,r.jsx)(s.li,{children:"Prevenci\xf3n de inyecciones SQL y fugas de datos"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"2-permisos-de-archivo-la-primera-barrera",children:"2. Permisos de archivo: la primera barrera"}),"\n",(0,r.jsxs)(s.p,{children:["La base de datos SQLite es ",(0,r.jsx)(s.strong,{children:"un archivo en disco"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"primer.db\nprimer.db-wal\nprimer.db-shm\n\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Si alguien puede ",(0,r.jsx)(s.strong,{children:"leer o copiar"})," estos archivos, puede abrir la base sin restricciones."]}),"\n",(0,r.jsxs)(s.p,{children:["Por eso, ",(0,r.jsx)(s.strong,{children:"la seguridad m\xe1s b\xe1sica y efectiva"})," es:"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"limitar qui\xe9n puede acceder a esos archivos"}),"."]}),"\n",(0,r.jsx)(s.h3,{id:"windows",children:"Windows:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Coloca la base en una carpeta con permisos limitados."}),"\n",(0,r.jsx)(s.li,{children:"Solo el usuario que ejecuta la aplicaci\xf3n debe tener acceso."}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Ejemplo de comandos PowerShell:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-powershell",children:'# Quitar permisos a "Users"\nicacls "C:\\ruta\\primer.db" /inheritance:r\nicacls "C:\\ruta\\primer.db" /grant "USUARIO_APP":F\n\n'})}),"\n",(0,r.jsx)(s.h3,{id:"linux--macos",children:"Linux / macOS:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Usa permisos de archivo cl\xe1sicos:"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"chmod 600 primer.db\nchown usuario_app primer.db\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"Esto significa:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"600"}),": solo el propietario puede leer y escribir,"]}),"\n",(0,r.jsx)(s.li,{children:"nadie m\xe1s puede ni leer el archivo."}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Es simple, pero ",(0,r.jsx)(s.strong,{children:"muy efectivo"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"3-cifrado-proteger-incluso-si-el-archivo-es-robado",children:"3. Cifrado: proteger incluso si el archivo es robado"}),"\n",(0,r.jsxs)(s.p,{children:["Incluso con buenos permisos, puede ocurrir que alguien ",(0,r.jsx)(s.strong,{children:"copie el archivo"})," (por ejemplo, si accede al servidor o a un port\xe1til robado)."]}),"\n",(0,r.jsxs)(s.p,{children:["Por eso, muchos proyectos reales usan ",(0,r.jsx)(s.strong,{children:"SQLCipher"}),", una extensi\xf3n de SQLite con cifrado AES-256."]}),"\n",(0,r.jsx)(s.h3,{id:"qu\xe9-hace-sqlcipher",children:"\xbfQu\xe9 hace SQLCipher?"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Cifra todo el contenido del archivo ",(0,r.jsx)(s.code,{children:".db"}),"."]}),"\n",(0,r.jsx)(s.li,{children:"Solo se puede abrir si se proporciona la clave correcta."}),"\n",(0,r.jsx)(s.li,{children:"Es 100% compatible con SQLite a nivel de sintaxis."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"4-instalar-sqlcipher-opcional-avanzado",children:"4. Instalar SQLCipher (opcional avanzado)"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Importante"}),": SQLCipher ",(0,r.jsx)(s.strong,{children:"no viene por defecto"})," con SQLite, debes instalarlo aparte."]}),"\n",(0,r.jsx)(s.p,{children:"Ejemplo en macOS o Linux:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sudo apt install sqlcipher\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"Verificar:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sqlcipher --version\n\n"})}),"\n",(0,r.jsxs)(s.p,{children:["En lugar de ",(0,r.jsx)(s.code,{children:"sqlite3"}),", usas ",(0,r.jsx)(s.code,{children:"sqlcipher"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sqlcipher primer.db\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"Activar cifrado:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sql",children:"PRAGMA key = 'mi_clave_super_segura';\nCREATE TABLE users (id INTEGER PRIMARY KEY, email TEXT);\nINSERT INTO users (email) VALUES ('ana@example.com');\n\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Si alguien intenta abrir ",(0,r.jsx)(s.code,{children:"primer.db"})," con ",(0,r.jsx)(s.code,{children:"sqlite3"})," sin la clave:"]}),"\n",(0,r.jsx)(s.p,{children:"Ver\xe1 basura ilegible, no datos reales."}),"\n",(0,r.jsx)(s.h2,{id:"5-recomendaciones-sobre-claves-de-cifrado",children:"5. Recomendaciones sobre claves de cifrado"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"No hardcodees la clave en tu c\xf3digo."}),"\n",(0,r.jsxs)(s.li,{children:["Usa variables de entorno (",(0,r.jsx)(s.code,{children:".env"}),") o servicios seguros de gesti\xf3n de secretos."]}),"\n",(0,r.jsx)(s.li,{children:"Cambia la clave peri\xf3dicamente si el entorno lo permite."}),"\n",(0,r.jsxs)(s.li,{children:["Usa una clave ",(0,r.jsx)(s.strong,{children:"larga y aleatoria"})," (no ",(0,r.jsx)(s.code,{children:"1234"})," ni ",(0,r.jsx)(s.code,{children:"admin"})," \ud83d\ude44)."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Ejemplo en Node.js:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-jsx",children:"import Database from \"better-sqlite3\";\n\nconst key = process.env.DB_KEY;\nconst db = new Database('primer.db', { verbose: console.log });\n\ndb.pragma(`key = '${key}'`);\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"As\xed, si alguien accede al c\xf3digo, no encontrar\xe1 directamente la clave."}),"\n",(0,r.jsx)(s.h2,{id:"6-backups-seguros",children:"6. Backups seguros"}),"\n",(0,r.jsx)(s.p,{children:"Cuando haces una copia de seguridad de un archivo SQLite:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Si no est\xe1 cifrado, est\xe1s copiando los datos en claro."}),"\n",(0,r.jsxs)(s.li,{children:["Si est\xe1 cifrado con SQLCipher, la copia ",(0,r.jsx)(s.strong,{children:"mantiene el cifrado"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Buenas pr\xe1cticas:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Guarda los backups ",(0,r.jsx)(s.strong,{children:"en una ubicaci\xf3n diferente"})," con permisos igual de restrictivos."]}),"\n",(0,r.jsxs)(s.li,{children:["Si no usas cifrado en la base, ",(0,r.jsx)(s.strong,{children:"cifra el archivo de backup"})," con una herramienta externa (",(0,r.jsx)(s.code,{children:"gpg"}),", ",(0,r.jsx)(s.code,{children:"zip"})," con contrase\xf1a robusta, etc.)."]}),"\n",(0,r.jsxs)(s.li,{children:["\ud83e\uddea Usa ",(0,r.jsx)(s.code,{children:".backup"})," de SQLite para crear copias consistentes:"]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"sqlite3 primer.db \".backup 'backup_2025_10_09.db'\"\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"Esto evita problemas con WAL o transacciones abiertas."}),"\n",(0,r.jsx)(s.h2,{id:"7-prevenci\xf3n-de-inyecciones-sql",children:"7. Prevenci\xf3n de inyecciones SQL"}),"\n",(0,r.jsxs)(s.p,{children:["Una de las amenazas m\xe1s comunes en bases de datos ",(0,r.jsx)(s.strong,{children:"no proviene de fallos del motor"}),", sino de ",(0,r.jsx)(s.strong,{children:"mal uso en el c\xf3digo"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Inyecci\xf3n SQL"})," ocurre cuando concatenas variables directamente dentro de la consulta."]}),"\n",(0,r.jsx)(s.p,{children:"Ejemplo inseguro:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-jsx",children:"const email = req.body.email;\ndb.prepare(`SELECT * FROM users WHERE email = '${email}'`).get();\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"Si alguien escribe:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"ana@example.com' OR 1=1 --\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"Obtendr\xe1 todos los usuarios \ud83d\ude2c"}),"\n",(0,r.jsx)(s.p,{children:"Ejemplo seguro con par\xe1metros:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-jsx",children:"db.prepare(`SELECT * FROM users WHERE email = ?`).get(email);\n\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Siempre usa ",(0,r.jsx)(s.strong,{children:"placeholders"})," (",(0,r.jsx)(s.code,{children:"?"})," o ",(0,r.jsx)(s.code,{children:":nombre"}),") en tu c\xf3digo, como ya vimos en el m\xf3dulo 1."]}),"\n",(0,r.jsxs)(s.p,{children:["Esto ",(0,r.jsx)(s.strong,{children:"previene el 99 % de inyecciones SQL"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"8-minimizar-exposici\xf3n-de-datos",children:"8. Minimizar exposici\xf3n de datos"}),"\n",(0,r.jsxs)(s.p,{children:["Incluso con la base bien protegida, puedes ",(0,r.jsx)(s.strong,{children:"filtrar m\xe1s datos de la cuenta"})," si no cuidas tus consultas."]}),"\n",(0,r.jsx)(s.p,{children:"Ejemplo inseguro:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-jsx",children:"SELECT * FROM users;\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"\u2192 expone todos los datos de todos los usuarios."}),"\n",(0,r.jsx)(s.p,{children:"Ejemplo correcto:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-jsx",children:"SELECT id, email FROM users WHERE id = ?;\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"Solo devuelves lo necesario para ese contexto."}),"\n",(0,r.jsx)(s.p,{children:"Tambi\xe9n puedes:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Aplicar ",(0,r.jsx)(s.strong,{children:"vistas con permisos limitados"})," si usas SQLite en contextos m\xe1s amplios,"]}),"\n",(0,r.jsx)(s.li,{children:"o sanitizar la salida antes de mostrarla en la app."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"9-ejercicio-pr\xe1ctico--endureciendo-la-base",children:"9. Ejercicio pr\xe1ctico \u2014 endureciendo la base"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["Cambia los permisos de ",(0,r.jsx)(s.code,{children:"primer.db"})," a ",(0,r.jsx)(s.code,{children:"600"})," (o su equivalente en Windows)."]}),"\n",(0,r.jsxs)(s.li,{children:["Activa WAL y aseg\xfarate de proteger tambi\xe9n ",(0,r.jsx)(s.code,{children:"primer.db-wal"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Implementa en tu c\xf3digo consultas ",(0,r.jsx)(s.strong,{children:"con par\xe1metros"}),", no concatenadas."]}),"\n",(0,r.jsx)(s.li,{children:"(Opcional) Instala SQLCipher y cifra la base con una clave segura."}),"\n",(0,r.jsxs)(s.li,{children:["Haz un backup con ",(0,r.jsx)(s.code,{children:".backup"})," y comprueba que funciona."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Con esto, tu base SQLite ya est\xe1 mucho m\xe1s segura que la media."}),"\n",(0,r.jsx)(s.h2,{id:"10-buenas-pr\xe1cticas-finales-de-seguridad",children:"10. Buenas pr\xe1cticas finales de seguridad"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Protege el archivo"}),": permisos adecuados, sin dejarlo en carpetas p\xfablicas."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Usa cifrado"})," si la base contiene datos sensibles."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Gestiona las claves fuera del c\xf3digo"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Usa par\xe1metros en consultas"})," para evitar inyecciones."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Haz backups seguros y coherentes"})," (usando ",(0,r.jsx)(s.code,{children:".backup"})," o checkpoints)."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Cierra conexiones"})," cuando no se usen, especialmente en apps web."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Audita el acceso f\xedsico"})," al entorno si la base vive en servidores locales."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"errores-comunes",children:"Errores comunes"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Error / s\xedntoma"}),(0,r.jsx)(s.th,{children:"Causa"}),(0,r.jsx)(s.th,{children:"Soluci\xf3n"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Datos accesibles por cualquiera"}),(0,r.jsx)(s.td,{children:"Permisos de archivo abiertos"}),(0,r.jsx)(s.td,{children:"Limitar permisos a usuario/app"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Archivos filtrados en backups"}),(0,r.jsx)(s.td,{children:"Copias sin cifrar"}),(0,r.jsx)(s.td,{children:"Cifrar backups o usar SQLCipher"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Inyecci\xf3n SQL"}),(0,r.jsx)(s.td,{children:"Concatenaci\xf3n de strings en consultas"}),(0,r.jsx)(s.td,{children:"Usar par\xe1metros"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Clave expuesta"}),(0,r.jsx)(s.td,{children:"Hardcode en c\xf3digo"}),(0,r.jsx)(s.td,{children:"Usar variables de entorno"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"WAL sin proteger"}),(0,r.jsx)(s.td,{children:"Se olvid\xf3 proteger los archivos auxiliares"}),(0,r.jsx)(s.td,{children:"Restringir permisos tambi\xe9n al WAL"})]})]})]})]})}function h(e={}){const{wrapper:s}={...(0,c.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>d});var i=n(6540);const r={},c=i.createContext(r);function a(e){const s=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(c.Provider,{value:s},e.children)}}}]);