"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[5162],{144:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>i,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"backend/databases/Modulo28_Importacion_y_exportacion_fiable","title":"Modulo 28. Importaci\xf3n y exportaci\xf3n fiable","description":"\ud83e\udded 28.1. CSV y JSON: los formatos m\xe1s comunes","source":"@site/docs/backend/databases/Modulo28_Importacion_y_exportacion_fiable.md","sourceDirName":"backend/databases","slug":"/backend/databases/Modulo28_Importacion_y_exportacion_fiable","permalink":"/docuQuest/docs/backend/databases/Modulo28_Importacion_y_exportacion_fiable","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/databases/Modulo28_Importacion_y_exportacion_fiable.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Modulo 27. Pruebas de bases de datos","permalink":"/docuQuest/docs/backend/databases/Modulo27_Pruebas_de_bases_de_datos"},"next":{"title":"Modulo 29. Vistas materializadas y reportes","permalink":"/docuQuest/docs/backend/databases/Modulo29_Vistas_materializadas_y_reportes"}}');var a=s(4848),o=s(8453);const i={},c="Modulo 28. Importaci\xf3n y exportaci\xf3n fiable",l={},t=[{value:"\ud83e\udded 28.1. CSV y JSON: los formatos m\xe1s comunes",id:"-281-csv-y-json-los-formatos-m\xe1s-comunes",level:2},{value:"\ud83e\udde0 28.2. Importaci\xf3n b\xe1sica desde CSV",id:"-282-importaci\xf3n-b\xe1sica-desde-csv",level:2},{value:"\ud83e\udded 28.3. Validar antes de insertar",id:"-283-validar-antes-de-insertar",level:2},{value:"\ud83e\udde0 28.4. Importaci\xf3n de JSON",id:"-284-importaci\xf3n-de-json",level:2},{value:"\ud83e\udded 28.5. Validaci\xf3n sem\xe1ntica (no solo sintaxis)",id:"-285-validaci\xf3n-sem\xe1ntica-no-solo-sintaxis",level:2},{value:"\ud83e\udde0 28.6. Cargas idempotentes \u2014 que no duplican datos",id:"-286-cargas-idempotentes--que-no-duplican-datos",level:2},{value:"\ud83e\udded 28.7. Control de errores y reportes",id:"-287-control-de-errores-y-reportes",level:2},{value:"\ud83e\udde0 28.8. Exportaci\xf3n fiable",id:"-288-exportaci\xf3n-fiable",level:2},{value:"\ud83e\udded 28.9. Buenas pr\xe1cticas en integraciones",id:"-289-buenas-pr\xe1cticas-en-integraciones",level:2},{value:"\ud83d\udea8 28.10. Errores comunes",id:"-2810-errores-comunes",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"modulo-28-importaci\xf3n-y-exportaci\xf3n-fiable",children:"Modulo 28. Importaci\xf3n y exportaci\xf3n fiable"})}),"\n",(0,a.jsx)(n.h2,{id:"-281-csv-y-json-los-formatos-m\xe1s-comunes",children:"\ud83e\udded 28.1. CSV y JSON: los formatos m\xe1s comunes"}),"\n",(0,a.jsx)(n.p,{children:"Cuando hablamos de integraci\xf3n de datos, estos son los formatos que m\xe1s aparecen:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Formato"}),(0,a.jsx)(n.th,{children:"Caracter\xedsticas principales"}),(0,a.jsx)(n.th,{children:"Uso t\xedpico"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"CSV"})}),(0,a.jsx)(n.td,{children:"Ligero, f\xe1cil de leer, ampliamente soportado"}),(0,a.jsx)(n.td,{children:"Importar/exportar listados (productos, usuarios\u2026)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"JSON"})}),(0,a.jsx)(n.td,{children:"Estructurado, jer\xe1rquico, admite anidaci\xf3n"}),(0,a.jsx)(n.td,{children:"APIs, integraciones complejas, cat\xe1logos con relaciones"})]})]})]}),"\n",(0,a.jsxs)(n.p,{children:["\ud83d\udccc En ambos casos, la clave no es solo mover datos\u2026 sino ",(0,a.jsx)(n.strong,{children:"validarlos y cargarlos correctamente"})," sin romper la integridad de la base."]}),"\n",(0,a.jsx)(n.h2,{id:"-282-importaci\xf3n-b\xe1sica-desde-csv",children:"\ud83e\udde0 28.2. Importaci\xf3n b\xe1sica desde CSV"}),"\n",(0,a.jsx)(n.p,{children:"Ejemplo: supongamos que tenemos esta tabla:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE producto (\n  id SERIAL PRIMARY KEY,\n  nombre TEXT NOT NULL,\n  precio NUMERIC(10,2) NOT NULL,\n  categoria TEXT\n);\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Y un archivo ",(0,a.jsx)(n.code,{children:"productos.csv"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"nombre,precio,categoria\nTeclado,59.90,Electr\xf3nica\nCamiseta,19.99,Ropa\nLibro,15.50,Libros\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"Importaci\xf3n b\xe1sica con SQL:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"COPY producto (nombre, precio, categoria)\nFROM '/ruta/a/productos.csv'\nDELIMITER ','\nCSV HEADER;\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"\ud83d\udc49 Esto carga las tres filas directamente en la tabla."}),"\n",(0,a.jsxs)(n.p,{children:["\ud83d\udccc Esto funciona muy bien\u2026 ",(0,a.jsx)(n.strong,{children:"si"})," el CSV est\xe1 limpio."]}),"\n",(0,a.jsx)(n.p,{children:"Pero en la pr\xe1ctica, hay que validar antes de confiar."}),"\n",(0,a.jsx)(n.h2,{id:"-283-validar-antes-de-insertar",children:"\ud83e\udded 28.3. Validar antes de insertar"}),"\n",(0,a.jsx)(n.p,{children:"Errores comunes en archivos reales:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Filas vac\xedas."}),"\n",(0,a.jsxs)(n.li,{children:["Tipos incorrectos (",(0,a.jsx)(n.code,{children:"abc"})," en un campo num\xe9rico)."]}),"\n",(0,a.jsx)(n.li,{children:"Duplicados."}),"\n",(0,a.jsx)(n.li,{children:"Campos faltantes."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Patr\xf3n recomendado:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Importar primero en una ",(0,a.jsx)(n.strong,{children:"tabla temporal"}),"."]}),"\n",(0,a.jsx)(n.li,{children:"Validar datos."}),"\n",(0,a.jsx)(n.li,{children:"Insertar en la tabla final si todo es correcto."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Ejemplo:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TEMP TABLE tmp_producto (\n  nombre TEXT,\n  precio TEXT,\n  categoria TEXT\n);\n\nCOPY tmp_producto FROM '/ruta/a/productos.csv' DELIMITER ',' CSV HEADER;\n\n-- Validaciones b\xe1sicas\nSELECT * FROM tmp_producto WHERE precio ~ '^[0-9]+(\\.[0-9]{1,2})?$';  -- formato num\xe9rico correcto\nSELECT * FROM tmp_producto WHERE nombre IS NULL OR nombre = '';\n\n-- Si todo est\xe1 bien:\nINSERT INTO producto (nombre, precio, categoria)\nSELECT nombre, precio::NUMERIC(10,2), categoria\nFROM tmp_producto;\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\ud83d\udc49 De esta forma ",(0,a.jsx)(n.strong,{children:"no contaminas"})," la tabla real con datos rotos."]}),"\n",(0,a.jsx)(n.h2,{id:"-284-importaci\xf3n-de-json",children:"\ud83e\udde0 28.4. Importaci\xf3n de JSON"}),"\n",(0,a.jsx)(n.p,{children:"JSON es ideal cuando:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Hay jerarqu\xedas o relaciones."}),"\n",(0,a.jsx)(n.li,{children:"Viene de APIs externas."}),"\n",(0,a.jsx)(n.li,{children:"Necesitas campos opcionales o anidados."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Ejemplo de archivo:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'[\n  { "nombre": "Teclado", "precio": 59.90, "categoria": "Electr\xf3nica" },\n  { "nombre": "Camiseta", "precio": 19.99, "categoria": "Ropa" }\n]\n\n'})}),"\n",(0,a.jsx)(n.p,{children:"En PostgreSQL (u otros motores con soporte JSON):"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TEMP TABLE tmp_json (data JSONB);\n\nCOPY tmp_json FROM '/ruta/a/productos.json';\n\nINSERT INTO producto (nombre, precio, categoria)\nSELECT\n  data->>'nombre',\n  (data->>'precio')::NUMERIC,\n  data->>'categoria'\nFROM tmp_json;\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\ud83d\udc49 Esto permite validar y transformar ",(0,a.jsx)(n.strong,{children:"campo por campo"})," antes de insertar."]}),"\n",(0,a.jsx)(n.h2,{id:"-285-validaci\xf3n-sem\xe1ntica-no-solo-sintaxis",children:"\ud83e\udded 28.5. Validaci\xf3n sem\xe1ntica (no solo sintaxis)"}),"\n",(0,a.jsx)(n.p,{children:"No basta con que el archivo \u201ctenga datos\u201d."}),"\n",(0,a.jsx)(n.p,{children:"Tambi\xe9n hay que comprobar:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\xbfLos valores tienen sentido? (precios > 0)"}),"\n",(0,a.jsx)(n.li,{children:"\xbfNo hay duplicados conflictivos?"}),"\n",(0,a.jsx)(n.li,{children:"\xbfLas categor\xedas existen en otra tabla?"}),"\n",(0,a.jsx)(n.li,{children:"\xbfEl formato de email es v\xe1lido?"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Ejemplo:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM tmp_producto WHERE precio::NUMERIC <= 0;\nSELECT * FROM tmp_producto WHERE categoria NOT IN (SELECT nombre FROM categoria);\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\ud83d\udc49 Si algo falla, ",(0,a.jsx)(n.strong,{children:"se corrige antes de insertarlo"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"-286-cargas-idempotentes--que-no-duplican-datos",children:"\ud83e\udde0 28.6. Cargas idempotentes \u2014 que no duplican datos"}),"\n",(0,a.jsxs)(n.p,{children:["Una carga idempotente es aquella que puedes ejecutar varias veces y ",(0,a.jsx)(n.strong,{children:"el resultado es siempre el mismo"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Ejemplo inseguro \u274c:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"INSERT INTO producto (nombre, precio, categoria)\nSELECT nombre, precio, categoria FROM tmp_producto;\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"\ud83d\udc49 Si ejecutas este script dos veces \u2192 duplica los registros."}),"\n",(0,a.jsx)(n.p,{children:"Ejemplo idempotente \u2705:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"INSERT INTO producto (nombre, precio, categoria)\nSELECT nombre, precio, categoria\nFROM tmp_producto\nON CONFLICT (nombre) DO UPDATE\nSET precio = EXCLUDED.precio,\n    categoria = EXCLUDED.categoria;\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\ud83d\udc49 Si el producto ya existe, ",(0,a.jsx)(n.strong,{children:"se actualiza"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["\ud83d\udc49 Si no existe, ",(0,a.jsx)(n.strong,{children:"se inserta"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"\ud83d\udc49 Si ejecutas el script 10 veces, la tabla queda igual."}),"\n",(0,a.jsxs)(n.p,{children:["\ud83d\udccc Esto es especialmente importante en ",(0,a.jsx)(n.strong,{children:"integraciones autom\xe1ticas y cron jobs"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"-287-control-de-errores-y-reportes",children:"\ud83e\udded 28.7. Control de errores y reportes"}),"\n",(0,a.jsx)(n.p,{children:"En flujos de importaci\xf3n reales conviene:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Guardar registros inv\xe1lidos en una tabla de errores:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE import_errors (\n  id SERIAL PRIMARY KEY,\n  archivo TEXT,\n  linea INT,\n  error TEXT,\n  fecha TIMESTAMP DEFAULT NOW()\n);\n\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Validar fila a fila y registrar errores:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"INSERT INTO import_errors (archivo, linea, error)\nVALUES ('productos.csv', 42, 'Precio inv\xe1lido: abc');\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\ud83d\udc49 As\xed puedes ",(0,a.jsx)(n.strong,{children:"depurar problemas sin abortar toda la importaci\xf3n"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"-288-exportaci\xf3n-fiable",children:"\ud83e\udde0 28.8. Exportaci\xf3n fiable"}),"\n",(0,a.jsx)(n.p,{children:"La exportaci\xf3n es el proceso inverso: sacar datos de forma segura y limpia."}),"\n",(0,a.jsx)(n.p,{children:"Ejemplo simple a CSV:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"COPY (SELECT nombre, precio, categoria FROM producto)\nTO '/ruta/export/productos.csv'\nDELIMITER ','\nCSV HEADER;\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"Ejemplo a JSON:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"SELECT json_agg(row_to_json(producto)) FROM producto;\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"\ud83d\udc49 Es importante:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Asegurar formatos consistentes."}),"\n",(0,a.jsx)(n.li,{children:"Escapar caracteres especiales."}),"\n",(0,a.jsx)(n.li,{children:"Filtrar datos sensibles."}),"\n",(0,a.jsx)(n.li,{children:"Registrar qui\xe9n export\xf3 y cu\xe1ndo (auditor\xeda)."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"-289-buenas-pr\xe1cticas-en-integraciones",children:"\ud83e\udded 28.9. Buenas pr\xe1cticas en integraciones"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Nunca"})," insertes directamente sin validaci\xf3n previa."]}),"\n",(0,a.jsxs)(n.li,{children:["Usa ",(0,a.jsx)(n.strong,{children:"tablas temporales o staging"})," para limpiar datos antes."]}),"\n",(0,a.jsxs)(n.li,{children:["Implementa cargas ",(0,a.jsx)(n.strong,{children:"idempotentes"})," para evitar duplicados."]}),"\n",(0,a.jsx)(n.li,{children:"Mant\xe9n logs y errores rastreables."}),"\n",(0,a.jsx)(n.li,{children:"Establece formatos est\xe1ndar y documentados."}),"\n",(0,a.jsx)(n.li,{children:"Haz que la exportaci\xf3n sea clara, repetible y verificable."}),"\n",(0,a.jsx)(n.li,{children:"Si hay datos sensibles \u2192 aplica enmascaramiento (ver M23)."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"-2810-errores-comunes",children:"\ud83d\udea8 28.10. Errores comunes"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Cargar CSV directamente sin validar \u2192 tablas rotas."}),"\n",(0,a.jsx)(n.li,{children:"No controlar duplicados \u2192 datos inflados."}),"\n",(0,a.jsx)(n.li,{children:"Falta de idempotencia \u2192 cargas irreversibles."}),"\n",(0,a.jsx)(n.li,{children:"No manejar errores \u2192 se pierden registros fallidos."}),"\n",(0,a.jsx)(n.li,{children:"Exportar datos sensibles sin control."}),"\n",(0,a.jsx)(n.li,{children:"Falta de trazabilidad (nadie sabe qui\xe9n import\xf3 qu\xe9)."}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var r=s(6540);const a={},o=r.createContext(a);function i(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);