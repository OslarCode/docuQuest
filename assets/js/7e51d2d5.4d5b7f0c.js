"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[7618],{6111:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"backend/Node.js/testingDocumentacion","title":"Testing y documentaci\xf3n en Node.js","description":"Este m\xf3dulo se centra en c\xf3mo incorporar pruebas autom\xe1ticas y documentaci\xf3n clara a un proyecto Node.js que utiliza SQLite como base de datos. No es necesario usar frameworks complejos. Se trabaja sobre un stack Express + SQLite tradicional como el que has desarrollado previamente.","source":"@site/docs/backend/Node.js/testingDocumentacion.md","sourceDirName":"backend/Node.js","slug":"/backend/Node.js/testingDocumentacion","permalink":"/docuQuest/docs/backend/Node.js/testingDocumentacion","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/Node.js/testingDocumentacion.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Express.js con ES Modules","permalink":"/docuQuest/docs/backend/Node.js/expressJS"},"next":{"title":"Despliegue y buenas pr\xe1cticas en aplicaciones Node.js","permalink":"/docuQuest/docs/backend/Node.js/seguridadBuenasPracticas"}}');var t=s(4848),o=s(8453);const i={},a="Testing y documentaci\xf3n en Node.js",c={},d=[{value:"1. Enfoque pr\xe1ctico de testing",id:"1-enfoque-pr\xe1ctico-de-testing",level:2},{value:"1.1. Configuraci\xf3n base",id:"11-configuraci\xf3n-base",level:3},{value:"1.2. Base de datos temporal para testing",id:"12-base-de-datos-temporal-para-testing",level:3},{value:"2. Tests unitarios: funciones y repositorios",id:"2-tests-unitarios-funciones-y-repositorios",level:2},{value:"3. Tests de integraci\xf3n: Express + SQLite",id:"3-tests-de-integraci\xf3n-express--sqlite",level:2},{value:"4. Tests end-to-end simples",id:"4-tests-end-to-end-simples",level:2},{value:"5. Documentaci\xf3n de la API",id:"5-documentaci\xf3n-de-la-api",level:2},{value:"6. Recomendaciones finales",id:"6-recomendaciones-finales",level:2},{value:"Recursos recomendados",id:"recursos-recomendados",level:2},{value:"Bloque opcional: CI/CD con GitHub Actions para tests y documentaci\xf3n",id:"bloque-opcional-cicd-con-github-actions-para-tests-y-documentaci\xf3n",level:2},{value:"Scripts recomendados en <code>package.json</code>",id:"scripts-recomendados-en-packagejson",level:3},{value:"Script para generar OpenAPI JSON",id:"script-para-generar-openapi-json",level:3},{value:"Workflow de GitHub Actions",id:"workflow-de-github-actions",level:3},{value:"Variante alternativa: base en memoria",id:"variante-alternativa-base-en-memoria",level:3},{value:"Sugerencias adicionales",id:"sugerencias-adicionales",level:3}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"testing-y-documentaci\xf3n-en-nodejs",children:"Testing y documentaci\xf3n en Node.js"})}),"\n",(0,t.jsx)(n.p,{children:"Este m\xf3dulo se centra en c\xf3mo incorporar pruebas autom\xe1ticas y documentaci\xf3n clara a un proyecto Node.js que utiliza SQLite como base de datos. No es necesario usar frameworks complejos. Se trabaja sobre un stack Express + SQLite tradicional como el que has desarrollado previamente."}),"\n",(0,t.jsx)(n.h2,{id:"1-enfoque-pr\xe1ctico-de-testing",children:"1. Enfoque pr\xe1ctico de testing"}),"\n",(0,t.jsx)(n.p,{children:"El testing intermedio en un backend con SQLite debe cubrir al menos tres capas:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Tests unitarios"}),": validan funciones puras, l\xf3gica interna o repositorios."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Tests de integraci\xf3n"}),": validan la interacci\xf3n entre Express y SQLite (por ejemplo, rutas y DB real/temporal)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Tests end-to-end simples"}),": validan flujos completos como si fueras un cliente (sin frontend real, usando herramientas como Supertest o fetch)."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"11-configuraci\xf3n-base",children:"1.1. Configuraci\xf3n base"}),"\n",(0,t.jsx)(n.p,{children:"Instalaci\xf3n de dependencias:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install -D vitest supertest\r\n\n"})}),"\n",(0,t.jsxs)(n.p,{children:["En ",(0,t.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'"scripts": {\r\n  "test": "vitest run",\r\n  "test:watch": "vitest"\r\n}\r\n\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Crea un archivo ",(0,t.jsx)(n.code,{children:"vitest.config.js"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import { defineConfig } from "vitest/config";\r\n\r\nexport default defineConfig({\r\n  test: {\r\n    globals: true,\r\n    environment: "node",\r\n  },\r\n});\n'})}),"\n",(0,t.jsx)(n.p,{children:"Esto configura un entorno de test ligero sin necesidad de Jest."}),"\n",(0,t.jsx)(n.h3,{id:"12-base-de-datos-temporal-para-testing",children:"1.2. Base de datos temporal para testing"}),"\n",(0,t.jsxs)(n.p,{children:["Para evitar alterar datos reales, usa una ",(0,t.jsxs)(n.strong,{children:["copia temporal del archivo ",(0,t.jsx)(n.code,{children:".db"})]})," o ",(0,t.jsx)(n.code,{children:":memory:"}),":"]}),"\n",(0,t.jsxs)(n.p,{children:["Archivo: ",(0,t.jsx)(n.code,{children:"tests/helpers/dbTest.js"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import fs from "fs";\r\nimport path from "path";\r\nimport Database from "better-sqlite3";\r\n\r\nexport function setupTestDb() {\r\n  const original = path.join(process.cwd(), "data", "app.db");\r\n  const tmpDir = path.join(process.cwd(), "tests", "tmp");\r\n  if (!fs.existsSync(tmpDir)) fs.mkdirSync(tmpDir, { recursive: true });\r\n\r\n  const tmpFile = path.join(tmpDir, `test-${Date.now()}.db`);\r\n  fs.copyFileSync(original, tmpFile);\r\n\r\n  const db = new Database(tmpFile);\r\n\r\n  const cleanup = () => {\r\n    db.close();\r\n    if (fs.existsSync(tmpFile)) fs.unlinkSync(tmpFile);\r\n  };\r\n\r\n  return { db, cleanup };\r\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Para usar una base en memoria:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'const db = new Database(":memory:");\n'})}),"\n",(0,t.jsx)(n.p,{children:"En ese caso, deber\xedas ejecutar las migraciones antes de los tests."}),"\n",(0,t.jsx)(n.h2,{id:"2-tests-unitarios-funciones-y-repositorios",children:"2. Tests unitarios: funciones y repositorios"}),"\n",(0,t.jsxs)(n.p,{children:["Sup\xf3n que tienes un repositorio ",(0,t.jsx)(n.code,{children:"proyectosRepo.js"})," con m\xe9todos ",(0,t.jsx)(n.code,{children:"list"})," y ",(0,t.jsx)(n.code,{children:"create"}),". Los tests unitarios se enfocan en estos m\xe9todos sin levantar un servidor Express."]}),"\n",(0,t.jsxs)(n.p,{children:["Archivo: ",(0,t.jsx)(n.code,{children:"tests/proyectos.repo.test.js"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import { describe, it, expect, beforeAll, afterAll } from "vitest";\r\nimport { setupTestDb } from "./helpers/dbTest.js";\r\n\r\nlet db, repo, cleanup;\r\n\r\nbeforeAll(() => {\r\n  const env = setupTestDb();\r\n  db = env.db;\r\n  cleanup = env.cleanup;\r\n  repo = require("../src/repos/proyectosRepo");\r\n  repo._setDbInstance(db); // si tu repo permite inyecci\xf3n de DB\r\n});\r\n\r\nafterAll(() => {\r\n  cleanup();\r\n});\r\n\r\ndescribe("Repositorio de proyectos", () => {\r\n  it("debe insertar y listar proyectos", () => {\r\n    repo.create({ titulo: "Test A", descripcion: "Demo" });\r\n    const all = repo.list();\r\n    expect(all.length).toBeGreaterThan(0);\r\n    expect(all[0].titulo).toBe("Test A");\r\n  });\r\n});\n'})}),"\n",(0,t.jsx)(n.p,{children:"Si tu repositorio no permite inyecci\xf3n de DB, puedes adaptar su l\xf3gica para que lo haga. Esto mejora mucho la testabilidad."}),"\n",(0,t.jsx)(n.h2,{id:"3-tests-de-integraci\xf3n-express--sqlite",children:"3. Tests de integraci\xf3n: Express + SQLite"}),"\n",(0,t.jsx)(n.p,{children:"En este caso, probamos las rutas directamente, simulando peticiones HTTP con Supertest. No necesitas iniciar manualmente el servidor."}),"\n",(0,t.jsxs)(n.p,{children:["Archivo: ",(0,t.jsx)(n.code,{children:"tests/proyectos.routes.test.js"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import { describe, it, expect, beforeAll, afterAll } from "vitest";\r\nimport request from "supertest";\r\nimport express from "express";\r\nimport fs from "fs";\r\nimport path from "path";\r\nimport Database from "better-sqlite3";\r\nimport proyectosRoutes from "../src/routes/proyectos.js";\r\n\r\nlet app, db, tmpFile;\r\n\r\nbeforeAll(() => {\r\n  // Clonamos base\r\n  const original = path.join(process.cwd(), "data", "app.db");\r\n  const tmpDir = path.join(process.cwd(), "tests", "tmp");\r\n  if (!fs.existsSync(tmpDir)) fs.mkdirSync(tmpDir, { recursive: true });\r\n  tmpFile = path.join(tmpDir, `test-${Date.now()}.db`);\r\n  fs.copyFileSync(original, tmpFile);\r\n  db = new Database(tmpFile);\r\n  require("../src/db/connection")._setInstance(db);\r\n\r\n  app = express();\r\n  app.use(express.json());\r\n  app.use("/api/proyectos", proyectosRoutes);\r\n});\r\n\r\nafterAll(() => {\r\n  db.close();\r\n  if (fs.existsSync(tmpFile)) fs.unlinkSync(tmpFile);\r\n});\r\n\r\ndescribe("Rutas de proyectos", () => {\r\n  it("debe crear y listar proyectos", async () => {\r\n    const nuevo = { titulo: "Proyecto X", descripcion: "Test de integraci\xf3n" };\r\n    await request(app).post("/api/proyectos").send(nuevo).expect(201);\r\n    const res = await request(app).get("/api/proyectos").expect(200);\r\n    expect(res.body.length).toBeGreaterThan(0);\r\n  });\r\n});\n'})}),"\n",(0,t.jsx)(n.p,{children:"Este enfoque es el que m\xe1s se usa en proyectos reales: aisla la base, monta el servidor en memoria y prueba la API como si fueras un cliente."}),"\n",(0,t.jsx)(n.h2,{id:"4-tests-end-to-end-simples",children:"4. Tests end-to-end simples"}),"\n",(0,t.jsx)(n.p,{children:"En proyectos peque\xf1os puedes simular flujos completos (por ejemplo, creaci\xf3n y b\xfasqueda) sin necesidad de Cypress ni entornos pesados. Esto se hace con Supertest tambi\xe9n, combinando varias llamadas:"}),"\n",(0,t.jsxs)(n.p,{children:["Archivo: ",(0,t.jsx)(n.code,{children:"tests/proyectos.e2e.test.js"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import { describe, it, expect } from "vitest";\r\nimport request from "supertest";\r\nimport app from "../src/server.js";\r\n\r\ndescribe("E2E: flujo de proyectos", () => {\r\n  it("crea un proyecto y lo obtiene", async () => {\r\n    const nuevo = { titulo: "E2E Test", descripcion: "Flujo completo" };\r\n    const createRes = await request(app).post("/api/proyectos").send(nuevo);\r\n    expect(createRes.status).toBe(201);\r\n\r\n    const listRes = await request(app).get("/api/proyectos");\r\n    const found = listRes.body.find((p) => p.titulo === "E2E Test");\r\n    expect(found).toBeDefined();\r\n  });\r\n});\n'})}),"\n",(0,t.jsx)(n.p,{children:"Este tipo de test es \xfatil para pipelines CI/CD simples."}),"\n",(0,t.jsx)(n.h2,{id:"5-documentaci\xf3n-de-la-api",children:"5. Documentaci\xf3n de la API"}),"\n",(0,t.jsxs)(n.p,{children:["Adem\xe1s del testing, una API real debe ",(0,t.jsx)(n.strong,{children:"estar documentada"}),". La forma m\xe1s com\xfan es usar ",(0,t.jsx)(n.strong,{children:"OpenAPI/Swagger"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Instalaci\xf3n:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install swagger-jsdoc swagger-ui-express\r\n\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Archivo: ",(0,t.jsx)(n.code,{children:"src/docs/swagger.js"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import swaggerJSDoc from "swagger-jsdoc";\r\n\r\nconst options = {\r\n  definition: {\r\n    openapi: "3.0.0",\r\n    info: {\r\n      title: "API de Proyectos",\r\n      version: "1.0.0",\r\n      description: "Documentaci\xf3n de la API Express con SQLite",\r\n    },\r\n  },\r\n  apis: ["./src/routes/*.js"], // busca comentarios JSDoc en rutas\r\n};\r\n\r\nexport const swaggerSpec = swaggerJSDoc(options);\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Archivo: ",(0,t.jsx)(n.code,{children:"src/server.js"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import express from "express";\r\nimport swaggerUi from "swagger-ui-express";\r\nimport { swaggerSpec } from "./docs/swagger.js";\r\nimport proyectosRoutes from "./routes/proyectos.js";\r\n\r\nconst app = express();\r\napp.use(express.json());\r\n\r\napp.use("/api/proyectos", proyectosRoutes);\r\napp.use("/docs", swaggerUi.serve, swaggerUi.setup(swaggerSpec));\r\n\r\nexport default app;\n'})}),"\n",(0,t.jsx)(n.p,{children:"Comenta las rutas con JSDoc:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'/**\r\n * @openapi\r\n * /api/proyectos:\r\n *   get:\r\n *     summary: Lista todos los proyectos\r\n *     responses:\r\n *       200:\r\n *         description: Lista de proyectos\r\n */\r\nrouter.get("/", (req, res) => { ... });\r\n\n'})}),"\n",(0,t.jsx)(n.p,{children:"Al levantar el servidor:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"<http://localhost:3000/docs>\r\n\n"})}),"\n",(0,t.jsx)(n.p,{children:"ver\xe1s la documentaci\xf3n interactiva."}),"\n",(0,t.jsx)(n.h2,{id:"6-recomendaciones-finales",children:"6. Recomendaciones finales"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Automatiza los tests"}),": ejec\xfatalos en cada push con GitHub Actions o similar."]}),"\n",(0,t.jsxs)(n.li,{children:["Mant\xe9n ",(0,t.jsx)(n.strong,{children:"una base temporal limpia"})," para cada test."]}),"\n",(0,t.jsxs)(n.li,{children:["Documenta tus endpoints ",(0,t.jsx)(n.strong,{children:"junto con el c\xf3digo"})," para no desincronizar."]}),"\n",(0,t.jsx)(n.li,{children:"Los tests de integraci\xf3n + Swagger cubren el 80% de necesidades reales de proyectos medianos."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"recursos-recomendados",children:"Recursos recomendados"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://vitest.dev/",children:"Vitest"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/ladjs/supertest",children:"Supertest"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://swagger.io/specification/",children:"Swagger/OpenAPI"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/WiseLibs/better-sqlite3",children:"better-sqlite3"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"bloque-opcional-cicd-con-github-actions-para-tests-y-documentaci\xf3n",children:"Bloque opcional: CI/CD con GitHub Actions para tests y documentaci\xf3n"}),"\n",(0,t.jsx)(n.p,{children:"Objetivo: ejecutar autom\xe1ticamente los tests (con base SQLite temporal) y generar/exportar la documentaci\xf3n OpenAPI en cada push y pull request. Este bloque asume tu stack Express + SQLite y los scripts de test ya configurados con Vitest y Supertest."}),"\n",(0,t.jsxs)(n.h3,{id:"scripts-recomendados-en-packagejson",children:["Scripts recomendados en ",(0,t.jsx)(n.code,{children:"package.json"})]}),"\n",(0,t.jsx)(n.p,{children:"Aseg\xfarate de tener estos scripts (aj\xfastalos a tu proyecto):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\r\n  "scripts": {\r\n    "dev": "nodemon src/server.js",\r\n    "start": "node src/server.js",\r\n    "test": "vitest run",\r\n    "test:watch": "vitest",\r\n    "test:ci": "vitest run --coverage",\r\n    "db:migrate": "node ./scripts/run-migrations.js",\r\n    "db:seed": "node ./scripts/run-seeds.js",\r\n    "docs:build": "node ./scripts/build-openapi.js"\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Notas:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"db:migrate"})," y ",(0,t.jsx)(n.code,{children:"db:seed"})," deben aplicar tus migraciones y datos de prueba sobre la base temporal."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"docs:build"})," generar\xe1 un ",(0,t.jsx)(n.code,{children:"openapi.json"})," a partir de tu ",(0,t.jsx)(n.code,{children:"swaggerSpec"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"script-para-generar-openapi-json",children:"Script para generar OpenAPI JSON"}),"\n",(0,t.jsxs)(n.p,{children:["Archivo: ",(0,t.jsx)(n.code,{children:"scripts/build-openapi.js"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'// Genera un openapi.json desde tu swaggerSpec para publicarlo como artefacto del pipeline\r\nimport fs from "fs";\r\nimport path from "path";\r\nimport { fileURLToPath } from "url";\r\nimport swaggerJSDoc from "swagger-jsdoc";\r\n\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\n// Ajusta rutas a tus archivos de rutas con anotaciones @openapi\r\nconst options = {\r\n  definition: {\r\n    openapi: "3.0.0",\r\n    info: { title: "API de Proyectos", version: "1.0.0" },\r\n  },\r\n  apis: ["./src/routes/*.js"],\r\n};\r\n\r\nconst spec = swaggerJSDoc(options);\r\nconst outDir = path.join(process.cwd(), "artifacts");\r\nif (!fs.existsSync(outDir)) fs.mkdirSync(outDir, { recursive: true });\r\n\r\nconst outPath = path.join(outDir, "openapi.json");\r\nfs.writeFileSync(outPath, JSON.stringify(spec, null, 2), "utf8");\r\nconsole.log("OpenAPI exportado en:", outPath);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"workflow-de-github-actions",children:"Workflow de GitHub Actions"}),"\n",(0,t.jsxs)(n.p,{children:["Archivo: ",(0,t.jsx)(n.code,{children:".github/workflows/ci.yml"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'name: CI\r\n\r\non:\r\n  push:\r\n    branches: ["**"]\r\n  pull_request:\r\n    branches: ["**"]\r\n\r\npermissions:\r\n  contents: read\r\n\r\njobs:\r\n  test-and-docs:\r\n    runs-on: ubuntu-latest\r\n    strategy:\r\n      matrix:\r\n        node-version: [18.x, 20.x] # Ajusta a tus versiones objetivo\r\n    steps:\r\n      - name: Checkout\r\n        uses: actions/checkout@v4\r\n\r\n      - name: Use Node.js ${{ matrix.node-version }}\r\n        uses: actions/setup-node@v4\r\n        with:\r\n          node-version: ${{ matrix.node-version }}\r\n          cache: "npm"\r\n\r\n      - name: Install deps\r\n        run: npm ci\r\n\r\n      - name: Prepare CI test DB\r\n        run: |\r\n          mkdir -p data\r\n          # Base temporal para CI; no uses la de desarrollo\r\n          rm -f data/app.ci.db\r\n          # Si usas migraciones con better-sqlite3, crea un archivo vac\xedo y migra\r\n          node -e "require(\'fs\').writeFileSync(\'data/app.ci.db\',\'\')"\r\n          npm run db:migrate\r\n          # Opcional: seed de datos de ejemplo\r\n          if npm run | grep -q "db:seed"; then npm run db:seed; fi\r\n        env:\r\n          DATABASE_URL: ./data/app.ci.db\r\n\r\n      - name: Run tests with coverage\r\n        run: npm run test:ci\r\n        env:\r\n          DATABASE_URL: ./data/app.ci.db\r\n          NODE_ENV: test\r\n\r\n      - name: Build OpenAPI JSON\r\n        run: npm run docs:build\r\n\r\n      - name: Upload coverage artifact\r\n        if: always()\r\n        uses: actions/upload-artifact@v4\r\n        with:\r\n          name: coverage-${{ matrix.node-version }}\r\n          path: coverage/\r\n          if-no-files-found: ignore\r\n\r\n      - name: Upload OpenAPI artifact\r\n        uses: actions/upload-artifact@v4\r\n        with:\r\n          name: openapi-${{ matrix.node-version }}\r\n          path: artifacts/openapi.json\n'})}),"\n",(0,t.jsx)(n.p,{children:"Comentarios:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"DATABASE_URL"})," apunta a ",(0,t.jsx)(n.code,{children:"./data/app.ci.db"})," para no tocar tu base local. El job crea el archivo y ejecuta migraciones y seed si existen."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"npm run test:ci"})," ejecuta Vitest con cobertura. Puedes publicar el informe en un servicio externo si lo necesitas."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"docs:build"})," genera ",(0,t.jsx)(n.code,{children:"artifacts/openapi.json"})," y se sube como artefacto descargable del pipeline."]}),"\n",(0,t.jsx)(n.li,{children:"La matrix de Node verifica compatibilidad en versiones clave."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"variante-alternativa-base-en-memoria",children:"Variante alternativa: base en memoria"}),"\n",(0,t.jsx)(n.p,{children:"Si prefieres usar SQLite en memoria para tests m\xe1s r\xe1pidos, sustituye las variables de entorno de los pasos de test por:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'env:\r\n  DATABASE_URL: "file::memory:?cache=shared"\r\n  NODE_ENV: test\n'})}),"\n",(0,t.jsx)(n.p,{children:"y aseg\xfarate de que tus tests ejecuten las migraciones antes de correr."}),"\n",(0,t.jsx)(n.h3,{id:"sugerencias-adicionales",children:"Sugerencias adicionales"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"A\xf1ade un job opcional de lint:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'lint:\r\n  runs-on: ubuntu-latest\r\n  steps:\r\n    - uses: actions/checkout@v4\r\n    - uses: actions/setup-node@v4\r\n      with: { node-version: 20.x, cache: "npm" }\r\n    - run: npm ci\r\n    - run: npm run lint\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Si vas a desplegar a Render o Railway, crea un job separado que se ejecute solo en ",(0,t.jsx)(n.code,{children:"main"})," y dependa de que ",(0,t.jsx)(n.code,{children:"test-and-docs"})," termine con \xe9xito."]}),"\n",(0,t.jsxs)(n.li,{children:["Si versionas tus migraciones, considera subir tambi\xe9n como artefacto el directorio ",(0,t.jsx)(n.code,{children:"migrations/"})," para auditor\xeda."]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>a});var r=s(6540);const t={},o=r.createContext(t);function i(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);