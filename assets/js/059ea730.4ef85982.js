"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[4469],{1550:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"backend/sqlite/relacionesYConsultas","title":"Relaciones y consultas expresivas","description":"1. JOIN \u2014 Unir tablas y evitar consultas \u201cen cascada\u201d","source":"@site/docs/backend/sqlite/relacionesYConsultas.md","sourceDirName":"backend/sqlite","slug":"/backend/sqlite/relacionesYConsultas","permalink":"/docuQuest/docs/backend/sqlite/relacionesYConsultas","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/sqlite/relacionesYConsultas.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Tipos y calidad de datos en SQLite","permalink":"/docuQuest/docs/backend/sqlite/tiposDatos"},"next":{"title":"Indices y planificador de consultas","permalink":"/docuQuest/docs/backend/sqlite/indicesYPlanificador"}}');var c=s(4848),l=s(8453);const a={},r="Relaciones y consultas expresivas",d={},o=[{value:"1. JOIN \u2014 Unir tablas y evitar consultas \u201cen cascada\u201d",id:"1-join--unir-tablas-y-evitar-consultas-en-cascada",level:2},{value:"Recordatorio de estructura",id:"recordatorio-de-estructura",level:3},{value:"2. INNER JOIN \u2014 la uni\xf3n m\xe1s com\xfan",id:"2-inner-join--la-uni\xf3n-m\xe1s-com\xfan",level:2},{value:"3. LEFT JOIN \u2014 incluso si no hay coincidencia",id:"3-left-join--incluso-si-no-hay-coincidencia",level:2},{value:"4. RIGHT JOIN y FULL JOIN",id:"4-right-join-y-full-join",level:2},{value:"5. JOIN + filtros y ordenamiento",id:"5-join--filtros-y-ordenamiento",level:2},{value:"6. JOIN entre m\xe1s de dos tablas",id:"6-join-entre-m\xe1s-de-dos-tablas",level:2},{value:"Ejercicio pr\xe1ctico \u2014 JOIN b\xe1sico y LEFT JOIN",id:"ejercicio-pr\xe1ctico--join-b\xe1sico-y-left-join",level:2},{value:"Buenas pr\xe1cticas con JOINs",id:"buenas-pr\xe1cticas-con-joins",level:2},{value:"1. Qu\xe9 es una VIEW (vista)",id:"1-qu\xe9-es-una-view-vista",level:2},{value:"Ejemplo b\xe1sico de VIEW",id:"ejemplo-b\xe1sico-de-view",level:3},{value:"Modificar o eliminar una VIEW",id:"modificar-o-eliminar-una-view",level:3},{value:"Ejercicio r\xe1pido con VIEW",id:"ejercicio-r\xe1pido-con-view",level:3},{value:"2. Qu\xe9 es una CTE (Common Table Expression)",id:"2-qu\xe9-es-una-cte-common-table-expression",level:2},{value:"Ejemplo pr\xe1ctico de CTE",id:"ejemplo-pr\xe1ctico-de-cte",level:3},{value:"3. CTE encadenadas (m\xfaltiples WITH)",id:"3-cte-encadenadas-m\xfaltiples-with",level:2},{value:"4. CTE recursivas (opcional avanzado)",id:"4-cte-recursivas-opcional-avanzado",level:2},{value:"5. Ejercicio pr\xe1ctico \u2014 CTE en acci\xf3n",id:"5-ejercicio-pr\xe1ctico--cte-en-acci\xf3n",level:2},{value:"6. Buenas pr\xe1cticas con VIEWS y CTEs",id:"6-buenas-pr\xe1cticas-con-views-y-ctes",level:2},{value:"Errores comunes",id:"errores-comunes",level:2}];function t(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"relaciones-y-consultas-expresivas",children:"Relaciones y consultas expresivas"})}),"\n",(0,c.jsx)(n.h2,{id:"1-join--unir-tablas-y-evitar-consultas-en-cascada",children:"1. JOIN \u2014 Unir tablas y evitar consultas \u201cen cascada\u201d"}),"\n",(0,c.jsxs)(n.p,{children:["Un ",(0,c.jsx)(n.strong,{children:"JOIN"})," te permite ",(0,c.jsx)(n.strong,{children:"combinar datos de varias tablas"})," en una sola consulta."]}),"\n",(0,c.jsx)(n.p,{children:"Imagina que tienes:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"clients"})," \u2192 informaci\xf3n de clientes"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"orders"})," \u2192 pedidos que pertenecen a esos clientes"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Queremos obtener:"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.em,{children:"Nombre del cliente + total del pedido + fecha"})," en una sola tabla."]}),"\n",(0,c.jsx)(n.h3,{id:"recordatorio-de-estructura",children:"Recordatorio de estructura"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE clients (\n  id INTEGER PRIMARY KEY,\n  name TEXT NOT NULL,\n  email TEXT UNIQUE NOT NULL\n) STRICT;\n\nCREATE TABLE orders (\n  id INTEGER PRIMARY KEY,\n  client_id INTEGER NOT NULL,\n  total REAL NOT NULL,\n  created_at TEXT NOT NULL DEFAULT (strftime('%Y-%m-%dT%H:%M:%fZ','now')),\n  FOREIGN KEY (client_id) REFERENCES clients(id)\n) STRICT;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Insertamos algunos datos:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"INSERT INTO clients (name, email) VALUES\n('Ana', 'ana@example.com'),\n('Luis', 'luis@example.com');\n\nINSERT INTO orders (client_id, total) VALUES\n(1, 49.99),\n(1, 89.90),\n(2, 120.00);\n\n"})}),"\n",(0,c.jsx)(n.h2,{id:"2-inner-join--la-uni\xf3n-m\xe1s-com\xfan",children:"2. INNER JOIN \u2014 la uni\xf3n m\xe1s com\xfan"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"INNER JOIN"})," devuelve solo las filas que tienen coincidencias en ambas tablas."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"SELECT\n  orders.id AS order_id,\n  clients.name AS client_name,\n  orders.total,\n  orders.created_at\nFROM orders\nINNER JOIN clients\n  ON orders.client_id = clients.id;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Qu\xe9 hace esto:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Toma cada ",(0,c.jsx)(n.code,{children:"order"})]}),"\n",(0,c.jsxs)(n.li,{children:["Busca al ",(0,c.jsx)(n.code,{children:"client"})," que coincida en ",(0,c.jsx)(n.code,{children:"client_id"})]}),"\n",(0,c.jsx)(n.li,{children:"Devuelve solo las filas donde hay coincidencia."}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Resultado:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"order_id | client_name | total  | created_at\n--------------------------------------------\n1        | Ana         | 49.99  | ...\n2        | Ana         | 89.90  | ...\n3        | Luis        | 120.00 | ...\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Nota pr\xe1ctica:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Siempre especifica los nombres de tabla con prefijo (",(0,c.jsx)(n.code,{children:"orders.total"})," en vez de ",(0,c.jsx)(n.code,{children:"total"}),") cuando haces JOINs."]}),"\n",(0,c.jsxs)(n.li,{children:["Usa alias (",(0,c.jsx)(n.code,{children:"AS"}),") para que las columnas tengan nombres claros."]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"3-left-join--incluso-si-no-hay-coincidencia",children:"3. LEFT JOIN \u2014 incluso si no hay coincidencia"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"LEFT JOIN"})," devuelve ",(0,c.jsx)(n.strong,{children:"todas las filas de la tabla izquierda"})," (la primera), aunque no haya coincidencia en la derecha."]}),"\n",(0,c.jsx)(n.p,{children:"Ejemplo:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"SELECT\n  c.name AS client,\n  o.id AS order_id,\n  o.total\nFROM clients c\nLEFT JOIN orders o\n  ON c.id = o.client_id;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Si tuvieras un cliente sin pedidos:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"order_id | client  | total\n--------------------------\n1        | Ana     | 49.99\n2        | Ana     | 89.90\n3        | Luis    | 120.00\nNULL     | Marta   | NULL\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Muy \xfatil para detectar registros \u201csin actividad\u201d."}),"\n",(0,c.jsx)(n.h2,{id:"4-right-join-y-full-join",children:"4. RIGHT JOIN y FULL JOIN"}),"\n",(0,c.jsxs)(n.p,{children:["SQLite no soporta ",(0,c.jsx)(n.code,{children:"RIGHT JOIN"})," ni ",(0,c.jsx)(n.code,{children:"FULL JOIN"})," directamente."]}),"\n",(0,c.jsxs)(n.p,{children:["Pero puedes lograr el mismo resultado invirtiendo tablas (",(0,c.jsx)(n.code,{children:"RIGHT"})," \u2192 ",(0,c.jsx)(n.code,{children:"LEFT"}),") o usando CTEs o ",(0,c.jsx)(n.code,{children:"UNION"}),"."]}),"\n",(0,c.jsx)(n.p,{children:"Ejemplo equivalente a RIGHT JOIN:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"SELECT\n  o.id AS order_id,\n  c.name AS client,\n  o.total\nFROM orders o\nLEFT JOIN clients c\n  ON c.id = o.client_id;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Igual que un RIGHT JOIN cl\xe1sico, pero cambiando el orden."}),"\n",(0,c.jsx)(n.h2,{id:"5-join--filtros-y-ordenamiento",children:"5. JOIN + filtros y ordenamiento"}),"\n",(0,c.jsxs)(n.p,{children:["Puedes aplicar ",(0,c.jsx)(n.code,{children:"WHERE"}),", ",(0,c.jsx)(n.code,{children:"ORDER BY"})," y ",(0,c.jsx)(n.code,{children:"LIMIT"})," igual que en cualquier ",(0,c.jsx)(n.code,{children:"SELECT"}),"."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"SELECT\n  c.name AS client,\n  o.total\nFROM clients c\nINNER JOIN orders o\n  ON c.id = o.client_id\nWHERE o.total > 80\nORDER BY o.total DESC\nLIMIT 5;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Resultado:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"client | total\n---------------\nLuis   | 120.00\nAna    | 89.90\n\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Esto es ",(0,c.jsx)(n.strong,{children:"muy potente"})," cuando tienes relaciones N\u21921."]}),"\n",(0,c.jsx)(n.h2,{id:"6-join-entre-m\xe1s-de-dos-tablas",children:"6. JOIN entre m\xe1s de dos tablas"}),"\n",(0,c.jsx)(n.p,{children:"Puedes encadenar varios JOINs:"}),"\n",(0,c.jsxs)(n.p,{children:["Supongamos que tenemos otra tabla ",(0,c.jsx)(n.code,{children:"products"})," y una tabla ",(0,c.jsx)(n.code,{children:"order_items"})," para pedidos con varios productos:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"SELECT\n  c.name AS client,\n  o.id AS order_id,\n  p.name AS product,\n  oi.quantity,\n  (oi.quantity * p.price) AS subtotal\nFROM clients c\nINNER JOIN orders o\n  ON c.id = o.client_id\nINNER JOIN order_items oi\n  ON o.id = oi.order_id\nINNER JOIN products p\n  ON oi.product_id = p.id;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"As\xed puedes armar informes complejos de facturaci\xf3n, inventario, etc."}),"\n",(0,c.jsx)(n.h2,{id:"ejercicio-pr\xe1ctico--join-b\xe1sico-y-left-join",children:"Ejercicio pr\xe1ctico \u2014 JOIN b\xe1sico y LEFT JOIN"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Crea un cliente sin pedidos:"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"INSERT INTO clients (name, email) VALUES ('Marta', 'marta@example.com');\n\n"})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Haz un ",(0,c.jsx)(n.code,{children:"INNER JOIN"})," entre clientes y pedidos."]}),"\n",(0,c.jsx)(n.p,{children:"No aparecer\xe1 Marta."}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Haz un ",(0,c.jsx)(n.code,{children:"LEFT JOIN"})," entre clientes y pedidos."]}),"\n",(0,c.jsxs)(n.p,{children:["Ahora Marta aparecer\xe1 con ",(0,c.jsx)(n.code,{children:"NULL"})," en las columnas de pedidos."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:"Ordena por nombre de cliente."}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"buenas-pr\xe1cticas-con-joins",children:"Buenas pr\xe1cticas con JOINs"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Usa alias cortos (",(0,c.jsx)(n.code,{children:"c"}),", ",(0,c.jsx)(n.code,{children:"o"}),", ",(0,c.jsx)(n.code,{children:"p"}),") para que la consulta sea m\xe1s legible."]}),"\n",(0,c.jsxs)(n.li,{children:["Prefiere ",(0,c.jsx)(n.code,{children:"INNER JOIN"})," para datos que ",(0,c.jsx)(n.strong,{children:"deben coincidir"})," y ",(0,c.jsx)(n.code,{children:"LEFT JOIN"})," para ",(0,c.jsx)(n.strong,{children:"auditor\xedas"})," o reportes."]}),"\n",(0,c.jsxs)(n.li,{children:["Siempre usa ",(0,c.jsx)(n.code,{children:"ON"})," con condiciones claras (",(0,c.jsx)(n.code,{children:"c.id = o.client_id"}),")."]}),"\n",(0,c.jsxs)(n.li,{children:["Evita usar ",(0,c.jsx)(n.code,{children:"NATURAL JOIN"})," \u2014 es m\xe1s propenso a errores ocultos."]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"1-qu\xe9-es-una-view-vista",children:"1. Qu\xe9 es una VIEW (vista)"}),"\n",(0,c.jsxs)(n.p,{children:["Una ",(0,c.jsx)(n.strong,{children:"VIEW"})," en SQLite es b\xe1sicamente una ",(0,c.jsx)(n.strong,{children:"consulta guardada"})," que se comporta como si fuera una tabla."]}),"\n",(0,c.jsxs)(n.p,{children:["No almacena datos nuevos \u2014 simplemente ",(0,c.jsx)(n.strong,{children:"muestra datos existentes"})," de manera estructurada."]}),"\n",(0,c.jsx)(n.p,{children:"Esto es muy \xfatil cuando tienes consultas JOIN complejas que necesitas usar muchas veces."}),"\n",(0,c.jsx)(n.h3,{id:"ejemplo-b\xe1sico-de-view",children:"Ejemplo b\xe1sico de VIEW"}),"\n",(0,c.jsx)(n.p,{children:"Imagina que tenemos nuestra relaci\xf3n:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"clients"})," \u2192 clientes"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"orders"})," \u2192 pedidos"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["Y queremos obtener un ",(0,c.jsx)(n.strong,{children:"informe combinado"})," con:"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"nombre del cliente,"}),"\n",(0,c.jsx)(n.li,{children:"n\xfamero de pedido,"}),"\n",(0,c.jsx)(n.li,{children:"total,"}),"\n",(0,c.jsx)(n.li,{children:"fecha."}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"La consulta es esta:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"SELECT\n  o.id AS order_id,\n  c.name AS client_name,\n  o.total,\n  o.created_at\nFROM orders o\nINNER JOIN clients c\n  ON o.client_id = c.id;\n\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Ahora, en lugar de repetir esta consulta en varios informes, la guardamos como una ",(0,c.jsx)(n.strong,{children:"VIEW"}),":"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE VIEW IF NOT EXISTS view_orders_clients AS\nSELECT\n  o.id AS order_id,\n  c.name AS client_name,\n  o.total,\n  o.created_at\nFROM orders o\nINNER JOIN clients c\n  ON o.client_id = c.id;\n\n"})}),"\n",(0,c.jsxs)(n.p,{children:["A partir de aqu\xed, podemos consultar ",(0,c.jsx)(n.strong,{children:"como si fuera una tabla"}),":"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM view_orders_clients;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Resultado id\xe9ntico, pero con una consulta mucho m\xe1s limpia."}),"\n",(0,c.jsx)(n.h3,{id:"modificar-o-eliminar-una-view",children:"Modificar o eliminar una VIEW"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Ver la definici\xf3n de la vista:"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:".schema view_orders_clients\n\n"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Eliminarla si es necesario:"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"DROP VIEW IF EXISTS view_orders_clients;\n\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Nota: SQLite ",(0,c.jsxs)(n.strong,{children:["no permite ",(0,c.jsx)(n.code,{children:"CREATE OR REPLACE VIEW"})]})," directamente, debes ",(0,c.jsx)(n.code,{children:"DROP"})," y volver a ",(0,c.jsx)(n.code,{children:"CREATE"})," si quieres actualizarla."]}),"\n",(0,c.jsx)(n.h3,{id:"ejercicio-r\xe1pido-con-view",children:"Ejercicio r\xe1pido con VIEW"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["Crea una VIEW ",(0,c.jsx)(n.code,{children:"view_orders_clients"})," como el ejemplo anterior."]}),"\n",(0,c.jsxs)(n.li,{children:["Haz un ",(0,c.jsx)(n.code,{children:"SELECT"})," simple sobre esa vista."]}),"\n",(0,c.jsxs)(n.li,{children:["Agrega un nuevo pedido y repite el ",(0,c.jsx)(n.code,{children:"SELECT"})," \u2192 ver\xe1s que la vista se ",(0,c.jsx)(n.strong,{children:"actualiza autom\xe1ticamente"}),", porque refleja los datos reales."]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"2-qu\xe9-es-una-cte-common-table-expression",children:"2. Qu\xe9 es una CTE (Common Table Expression)"}),"\n",(0,c.jsxs)(n.p,{children:["Una ",(0,c.jsx)(n.strong,{children:"CTE"})," es como una ",(0,c.jsx)(n.strong,{children:"subconsulta temporal nombrada"})," que puedes usar dentro de una sola sentencia ",(0,c.jsx)(n.code,{children:"SELECT"}),", ",(0,c.jsx)(n.code,{children:"INSERT"}),", ",(0,c.jsx)(n.code,{children:"UPDATE"})," o ",(0,c.jsx)(n.code,{children:"DELETE"}),"."]}),"\n",(0,c.jsx)(n.p,{children:"La sintaxis:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"WITH nombre_cte AS (\n  SELECT ...\n)\nSELECT ... FROM nombre_cte;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Ventajas de usar CTE:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Hace tu SQL m\xe1s ",(0,c.jsx)(n.strong,{children:"legible y modular"}),"."]}),"\n",(0,c.jsx)(n.li,{children:"Evita duplicar subconsultas largas."}),"\n",(0,c.jsx)(n.li,{children:"Permite hacer c\xe1lculos intermedios."}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"ejemplo-pr\xe1ctico-de-cte",children:"Ejemplo pr\xe1ctico de CTE"}),"\n",(0,c.jsx)(n.p,{children:"Queremos obtener:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Nombre del cliente"}),"\n",(0,c.jsx)(n.li,{children:"Total acumulado de todos sus pedidos"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Sin CTE:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"SELECT\n  c.name,\n  SUM(o.total) AS total_gastado\nFROM clients c\nLEFT JOIN orders o\n  ON c.id = o.client_id\nGROUP BY c.name;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Con CTE:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"WITH total_por_cliente AS (\n  SELECT\n    c.id AS client_id,\n    c.name,\n    SUM(o.total) AS total_gastado\n  FROM clients c\n  LEFT JOIN orders o\n    ON c.id = o.client_id\n  GROUP BY c.id\n)\nSELECT * FROM total_por_cliente\nORDER BY total_gastado DESC;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Mucho m\xe1s limpio si esta consulta se va a extender o encadenar con otras."}),"\n",(0,c.jsx)(n.h2,{id:"3-cte-encadenadas-m\xfaltiples-with",children:"3. CTE encadenadas (m\xfaltiples WITH)"}),"\n",(0,c.jsxs)(n.p,{children:["Puedes declarar ",(0,c.jsx)(n.strong,{children:"m\xe1s de una CTE"})," separ\xe1ndolas con comas."]}),"\n",(0,c.jsx)(n.p,{children:"Ejemplo:"}),"\n",(0,c.jsx)(n.p,{children:"Queremos calcular:"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"total por cliente,"}),"\n",(0,c.jsx)(n.li,{children:"y luego quedarnos solo con los que gastaron m\xe1s de 100 \u20ac."}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"WITH total_por_cliente AS (\n  SELECT\n    c.id,\n    c.name,\n    SUM(o.total) AS total_gastado\n  FROM clients c\n  LEFT JOIN orders o\n    ON c.id = o.client_id\n  GROUP BY c.id\n),\ntop_clientes AS (\n  SELECT * FROM total_por_cliente\n  WHERE total_gastado > 100\n)\nSELECT * FROM top_clientes\nORDER BY total_gastado DESC;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Resultado: solo clientes \u201ctop\u201d."}),"\n",(0,c.jsxs)(n.p,{children:["Esto es muy \xfatil para ",(0,c.jsx)(n.strong,{children:"informes y dashboards"})," donde quieres filtrar por tramos de ventas, fechas, etc."]}),"\n",(0,c.jsx)(n.h2,{id:"4-cte-recursivas-opcional-avanzado",children:"4. CTE recursivas (opcional avanzado)"}),"\n",(0,c.jsxs)(n.p,{children:["SQLite tambi\xe9n permite ",(0,c.jsx)(n.strong,{children:"CTEs recursivas"}),", por ejemplo para manejar jerarqu\xedas o generar secuencias."]}),"\n",(0,c.jsx)(n.p,{children:"No las usaremos a fondo ahora, pero vale un vistazo:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"WITH RECURSIVE contador(x) AS (\n  SELECT 1\n  UNION ALL\n  SELECT x+1 FROM contador WHERE x < 5\n)\nSELECT x FROM contador;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Resultado:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"1\n2\n3\n4\n5\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Este tipo de CTE es muy \xfatil cuando necesitas recorrer estructuras jer\xe1rquicas o generar datos sint\xe9ticos sin bucles en la app."}),"\n",(0,c.jsx)(n.h2,{id:"5-ejercicio-pr\xe1ctico--cte-en-acci\xf3n",children:"5. Ejercicio pr\xe1ctico \u2014 CTE en acci\xf3n"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["Crear una CTE llamada ",(0,c.jsx)(n.code,{children:"clientes_con_total"})," que calcule:","\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"nombre del cliente"}),"\n",(0,c.jsx)(n.li,{children:"total gastado"}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.li,{children:"Crear otra CTE que filtre solo los que gastaron m\xe1s de 80 \u20ac."}),"\n",(0,c.jsxs)(n.li,{children:["Hacer un ",(0,c.jsx)(n.code,{children:"SELECT"})," final ordenado por total descendente."]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Resultado esperado:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"name  | total_gastado\n---------------------\nLuis  | 120.00\nAna   | 139.89\n\n"})}),"\n",(0,c.jsx)(n.h2,{id:"6-buenas-pr\xe1cticas-con-views-y-ctes",children:"6. Buenas pr\xe1cticas con VIEWS y CTEs"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Usa ",(0,c.jsx)(n.strong,{children:"VIEWS"})," cuando la consulta se va a reutilizar en varios lugares."]}),"\n",(0,c.jsxs)(n.li,{children:["Usa ",(0,c.jsx)(n.strong,{children:"CTEs"})," cuando necesites dividir una consulta compleja en pasos l\xf3gicos."]}),"\n",(0,c.jsxs)(n.li,{children:["Evita subconsultas enormes dentro de ",(0,c.jsx)(n.code,{children:"SELECT"})," \u2014 convi\xe9rtelas en CTEs."]}),"\n",(0,c.jsxs)(n.li,{children:["Nombra las CTEs y vistas de forma descriptiva (",(0,c.jsx)(n.code,{children:"ventas_por_cliente"}),", ",(0,c.jsx)(n.code,{children:"top_ventas"}),", etc.)."]}),"\n",(0,c.jsx)(n.li,{children:"Siempre prueba cada parte de una CTE por separado antes de unirlas."}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"errores-comunes",children:"Errores comunes"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"Error"}),(0,c.jsx)(n.th,{children:"Causa"}),(0,c.jsx)(n.th,{children:"Soluci\xf3n"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u201cno such view\u201d"}),(0,c.jsx)(n.td,{children:"La vista no existe o la borraste"}),(0,c.jsxs)(n.td,{children:["Usa ",(0,c.jsx)(n.code,{children:".tables"})," y ",(0,c.jsx)(n.code,{children:".schema"})," para verificar"]})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"Resultados vac\xedos en CTE"}),(0,c.jsx)(n.td,{children:"Nombre mal escrito o l\xf3gica incorrecta"}),(0,c.jsx)(n.td,{children:"Ejecuta cada CTE individualmente"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u201cambiguous column name\u201d"}),(0,c.jsx)(n.td,{children:"Columna repetida en JOIN"}),(0,c.jsxs)(n.td,{children:["Usa prefijos o alias (",(0,c.jsx)(n.code,{children:"c.name"}),", ",(0,c.jsx)(n.code,{children:"o.total"}),")"]})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"No se actualiza la vista"}),(0,c.jsx)(n.td,{children:"Mala interpretaci\xf3n"}),(0,c.jsx)(n.td,{children:"Recuerda que la vista refleja la tabla original en tiempo real"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>r});var i=s(6540);const c={},l=i.createContext(c);function a(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:a(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);