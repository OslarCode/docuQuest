"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[4570],{270:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"backend/sqlite/indicesYPlanificador","title":"Indices y planificador de consultas","description":"1. Qu\xe9 es un \xedndice en una base de datos","source":"@site/docs/backend/sqlite/indicesYPlanificador.md","sourceDirName":"backend/sqlite","slug":"/backend/sqlite/indicesYPlanificador","permalink":"/docuQuest/docs/backend/sqlite/indicesYPlanificador","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/sqlite/indicesYPlanificador.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Relaciones y consultas expresivas","permalink":"/docuQuest/docs/backend/sqlite/relacionesYConsultas"},"next":{"title":"Transacciones y concurrencia","permalink":"/docuQuest/docs/backend/sqlite/transaccionesYConcurrencia"}}');var c=s(4848),a=s(8453);const l={},d="Indices y planificador de consultas",r={},o=[{value:"1. Qu\xe9 es un \xedndice en una base de datos",id:"1-qu\xe9-es-un-\xedndice-en-una-base-de-datos",level:2},{value:"2. Creaci\xf3n b\xe1sica de \xedndices",id:"2-creaci\xf3n-b\xe1sica-de-\xedndices",level:2},{value:"3. Ver c\xf3mo SQLite ejecuta una consulta \u2014 <code>EXPLAIN QUERY PLAN</code>",id:"3-ver-c\xf3mo-sqlite-ejecuta-una-consulta--explain-query-plan",level:2},{value:"4. Cu\xe1ndo crear \xedndices (y cu\xe1ndo no)",id:"4-cu\xe1ndo-crear-\xedndices-y-cu\xe1ndo-no",level:2},{value:"5. \xcdndices compuestos",id:"5-\xedndices-compuestos",level:2},{value:"6. \xcdndices \xfanicos y parciales",id:"6-\xedndices-\xfanicos-y-parciales",level:2},{value:"a) \xcdndices \xfanicos",id:"a-\xedndices-\xfanicos",level:3},{value:"b) \xcdndices parciales (m\xe1s avanzados)",id:"b-\xedndices-parciales-m\xe1s-avanzados",level:3},{value:"7. Ejercicio pr\xe1ctico \u2014 uso real de \xedndices",id:"7-ejercicio-pr\xe1ctico--uso-real-de-\xedndices",level:2},{value:"8. Mantenimiento y buenas pr\xe1cticas",id:"8-mantenimiento-y-buenas-pr\xe1cticas",level:2},{value:"Errores comunes",id:"errores-comunes",level:2},{value:"1. Qu\xe9 es el \u201cplanificador\u201d de consultas",id:"1-qu\xe9-es-el-planificador-de-consultas",level:2},{value:"2. EXPLAIN QUERY PLAN: tu herramienta principal",id:"2-explain-query-plan-tu-herramienta-principal",level:2},{value:"3. Comparaci\xf3n real: con y sin \xedndice",id:"3-comparaci\xf3n-real-con-y-sin-\xedndice",level:2},{value:"4. C\xf3mo decide SQLite si usar un \xedndice",id:"4-c\xf3mo-decide-sqlite-si-usar-un-\xedndice",level:2},{value:"5. ANALYZE \u2014 dar informaci\xf3n real al planificador",id:"5-analyze--dar-informaci\xf3n-real-al-planificador",level:2},{value:"6. Casos t\xedpicos de tuning con ANALYZE",id:"6-casos-t\xedpicos-de-tuning-con-analyze",level:2},{value:"Caso 1: \xedndice ignorado \u2192 se usa tras ANALYZE",id:"caso-1-\xedndice-ignorado--se-usa-tras-analyze",level:3},{value:"Caso 2: join con m\xfaltiples \xedndices",id:"caso-2-join-con-m\xfaltiples-\xedndices",level:3},{value:"7. Mantener las estad\xedsticas actualizadas",id:"7-mantener-las-estad\xedsticas-actualizadas",level:2},{value:"8. Otras t\xe9cnicas de optimizaci\xf3n real en SQLite",id:"8-otras-t\xe9cnicas-de-optimizaci\xf3n-real-en-sqlite",level:2},{value:"9. Ejercicio pr\xe1ctico \u2014 tuning real",id:"9-ejercicio-pr\xe1ctico--tuning-real",level:2},{value:"10. Buenas pr\xe1cticas finales de optimizaci\xf3n",id:"10-buenas-pr\xe1cticas-finales-de-optimizaci\xf3n",level:2},{value:"Errores comunes",id:"errores-comunes-1",level:2}];function t(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"indices-y-planificador-de-consultas",children:"Indices y planificador de consultas"})}),"\n",(0,c.jsx)(n.h2,{id:"1-qu\xe9-es-un-\xedndice-en-una-base-de-datos",children:"1. Qu\xe9 es un \xedndice en una base de datos"}),"\n",(0,c.jsxs)(n.p,{children:["Un ",(0,c.jsx)(n.strong,{children:"\xedndice"})," es como un ",(0,c.jsx)(n.strong,{children:"\xedndice alfab\xe9tico de un libro"}),":"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Sin \xedndice: para encontrar algo tienes que ",(0,c.jsx)(n.strong,{children:"leer p\xe1gina por p\xe1gina"}),"."]}),"\n",(0,c.jsx)(n.li,{children:"Con \xedndice: vas directamente a la secci\xf3n donde est\xe1 la informaci\xf3n."}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"En SQLite:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Un \xedndice acelera la b\xfasqueda, pero ocupa espacio adicional."}),"\n",(0,c.jsx)(n.li,{children:"Se actualiza autom\xe1ticamente cuando insertas, borras o modificas datos."}),"\n",(0,c.jsxs)(n.li,{children:["No cambia el resultado de tus consultas: ",(0,c.jsx)(n.strong,{children:"solo mejora la velocidad"}),"."]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"2-creaci\xf3n-b\xe1sica-de-\xedndices",children:"2. Creaci\xf3n b\xe1sica de \xedndices"}),"\n",(0,c.jsx)(n.p,{children:"Supongamos que tenemos esta tabla de pedidos:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE orders (\n  id INTEGER PRIMARY KEY,\n  client_id INTEGER NOT NULL,\n  total REAL NOT NULL,\n  created_at TEXT NOT NULL\n);\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Si hacemos una consulta frecuente como:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM orders WHERE client_id = 123;\n\n"})}),"\n",(0,c.jsxs)(n.p,{children:["SQLite, sin \xedndices, tiene que ",(0,c.jsx)(n.strong,{children:"recorrer toda la tabla"})," para encontrar coincidencias."]}),"\n",(0,c.jsx)(n.p,{children:"\ud83d\udc49 Soluci\xf3n:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE INDEX IF NOT EXISTS idx_orders_client_id\nON orders(client_id);\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Ahora SQLite usa el \xedndice para saltar directamente a las filas que necesita."}),"\n",(0,c.jsx)(n.p,{children:"Puedes listar todos los \xedndices con:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:".indexes orders\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Y verlos en el esquema:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:".schema orders\n\n"})}),"\n",(0,c.jsxs)(n.h2,{id:"3-ver-c\xf3mo-sqlite-ejecuta-una-consulta--explain-query-plan",children:["3. Ver c\xf3mo SQLite ejecuta una consulta \u2014 ",(0,c.jsx)(n.code,{children:"EXPLAIN QUERY PLAN"})]}),"\n",(0,c.jsx)(n.p,{children:"La herramienta m\xe1s importante para entender el rendimiento es:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"EXPLAIN QUERY PLAN\nSELECT * FROM orders WHERE client_id = 123;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Sin \xedndice, ver\xe1s algo como:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"SCAN TABLE orders\n\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Esto significa que ",(0,c.jsx)(n.strong,{children:"lee toda la tabla"})," (table scan)."]}),"\n",(0,c.jsx)(n.p,{children:"Con \xedndice:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"SEARCH TABLE orders USING INDEX idx_orders_client_id (client_id=?)\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Ahora usa el \xedndice para encontrar directamente los registros."}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.em,{children:"Regla pr\xe1ctica"}),": si ves \u201cSCAN TABLE\u201d en una consulta que corre sobre una tabla grande, probablemente necesites un \xedndice."]}),"\n",(0,c.jsx)(n.h2,{id:"4-cu\xe1ndo-crear-\xedndices-y-cu\xe1ndo-no",children:"4. Cu\xe1ndo crear \xedndices (y cu\xe1ndo no)"}),"\n",(0,c.jsx)(n.p,{children:"Crea un \xedndice cuando:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["La columna aparece frecuentemente en condiciones ",(0,c.jsx)(n.code,{children:"WHERE"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["La columna se usa en ",(0,c.jsx)(n.code,{children:"JOIN"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Se usa para ordenar (",(0,c.jsx)(n.code,{children:"ORDER BY"}),")."]}),"\n",(0,c.jsx)(n.li,{children:"Es una foreign key."}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"No crees un \xedndice cuando:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"La tabla es muy peque\xf1a (no vale la pena)."}),"\n",(0,c.jsx)(n.li,{children:"Es una columna que cambia constantemente (actualizaciones frecuentes \u2192 sobrecarga innecesaria)."}),"\n",(0,c.jsx)(n.li,{children:"No se usa en filtros ni joins."}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Cada \xedndice adicional ralentiza las escrituras"})," un poco, porque SQLite debe mantenerlo actualizado."]}),"\n",(0,c.jsxs)(n.p,{children:["Por eso se trata de ",(0,c.jsx)(n.strong,{children:"crear los necesarios, no todos"}),"."]}),"\n",(0,c.jsx)(n.h2,{id:"5-\xedndices-compuestos",children:"5. \xcdndices compuestos"}),"\n",(0,c.jsxs)(n.p,{children:["Un ",(0,c.jsx)(n.strong,{children:"\xedndice compuesto"})," involucra m\xe1s de una columna."]}),"\n",(0,c.jsx)(n.p,{children:"Esto es \xfatil cuando tienes consultas con m\xfaltiples condiciones:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE INDEX idx_orders_client_date\nON orders(client_id, created_at);\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Si haces:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM orders\nWHERE client_id = 123 AND created_at > '2025-01-01';\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"SQLite usar\xe1 este \xedndice de forma eficiente."}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.em,{children:"Importante"}),": el orden de las columnas en el \xedndice ",(0,c.jsx)(n.strong,{children:"s\xed importa"}),"."]}),"\n",(0,c.jsxs)(n.p,{children:["Un \xedndice ",(0,c.jsx)(n.code,{children:"(client_id, created_at)"})," sirve bien para consultas con ",(0,c.jsx)(n.code,{children:"client_id"})," solo o ",(0,c.jsx)(n.code,{children:"client_id"})," + ",(0,c.jsx)(n.code,{children:"created_at"}),","]}),"\n",(0,c.jsxs)(n.p,{children:["pero ",(0,c.jsx)(n.strong,{children:"no"})," para ",(0,c.jsx)(n.code,{children:"created_at"})," sola."]}),"\n",(0,c.jsx)(n.h2,{id:"6-\xedndices-\xfanicos-y-parciales",children:"6. \xcdndices \xfanicos y parciales"}),"\n",(0,c.jsx)(n.h3,{id:"a-\xedndices-\xfanicos",children:"a) \xcdndices \xfanicos"}),"\n",(0,c.jsx)(n.p,{children:"Si quieres asegurar que una columna o combinaci\xf3n sea \xfanica:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE UNIQUE INDEX idx_clients_email ON clients(email);\n\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Esto es equivalente a ",(0,c.jsx)(n.code,{children:"UNIQUE"})," en la definici\xf3n de la tabla."]}),"\n",(0,c.jsx)(n.h3,{id:"b-\xedndices-parciales-m\xe1s-avanzados",children:"b) \xcdndices parciales (m\xe1s avanzados)"}),"\n",(0,c.jsxs)(n.p,{children:["Puedes crear un \xedndice ",(0,c.jsx)(n.strong,{children:"solo para un subconjunto de filas"}),", por ejemplo pedidos con total alto:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE INDEX idx_orders_high_value\nON orders(total)\nWHERE total > 100;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Esto puede reducir el tama\xf1o del \xedndice y mejorar a\xfan m\xe1s la velocidad si la condici\xf3n es frecuente."}),"\n",(0,c.jsx)(n.p,{children:"Verifica su uso:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"EXPLAIN QUERY PLAN\nSELECT * FROM orders WHERE total > 100;\n\n"})}),"\n",(0,c.jsx)(n.h2,{id:"7-ejercicio-pr\xe1ctico--uso-real-de-\xedndices",children:"7. Ejercicio pr\xe1ctico \u2014 uso real de \xedndices"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Crear tabla con muchos datos de ejemplo:"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE logs (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  ts TEXT NOT NULL,\n  action TEXT\n);\n\n"})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["Insertar registros sint\xe9ticos (puedes usar un script o ",(0,c.jsx)(n.code,{children:".import"})," CSV)."]}),"\n",(0,c.jsx)(n.li,{children:"Consultar sin \xedndice:"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"EXPLAIN QUERY PLAN\nSELECT * FROM logs WHERE user_id = 5;\n\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Deber\xeda mostrar ",(0,c.jsx)(n.code,{children:"SCAN TABLE logs"}),"."]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Crear \xedndice:"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE INDEX idx_logs_user_id ON logs(user_id);\n\n"})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Volver a consultar:"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"EXPLAIN QUERY PLAN\nSELECT * FROM logs WHERE user_id = 5;\n\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Ver\xe1s ",(0,c.jsx)(n.code,{children:"SEARCH TABLE logs USING INDEX"}),"."]}),"\n",(0,c.jsx)(n.p,{children:"\ud83d\udccc Diferencia clara cuando hay miles de filas."}),"\n",(0,c.jsx)(n.h2,{id:"8-mantenimiento-y-buenas-pr\xe1cticas",children:"8. Mantenimiento y buenas pr\xe1cticas"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\ud83e\uddfc Revisa \xedndices innecesarios \u2192 m\xe1s \xedndices = m\xe1s escritura = m\xe1s espacio."}),"\n",(0,c.jsxs)(n.li,{children:["\ud83e\uddea Usa ",(0,c.jsx)(n.code,{children:"EXPLAIN QUERY PLAN"})," regularmente para entender c\xf3mo SQLite ejecuta tus consultas."]}),"\n",(0,c.jsxs)(n.li,{children:["\ud83d\udee0 Usa nombres claros: ",(0,c.jsx)(n.code,{children:"idx_<tabla>_<columna>"})," (o varias si es compuesto)."]}),"\n",(0,c.jsxs)(n.li,{children:["\ud83e\udde0 No indexes columnas con muy poca variaci\xf3n (ej. ",(0,c.jsx)(n.code,{children:"sexo"})," o ",(0,c.jsx)(n.code,{children:"activo=1"}),") \u2014 el \xedndice no ser\xe1 eficiente."]}),"\n",(0,c.jsx)(n.li,{children:"\ud83d\udd11 Foreign keys deben tener \xedndice si se usan en joins frecuentes."}),"\n",(0,c.jsxs)(n.li,{children:["\ud83d\udcca Para an\xe1lisis profundos, SQLite incluye ",(0,c.jsx)(n.code,{children:"ANALYZE"})," para ayudar al optimizador."]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"errores-comunes",children:"Errores comunes"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"Error / S\xedntoma"}),(0,c.jsx)(n.th,{children:"Causa"}),(0,c.jsx)(n.th,{children:"Soluci\xf3n"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"Consulta lenta"}),(0,c.jsx)(n.td,{children:"Falta de \xedndice"}),(0,c.jsx)(n.td,{children:"Crear \xedndice en columnas filtradas"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u201cSCAN TABLE\u201d en EXPLAIN"}),(0,c.jsx)(n.td,{children:"No hay \xedndice \xfatil"}),(0,c.jsx)(n.td,{children:"Revisar estructura y orden"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"Escrituras m\xe1s lentas"}),(0,c.jsx)(n.td,{children:"Exceso de \xedndices"}),(0,c.jsx)(n.td,{children:"Eliminar los que no se usan"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\xcdndice no usado"}),(0,c.jsx)(n.td,{children:"Orden de columnas incorrecto"}),(0,c.jsx)(n.td,{children:"Reorganizar \xedndice compuesto"})]})]})]}),"\n",(0,c.jsx)(n.h2,{id:"1-qu\xe9-es-el-planificador-de-consultas",children:"1. Qu\xe9 es el \u201cplanificador\u201d de consultas"}),"\n",(0,c.jsx)(n.p,{children:"Cada vez que SQLite recibe una consulta, no la ejecuta directamente."}),"\n",(0,c.jsxs)(n.p,{children:["Primero ",(0,c.jsx)(n.strong,{children:"piensa c\xf3mo ejecutarla de la manera m\xe1s r\xe1pida posible"}),"."]}),"\n",(0,c.jsxs)(n.p,{children:["Para eso tiene un ",(0,c.jsx)(n.strong,{children:"planificador de consultas"})," (",(0,c.jsx)(n.em,{children:"query planner"}),")."]}),"\n",(0,c.jsx)(n.p,{children:"Este planificador:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Decide si usar un \xedndice o leer toda la tabla."}),"\n",(0,c.jsx)(n.li,{children:"Elige el orden de los JOINs."}),"\n",(0,c.jsx)(n.li,{children:"Usa estad\xedsticas internas para optimizar."}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["Y t\xfa puedes inspeccionar ese plan para saber ",(0,c.jsx)(n.strong,{children:"si tu \xedndice se est\xe1 usando"})," o no."]}),"\n",(0,c.jsx)(n.h2,{id:"2-explain-query-plan-tu-herramienta-principal",children:"2. EXPLAIN QUERY PLAN: tu herramienta principal"}),"\n",(0,c.jsx)(n.p,{children:"La forma m\xe1s sencilla de \u201cver\u201d el planificador en acci\xf3n es:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"EXPLAIN QUERY PLAN\nSELECT * FROM orders WHERE client_id = 5;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Ejemplo t\xedpico de salida:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"SEARCH TABLE orders USING INDEX idx_orders_client_id (client_id=?)\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Interpretaci\xf3n:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"SEARCH TABLE ... USING INDEX"})," \u2192 \u2705 \xedndice usado."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"SCAN TABLE ..."})," \u2192 \u274c no hay \xedndice \xfatil, lectura completa."]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Si haces un JOIN:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"EXPLAIN QUERY PLAN\nSELECT c.name, o.total\nFROM clients c\nJOIN orders o ON c.id = o.client_id\nWHERE o.total > 50;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Puedes ver algo como:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"SCAN TABLE clients\nSEARCH TABLE orders USING INDEX idx_orders_client_id (client_id=?)\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Esto significa que SQLite:"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["Recorre la tabla ",(0,c.jsx)(n.code,{children:"clients"})," (porque no hay filtro)."]}),"\n",(0,c.jsxs)(n.li,{children:["Busca en ",(0,c.jsx)(n.code,{children:"orders"})," usando el \xedndice."]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Consejo real"}),": aprende a leer estas salidas, aunque parezcan \u201csecas\u201d."]}),"\n",(0,c.jsxs)(n.p,{children:["Una simple l\xednea de \u201cSCAN\u201d suele indicar ",(0,c.jsx)(n.strong,{children:"una oportunidad de optimizaci\xf3n"}),"."]}),"\n",(0,c.jsx)(n.h2,{id:"3-comparaci\xf3n-real-con-y-sin-\xedndice",children:"3. Comparaci\xf3n real: con y sin \xedndice"}),"\n",(0,c.jsx)(n.p,{children:"Vamos a hacer un peque\xf1o experimento pr\xe1ctico:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE logs (\n  id INTEGER PRIMARY KEY,\n  user_id INTEGER NOT NULL,\n  ts TEXT NOT NULL,\n  action TEXT\n);\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Insertamos muchos registros (ej. con un script, CSV o bucle)."}),"\n",(0,c.jsx)(n.p,{children:"Luego:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"EXPLAIN QUERY PLAN\nSELECT * FROM logs WHERE user_id = 10;\n\n"})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"SCAN TABLE logs"})," (recorre todo)."]}),"\n",(0,c.jsx)(n.p,{children:"Creamos \xedndice:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE INDEX idx_logs_user_id ON logs(user_id);\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Repetimos:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"EXPLAIN QUERY PLAN\nSELECT * FROM logs WHERE user_id = 10;\n\n"})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"SEARCH TABLE logs USING INDEX idx_logs_user_id (user_id=?)"})," \u2705"]}),"\n",(0,c.jsxs)(n.p,{children:["Esto es exactamente c\xf3mo ",(0,c.jsx)(n.strong,{children:"validas que tus \xedndices est\xe9n ayudando de verdad"}),"."]}),"\n",(0,c.jsx)(n.h2,{id:"4-c\xf3mo-decide-sqlite-si-usar-un-\xedndice",children:"4. C\xf3mo decide SQLite si usar un \xedndice"}),"\n",(0,c.jsxs)(n.p,{children:["El planificador ",(0,c.jsx)(n.strong,{children:"no siempre usa un \xedndice"}),", aunque exista."]}),"\n",(0,c.jsx)(n.p,{children:"SQLite eval\xfaa:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Cu\xe1ntas filas espera leer con el \xedndice."}),"\n",(0,c.jsx)(n.li,{children:"Si el \xedndice evita ordenamientos adicionales."}),"\n",(0,c.jsx)(n.li,{children:"Si hay otros filtros m\xe1s selectivos."}),"\n",(0,c.jsx)(n.li,{children:"Estad\xedsticas internas de la tabla (que veremos ahora)."}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Ejemplo:"}),"\n",(0,c.jsxs)(n.p,{children:["Si tienes un \xedndice sobre ",(0,c.jsx)(n.code,{children:"gender"})," (con solo dos valores posibles), probablemente ",(0,c.jsx)(n.strong,{children:"no lo use"})," porque no mejora nada."]}),"\n",(0,c.jsxs)(n.p,{children:["Pero si tienes un \xedndice sobre ",(0,c.jsx)(n.code,{children:"email"})," (valores \xfanicos), s\xed lo usar\xe1."]}),"\n",(0,c.jsx)(n.h2,{id:"5-analyze--dar-informaci\xf3n-real-al-planificador",children:"5. ANALYZE \u2014 dar informaci\xf3n real al planificador"}),"\n",(0,c.jsxs)(n.p,{children:["SQLite tiene una herramienta llamada ",(0,c.jsx)(n.code,{children:"ANALYZE"})," que ",(0,c.jsx)(n.strong,{children:"recopila estad\xedsticas internas"})," sobre tus tablas e \xedndices."]}),"\n",(0,c.jsxs)(n.p,{children:["Estas estad\xedsticas permiten al planificador ",(0,c.jsx)(n.strong,{children:"tomar mejores decisiones"}),"."]}),"\n",(0,c.jsx)(n.p,{children:"Ejecutar:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"ANALYZE;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Esto:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Calcula la distribuci\xf3n de valores en las columnas indexadas."}),"\n",(0,c.jsxs)(n.li,{children:["Guarda esa info en tablas especiales internas (",(0,c.jsx)(n.code,{children:"sqlite_stat1"}),", ",(0,c.jsx)(n.code,{children:"sqlite_stat4"})," si est\xe1 habilitado)."]}),"\n",(0,c.jsx)(n.li,{children:"Mejora la calidad de los planes de ejecuci\xf3n."}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"Ver estad\xedsticas:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM sqlite_stat1;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Ejemplo de salida:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"logs idx_logs_user_id 100000 1000\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Esto significa que:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"logs"})," tiene 100.000 filas"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"idx_logs_user_id"})," divide la tabla en aprox. 1000 filas por valor distinto"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["Con esa informaci\xf3n, el planificador sabr\xe1 que ",(0,c.jsx)(n.strong,{children:"usar el \xedndice es \xfatil"}),"."]}),"\n",(0,c.jsx)(n.h2,{id:"6-casos-t\xedpicos-de-tuning-con-analyze",children:"6. Casos t\xedpicos de tuning con ANALYZE"}),"\n",(0,c.jsx)(n.h3,{id:"caso-1-\xedndice-ignorado--se-usa-tras-analyze",children:"Caso 1: \xedndice ignorado \u2192 se usa tras ANALYZE"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"EXPLAIN QUERY PLAN SELECT * FROM logs WHERE user_id = 10;\n-- SCAN TABLE logs\nANALYZE;\nEXPLAIN QUERY PLAN SELECT * FROM logs WHERE user_id = 10;\n-- SEARCH TABLE logs USING INDEX idx_logs_user_id\n\n"})}),"\n",(0,c.jsx)(n.h3,{id:"caso-2-join-con-m\xfaltiples-\xedndices",children:"Caso 2: join con m\xfaltiples \xedndices"}),"\n",(0,c.jsxs)(n.p,{children:["Si tienes dos \xedndices en una consulta JOIN, ANALYZE ayuda a decidir ",(0,c.jsx)(n.strong,{children:"qu\xe9 tabla recorrer primero"})," y cu\xe1l buscar por \xedndice."]}),"\n",(0,c.jsx)(n.h2,{id:"7-mantener-las-estad\xedsticas-actualizadas",children:"7. Mantener las estad\xedsticas actualizadas"}),"\n",(0,c.jsxs)(n.p,{children:["Cada vez que tu base de datos cambia significativamente (miles de inserciones o borrados), ",(0,c.jsxs)(n.strong,{children:["repite ",(0,c.jsx)(n.code,{children:"ANALYZE"})]}),"."]}),"\n",(0,c.jsx)(n.p,{children:"Tambi\xe9n puedes limpiar estad\xedsticas obsoletas:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"DELETE FROM sqlite_stat1;\nANALYZE;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Esto es especialmente importante si tu aplicaci\xf3n crece con el tiempo."}),"\n",(0,c.jsx)(n.h2,{id:"8-otras-t\xe9cnicas-de-optimizaci\xf3n-real-en-sqlite",children:"8. Otras t\xe9cnicas de optimizaci\xf3n real en SQLite"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsxs)(n.strong,{children:[(0,c.jsx)(n.code,{children:"LIMIT"})," + ",(0,c.jsx)(n.code,{children:"ORDER BY"})," con \xedndice"]}),": si ordenas por una columna indexada, SQLite puede evitar operaciones de sorting costosas."]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE INDEX idx_orders_total ON orders(total);\nSELECT * FROM orders ORDER BY total DESC LIMIT 10;\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Mucho m\xe1s r\xe1pido."}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Evitar funciones en WHERE"}),":"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"WHERE date(created_at) = '2025-10-09'\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"Esto no usa el \xedndice."}),"\n",(0,c.jsx)(n.p,{children:"Mejor:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"WHERE created_at >= '2025-10-09' AND created_at < '2025-10-10'\n\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Esto s\xed puede usar el \xedndice sobre ",(0,c.jsx)(n.code,{children:"created_at"}),"."]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.strong,{children:"Evitar comodines al inicio de LIKE"}),":"]}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"LIKE '%texto'"})," no usa \xedndice, pero ",(0,c.jsx)(n.code,{children:"LIKE 'texto%'"})," s\xed."]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"9-ejercicio-pr\xe1ctico--tuning-real",children:"9. Ejercicio pr\xe1ctico \u2014 tuning real"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["Crea una tabla ",(0,c.jsx)(n.code,{children:"ventas"})," con:"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE ventas (\n  id INTEGER PRIMARY KEY,\n  cliente TEXT,\n  fecha TEXT,\n  total REAL\n);\n\n"})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Inserta muchos registros (por CSV o script)."}),"\n",(0,c.jsx)(n.li,{children:"Consulta sin \xedndice:"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"EXPLAIN QUERY PLAN\nSELECT * FROM ventas WHERE cliente = 'Marta';\n\n"})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Crea \xedndice:"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE INDEX idx_ventas_cliente ON ventas(cliente);\n\n"})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Repite la consulta con ",(0,c.jsx)(n.code,{children:"EXPLAIN"}),":"]}),"\n",(0,c.jsx)(n.p,{children:"deber\xeda cambiar de SCAN a SEARCH."}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:["Ejecuta ",(0,c.jsx)(n.code,{children:"ANALYZE;"})," y vuelve a probar con filtros m\xe1s complejos:"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"EXPLAIN QUERY PLAN\nSELECT * FROM ventas\nWHERE cliente = 'Marta'\nAND fecha BETWEEN '2025-01-01' AND '2025-12-31';\n\n"})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Observa c\xf3mo el planificador elige \xedndices m\xe1s eficientemente."}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"10-buenas-pr\xe1cticas-finales-de-optimizaci\xf3n",children:"10. Buenas pr\xe1cticas finales de optimizaci\xf3n"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["Siempre inspecciona tus consultas con ",(0,c.jsx)(n.code,{children:"EXPLAIN QUERY PLAN"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Usa ",(0,c.jsx)(n.code,{children:"ANALYZE"})," despu\xe9s de insertar muchos datos para mejorar los planes."]}),"\n",(0,c.jsx)(n.li,{children:"Usa \xedndices en columnas realmente selectivas y usadas en filtros/joins."}),"\n",(0,c.jsxs)(n.li,{children:["Evita funciones en condiciones ",(0,c.jsx)(n.code,{children:"WHERE"})," que impidan usar \xedndices."]}),"\n",(0,c.jsx)(n.li,{children:"No abuses de los \xedndices \u2014 revisa su impacto en escrituras."}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"errores-comunes-1",children:"Errores comunes"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"S\xedntoma"}),(0,c.jsx)(n.th,{children:"Causa"}),(0,c.jsx)(n.th,{children:"Soluci\xf3n"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"Consulta lenta aunque hay \xedndice"}),(0,c.jsx)(n.td,{children:"Planificador no lo usa"}),(0,c.jsxs)(n.td,{children:["Ejecuta ",(0,c.jsx)(n.code,{children:"ANALYZE"}),", revisa selectividad"]})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"EXPLAIN siempre muestra SCAN"}),(0,c.jsx)(n.td,{children:"Falta \xedndice \xfatil o expresi\xf3n no indexada"}),(0,c.jsx)(n.td,{children:"Ajusta consulta y crea \xedndice correcto"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"Escrituras lentas"}),(0,c.jsx)(n.td,{children:"Demasiados \xedndices"}),(0,c.jsx)(n.td,{children:"Revisa \xedndices y elimina innecesarios"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"Estad\xedsticas desactualizadas"}),(0,c.jsx)(n.td,{children:"Mucha inserci\xf3n o borrado"}),(0,c.jsxs)(n.td,{children:["Reejecuta ",(0,c.jsx)(n.code,{children:"ANALYZE"})," peri\xf3dicamente"]})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>d});var i=s(6540);const c={},a=i.createContext(c);function l(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:l(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);