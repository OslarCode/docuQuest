"use strict";(globalThis.webpackChunkDocuQuest_oslar_code=globalThis.webpackChunkDocuQuest_oslar_code||[]).push([[5663],{8003:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"backend/sqlite/extensionesYFunciones","title":"Extensiones y funciones personalizadas","description":"1. Qu\xe9 es una UDF (User Defined Function)","source":"@site/docs/backend/sqlite/extensionesYFunciones.md","sourceDirName":"backend/sqlite","slug":"/backend/sqlite/extensionesYFunciones","permalink":"/docuQuest/docs/backend/sqlite/extensionesYFunciones","draft":false,"unlisted":false,"editUrl":"https://github.com/OslarCode/OslarCode/docs/backend/sqlite/extensionesYFunciones.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"B\xfasqueda de texto completo con FTS5","permalink":"/docuQuest/docs/backend/sqlite/busquedaFTS5"}}');var r=s(4848),a=s(8453);const c={},o="Extensiones y funciones personalizadas",l={},d=[{value:"1. Qu\xe9 es una UDF (User Defined Function)",id:"1-qu\xe9-es-una-udf-user-defined-function",level:2},{value:"2. UDF en Node.js (con <code>better-sqlite3</code>)",id:"2-udf-en-nodejs-con-better-sqlite3",level:2},{value:"Instalar dependencia",id:"instalar-dependencia",level:3},{value:"C\xf3digo b\xe1sico",id:"c\xf3digo-b\xe1sico",level:3},{value:"3. UDF en Python (con <code>sqlite3</code> est\xe1ndar)",id:"3-udf-en-python-con-sqlite3-est\xe1ndar",level:2},{value:"4. UDF con m\xfaltiples argumentos",id:"4-udf-con-m\xfaltiples-argumentos",level:2},{value:"5. Ejemplo pr\xe1ctico \u2014 validaci\xf3n de correos",id:"5-ejemplo-pr\xe1ctico--validaci\xf3n-de-correos",level:2},{value:"6. Cu\xe1ndo usar UDF (y cu\xe1ndo no)",id:"6-cu\xe1ndo-usar-udf-y-cu\xe1ndo-no",level:2},{value:"7. Cargar extensiones nativas (<code>load_extension</code>)",id:"7-cargar-extensiones-nativas-load_extension",level:2},{value:"8. Ejercicio pr\xe1ctico \u2014 combinaci\xf3n de funciones personalizadas",id:"8-ejercicio-pr\xe1ctico--combinaci\xf3n-de-funciones-personalizadas",level:2},{value:"9. Buenas pr\xe1cticas con UDF y extensiones",id:"9-buenas-pr\xe1cticas-con-udf-y-extensiones",level:2},{value:"10. Errores comunes",id:"10-errores-comunes",level:2}];function t(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"extensiones-y-funciones-personalizadas",children:"Extensiones y funciones personalizadas"})}),"\n",(0,r.jsx)(n.h2,{id:"1-qu\xe9-es-una-udf-user-defined-function",children:"1. Qu\xe9 es una UDF (User Defined Function)"}),"\n",(0,r.jsxs)(n.p,{children:["Una ",(0,r.jsx)(n.strong,{children:"UDF"})," es una funci\xf3n que t\xfa defines en tu lenguaje anfitri\xf3n (por ejemplo, JavaScript o Python), y luego ",(0,r.jsx)(n.strong,{children:"la usas dentro de consultas SQL"})," como si fuera nativa."]}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo de idea:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Crear una funci\xf3n ",(0,r.jsx)(n.code,{children:"slugify(text)"})," \u2192 para generar URLs amigables directamente desde SQL."]}),"\n",(0,r.jsxs)(n.li,{children:["Crear ",(0,r.jsx)(n.code,{children:"es_email_valido(text)"})," \u2192 para validar emails."]}),"\n",(0,r.jsxs)(n.li,{children:["Crear ",(0,r.jsx)(n.code,{children:"random_uuid()"})," \u2192 si necesitas identificadores \xfanicos personalizados."]}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"2-udf-en-nodejs-con-better-sqlite3",children:["2. UDF en Node.js (con ",(0,r.jsx)(n.code,{children:"better-sqlite3"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["Si usas Node.js, la librer\xeda ",(0,r.jsx)(n.a,{href:"https://github.com/WiseLibs/better-sqlite3",children:(0,r.jsx)(n.code,{children:"better-sqlite3"})})," permite ",(0,r.jsx)(n.strong,{children:"registrar funciones personalizadas"})," f\xe1cilmente."]}),"\n",(0,r.jsx)(n.p,{children:"Ejemplo de proyecto simple:"}),"\n",(0,r.jsx)(n.h3,{id:"instalar-dependencia",children:"Instalar dependencia"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install better-sqlite3\n\n"})}),"\n",(0,r.jsx)(n.h3,{id:"c\xf3digo-b\xe1sico",children:"C\xf3digo b\xe1sico"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"import Database from 'better-sqlite3';\nconst db = new Database('test.db');\n\n// Definir una funci\xf3n personalizada\ndb.function('slugify', (text) => {\n  return text\n    .toLowerCase()\n    .normalize('NFD')           // elimina acentos\n    .replace(/[\\u0300-\\u036f]/g, '')\n    .replace(/\\s+/g, '-')\n    .replace(/[^a-z0-9-]/g, '');\n});\n\n// Crear tabla y datos\ndb.prepare('CREATE TABLE IF NOT EXISTS articles (id INTEGER PRIMARY KEY, title TEXT)').run();\ndb.prepare('INSERT INTO articles (title) VALUES (?)').run('Hola Mundo con Acentos');\n\n// Usar la funci\xf3n en una consulta SQL\nconst rows = db.prepare('SELECT slugify(title) AS slug FROM articles').all();\nconsole.log(rows);\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Salida:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[ { slug: 'hola-mundo-con-acentos' } ]\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Acabas de extender SQLite con una ",(0,r.jsx)(n.strong,{children:"funci\xf3n personalizada reutilizable"}),"."]}),"\n",(0,r.jsxs)(n.h2,{id:"3-udf-en-python-con-sqlite3-est\xe1ndar",children:["3. UDF en Python (con ",(0,r.jsx)(n.code,{children:"sqlite3"})," est\xe1ndar)"]}),"\n",(0,r.jsx)(n.p,{children:"Python tambi\xe9n permite registrar funciones f\xe1cilmente:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import sqlite3\nimport unicodedata\nimport re\n\ndef slugify(text):\n    text = unicodedata.normalize('NFD', text)\n    text = text.encode('ascii', 'ignore').decode('utf-8')\n    text = re.sub(r'[^a-zA-Z0-9\\s-]', '', text).lower()\n    text = re.sub(r'\\s+', '-', text).strip('-')\n    return text\n\nconn = sqlite3.connect('test.db')\nconn.create_function('slugify', 1, slugify)\n\ncur = conn.cursor()\ncur.execute('CREATE TABLE IF NOT EXISTS articles (id INTEGER PRIMARY KEY, title TEXT)')\ncur.execute('INSERT INTO articles (title) VALUES (?)', ('Hola Mundo con Acentos',))\nconn.commit()\n\ncur.execute('SELECT slugify(title) FROM articles')\nprint(cur.fetchall())\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Resultado:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[('hola-mundo-con-acentos',)]\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"conn.create_function(nombre, num_args, funcion)"})," \u2192 as\xed se registra."]}),"\n",(0,r.jsx)(n.h2,{id:"4-udf-con-m\xfaltiples-argumentos",children:"4. UDF con m\xfaltiples argumentos"}),"\n",(0,r.jsx)(n.p,{children:"Puedes crear funciones con m\xe1s de un argumento f\xe1cilmente:"}),"\n",(0,r.jsx)(n.p,{children:"Node.js:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"db.function('concat3', (a, b, c) => `${a}-${b}-${c}`);\ndb.prepare(\"SELECT concat3('uno','dos','tres')\").get();\n// \u2192 uno-dos-tres\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Python:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"def concat3(a,b,c): return f\"{a}-{b}-{c}\"\nconn.create_function('concat3', 3, concat3)\ncur.execute(\"SELECT concat3('uno','dos','tres')\")\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Igual que las funciones nativas."}),"\n",(0,r.jsx)(n.h2,{id:"5-ejemplo-pr\xe1ctico--validaci\xf3n-de-correos",children:"5. Ejemplo pr\xe1ctico \u2014 validaci\xf3n de correos"}),"\n",(0,r.jsx)(n.p,{children:"Sup\xf3n que quieres validar correos directamente desde la base, sin procesarlos en la app:"}),"\n",(0,r.jsx)(n.p,{children:"Node.js:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"db.function('is_valid_email', (email) => /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email));\n\ndb.prepare('CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY, email TEXT)').run();\ndb.prepare('INSERT INTO users (email) VALUES (?)').run('correo@valido.com');\n\nconst rows = db.prepare('SELECT email, is_valid_email(email) AS valido FROM users').all();\nconsole.log(rows);\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Salida:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[ { email: 'correo@valido.com', valido: 1 } ]\n\n"})}),"\n",(0,r.jsx)(n.h2,{id:"6-cu\xe1ndo-usar-udf-y-cu\xe1ndo-no",children:"6. Cu\xe1ndo usar UDF (y cu\xe1ndo no)"}),"\n",(0,r.jsx)(n.p,{children:"\xdatil cuando:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Quieres reutilizar l\xf3gica en varias consultas SQL."}),"\n",(0,r.jsx)(n.li,{children:"Necesitas c\xe1lculos personalizados sin duplicar c\xf3digo."}),"\n",(0,r.jsx)(n.li,{children:"Deseas enriquecer tus consultas sin tocar la tabla."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Ev\xedtalo si:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"La l\xf3gica es muy compleja o pesada (deber\xeda vivir en la app)."}),"\n",(0,r.jsx)(n.li,{children:"Necesitas funciones con estado persistente."}),"\n",(0,r.jsx)(n.li,{children:"No quieres acoplar tu l\xf3gica de negocio a la base."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Regla pr\xe1ctica: ",(0,r.jsx)(n.strong,{children:"usa UDF para transformar datos"}),", no para procesar l\xf3gica cr\xedtica."]}),"\n",(0,r.jsxs)(n.h2,{id:"7-cargar-extensiones-nativas-load_extension",children:["7. Cargar extensiones nativas (",(0,r.jsx)(n.code,{children:"load_extension"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["SQLite tambi\xe9n permite cargar ",(0,r.jsx)(n.strong,{children:"extensiones escritas en C/C++ o compiladas"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Por ejemplo:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"mod_spatialite"})," \u2192 soporte GIS, mapas y geodatos."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"regexp"})," \u2192 soporte de expresiones regulares completas."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sqlcipher"})," \u2192 cifrado AES."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Para cargar:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT load_extension('mod_spatialite');\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Importante: algunas instalaciones de SQLite requieren compilar con soporte ",(0,r.jsx)(n.code,{children:"--enable-load-extension"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Tambi\xe9n puedes habilitarlo desde Node.js:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"db.loadExtension('./mod_spatialite.so');\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Esto te abre la puerta a ampliar SQLite de forma modular sin inflar tu app principal."}),"\n",(0,r.jsx)(n.h2,{id:"8-ejercicio-pr\xe1ctico--combinaci\xf3n-de-funciones-personalizadas",children:"8. Ejercicio pr\xe1ctico \u2014 combinaci\xf3n de funciones personalizadas"}),"\n",(0,r.jsx)(n.p,{children:"Vamos a crear un peque\xf1o ejemplo que combina varias ideas:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Crear una tabla de productos:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE products (id INTEGER PRIMARY KEY, name TEXT, price REAL);\n\n"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Insertar datos:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"INSERT INTO products (name, price) VALUES\n('C\xe1mara Full HD', 199.99),\n('Micr\xf3fono Profesional', 89.50),\n('Luz LED', 49.00);\n\n"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Registrar funciones en Node.js:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"db.function('slugify', text => text.toLowerCase().replace(/\\s+/g,'-'));\ndb.function('with_tax', (price, rate) => (price * (1 + rate)).toFixed(2));\n\n"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Consultar:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT slugify(name) AS url_slug, with_tax(price, 0.21) AS final_price\nFROM products;\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"Resultado esperado:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"url_slug                 | final_price\n--------------------------|-------------\nc\xe1mara-full-hd           | 241.99\nmicr\xf3fono-profesional    | 108.30\nluz-led                  | 59.29\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Has extendido SQLite para ",(0,r.jsx)(n.strong,{children:"convertir nombres y calcular precios con impuestos directamente en la consulta"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"9-buenas-pr\xe1cticas-con-udf-y-extensiones",children:"9. Buenas pr\xe1cticas con UDF y extensiones"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Usa nombres claros y consistentes para tus funciones personalizadas."}),"\n",(0,r.jsx)(n.li,{children:"Mant\xe9n las funciones ligeras (no hagas loops complejos)."}),"\n",(0,r.jsx)(n.li,{children:"Si la l\xf3gica es compleja, preprocesa en la app, no en SQLite."}),"\n",(0,r.jsx)(n.li,{children:"Documenta tus UDF: otros devs deben saber qu\xe9 hacen."}),"\n",(0,r.jsxs)(n.li,{children:["Usa ",(0,r.jsx)(n.code,{children:"load_extension"})," con cuidado \u2014 solo extensiones de confianza."]}),"\n",(0,r.jsx)(n.li,{children:"Puedes combinar UDF con vistas, triggers y FTS para crear flujos muy potentes."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"10-errores-comunes",children:"10. Errores comunes"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Error / s\xedntoma"}),(0,r.jsx)(n.th,{children:"Causa"}),(0,r.jsx)(n.th,{children:"Soluci\xf3n"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u201cno such function: X\u201d"}),(0,r.jsx)(n.td,{children:"UDF no registrada correctamente"}),(0,r.jsx)(n.td,{children:"Verificar nombre y argumentos"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"UDF lenta en grandes consultas"}),(0,r.jsx)(n.td,{children:"Funci\xf3n demasiado pesada"}),(0,r.jsx)(n.td,{children:"Optimizar o trasladar a la app"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Problemas con caracteres especiales"}),(0,r.jsx)(n.td,{children:"Falta de normalizaci\xf3n"}),(0,r.jsxs)(n.td,{children:["Usar ",(0,r.jsx)(n.code,{children:".normalize()"})," o ",(0,r.jsx)(n.code,{children:"unicodedata"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Extensi\xf3n no se carga"}),(0,r.jsxs)(n.td,{children:["SQLite sin soporte ",(0,r.jsx)(n.code,{children:"load_extension"})]}),(0,r.jsx)(n.td,{children:"Recompilar o habilitar extensi\xf3n"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Conflicto de nombres"}),(0,r.jsx)(n.td,{children:"UDF y funci\xf3n nativa con mismo nombre"}),(0,r.jsx)(n.td,{children:"Usar nombre \xfanico para la UDF"})]})]})]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>o});var i=s(6540);const r={},a=i.createContext(r);function c(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);